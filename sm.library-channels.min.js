var smallmachine=function(d){function b(f,d){for(var h=0;h<d.dependencies.length;h++){for(var n=!1,c=0;c<f.length;c++)if(d.dependencies[h]==f[c].namespace){n=!0;break}if(!n)return d.dependencies[h]}return null}function p(f,d){this._term=f;this._rules=d._rules;return this}function l(){return this}function k(){return this}function m(f){this._id=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(f){var h=16*Math.random()|0;return("x"==f?h:h&3|8).toString(16)})}();"undefined"!==
typeof f._value&&"undefined"!==typeof f._type?(this._value=f._value,this._type=f._type):(this._value=f,this._type=null);return this}function e(f){this.namespace=f;this._inferencer=new c;this._activators=[];this._term=m;return this}function c(){this._term={_value:null};this._rules=[];return this}function a(f,c){var h=this[f];"function"===typeof c?d.alsoBehavesLike(h,c.prototype):d.alsoBehavesLike(h,c);for(var n in h)h.hasOwnProperty(n)&&0!==n.indexOf("_")&&"undefined"!==typeof h[n]._type&&h[n]._type===
d.CONCEPT&&("function"===typeof c?d.alsoBehavesLike(h[n],c.prototype):d.alsoBehavesLike(h[n],c))}function g(f,c,h){f=this[f];var n=this[c],a=this[h];n._type===d.CONCEPT?d.error(Error("Cannot define a relationship with a concept type: "+n._value)):null===n._type&&(n._type=d.RELATIONSHIP);a._type===d.RELATIONSHIP?d.error(Error("Cannot create a relationship with a relationship type: "+a._value)):null===a._type&&(a._type=d.CONCEPT);f._type===d.RELATIONSHIP?d.error(Error("Cannot create a relationship from a relationship type: "+
f._value)):null===f._type&&(f._type=d.CONCEPT);"undefined"===typeof f[c]&&(f[c]=new f.constructor(n));"undefined"===typeof f[c][h]&&(f[c][h]=a);"undefined"===typeof f[h]&&(f[h]=a);a.relate(f[c]);for(var b in a)a.hasOwnProperty(b)&&"function"===typeof a[b].relate&&("undefined"===typeof f[c][b]&&(f[c][b]=a[b]),"undefined"===typeof f[b]&&(f[b]=a[b]),a[b].relate(f[c]))}function r(f,c){var h=this[f],a=this[c];a._type===d.RELATIONSHIP?d.error(Error("Cannot apply isA to a relationship type: "+a._value)):
null===a._type&&(a._type=d.CONCEPT);h._type===d.RELATIONSHIP?d.error(Error("Cannot apply isA to a relationship type: "+h._value)):null===h._type&&(h._type=d.CONCEPT);"undefined"===typeof a[f]&&(a[f]=h)}function s(f,c){var h=this[f],a=this[c];a._type===d.RELATIONSHIP?d.error(Error("Cannot apply hasRange to a relationship type: "+a._value)):null===a._type&&(a._type=d.CONCEPT);h._type===d.CONCEPT?d.error(Error("Cannot assign hasRange from a concept type: "+h._value)):null===h._type&&(h._type=d.RELATIONSHIP);
"undefined"===typeof h[c]&&(h[c]=a);a.relate(h);for(var b in a)if(a.hasOwnProperty(b)&&"function"===typeof a[b].relate){var e=a[b]._value||null;null!==e&&("undefined"===typeof h[e]&&(h[e]=a[b]),a[b].relate(h))}}function t(f,a){var h=this[f],c=this[a];c._type===d.RELATIONSIP?d.error(Error("Cannot apply hasRange to a relationship type: "+c._value)):null===c._type&&(c._type=d.CONCEPT);h._type===d.CONCEPT?d.error(Error("Cannot assign hasRange from a concept type: "+h._value)):null===h._type&&(h._type=
d.RELATIONSHIP);"undefined"===typeof c[f]&&(c[f]=h)}"function"!==typeof Object.getPrototypeOf&&(Object.getPrototypeOf="object"===typeof"test".__proto__?function(f){return f.__proto__}:function(f){return f.constructor.prototype});d=function(f,c){"undefined"===typeof f&&d.error(Error("Missing required parameter for smallmachine constructor: one or more instances of type 'Ontology'"));for(var a=[].concat(f),n="",g=0;g<a.length;g++)"undefined"===typeof a[g]&&d.error(Error("Element "+g+" of the ontologies argument passed to the smallmachine constructor is undefined")),
"undefined"===typeof a[g].namespace?"undefined"!==typeof d.ontology[a[g]]&&(n=n+a[g]+",",a[g]=d.ontology[a[g]]):n=n+a[g].namespace+",";n=new e(n.substring(0,n.length-1));for(g=0;g<a.length;g++){for(var p in a[g])a[g].hasOwnProperty(p)&&"undefined"!==typeof a[g][p]._name&&"Proxy"==a[g][p]._name&&n.addTerm(a[g][p]._term._value);for(var l=0;l<a[g]._inferencer._rules.length;l++)n._inferencer._rules.push(a[g]._inferencer._rules[l]);for(l=0;l<a[g]._activators.length;l++){var k=b(a,a[g]._activators[l]);
null!==k&&d.error(Error("Cannot wire-in ontology with missing activator dependency on '"+k+"'"));n.registerActivator(a[g]._activators[l]);n._activators.sort(function(a,f){if(a.namespace==f.namespace)return 0;for(var c=0;c<a.dependencies.length;c++)if(f.namespace==a.dependencies[c])return 1;for(c=0;c<f.dependencies.length;c++)if(a.namespace==f.dependencies[c])return-1;return 0})}}return n.getModel(c)};d.alsoBehavesLike=function(a,c){("undefined"===typeof a||"undefined"===typeof c)&&d.error(Error("Cannot mixin with an undefined object"));
for(var b in c)if(c.hasOwnProperty(b)&&!(0==b.indexOf("_")||"initializer"===b))if("undefined"!==typeof a[b]){if("undefined"!==typeof c[b].prototype){if("undefined"!==typeof c[b].prototype.initializer&&!0==c[b].prototype.initializer)continue;var g="undefined"!==typeof c[b].prototype.virtual?c[b].prototype.virtual:!1}var e="undefined"!==typeof a[b].prototype?a[b].prototype.virtual:!1;if(!e||!g)e&&(a[b]=c[b])}else a[b]=c[b];"undefined"!==typeof c.prototype&&"undefined"!==typeof a.prototype&&d.alsoBehavesLike(a.prototype,
c.prototype)};d.error=function(a,c){if("undefined"!==typeof c&&"function"===typeof c.handleError)c.handleError(a);else if("function"===typeof d.handleError)d.handleError(a);else throw a;};var u=function(a){var c=16*Math.random()|0;return("x"==a?c:c&3|8).toString(16)};d.getGuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,u)};d.CONCEPT="concept";d.RELATIONSHIP="relationship";p.prototype._name="Proxy";l.prototype.relate=function(a){"undefined"===typeof this._relatesTo&&(this._relatesTo=
[]);for(var c=!1,d=0;d<this._relatesTo.length;d++)if(this._relatesTo[d]._id==a._id){c=!0;break}c||this._relatesTo.push(a)};k.prototype._name="Behavior";d.Behavior=k;e.prototype._name="Ontology";e.prototype.addTerm=function(a){if("undefined"!==typeof this[a])return this;this._term.prototype.relate=l.prototype.relate;var c=new this._term(a);this[a]=new p(c,this._inferencer);return this};e.prototype.addTerms=function(a){for(var c=0;c<a.length;c++)this.addTerm(a[c])};e.prototype.registerActivator=function(a,
c){"undefined"===typeof c&&(c=[]);null===d.typeMask(a,{fn:"function",namespace:!0,dependencies:!0})?this._activators.push(a):this._activators.push({fn:a,namespace:this.namespace,dependencies:c})};e.prototype.getModel=function(a){var c=new function(){return this},b=[];if("undefined"!==typeof a){b=b.concat(a);for(a=0;a<b.length;a++)if("undefined"===typeof b[a]&&d.error("One or more [behaviors] arguments were supplied to the smallmachine constructor that are 'undefined'; error creating object model"),
"undefined"!==typeof b[a].prototype&&!0===b[a].prototype.initializer)b[a](c)}for(var g in this)if(this.hasOwnProperty(g)&&!("undefined"===typeof this[g]||"undefined"===this[g]._term)&&0!==g.indexOf("_"))if("undefined"!==typeof this[g]._term){c[g]=this[g]._term;for(a=0;a<b.length;a++)d.alsoBehavesLike(Object.getPrototypeOf(c[g]),b[a].prototype)}else c[g]=this[g];this._inferencer._rules.sort(function(a,c){return a._priority-c._priority});for(a=0;a<this._inferencer._rules.length;a++)b=this._inferencer._rules[a],
b._fn.apply(c,b._args);for(a=0;a<this._activators.length;a++)this._activators[a].fn(c);return c};d.Ontology=e;var q=function(a,c,b){this._fn=c;this._args=b;this._priority=a;return this};c.prototype.isA=function(a){this._rules.push(new q(1,r,[this._term._value,a._term._value]));return this};c.prototype.relatesTo=function(a,c){this._rules.push(new q(10,g,[this._term._value,a._term._value,c._term._value]));return this};c.prototype.hasDomain=function(a){this._rules.push(new q(3,t,[this._term._value,a._term._value]));
return this};c.prototype.hasRange=function(a){this._rules.push(new q(2,s,[this._term._value,a._term._value]));return this};c.prototype.alsoBehavesLike=function(c){this._rules.push(new q(20,a,[this._term._value,c]));return this};d.alsoBehavesLike(p,c);d.typeMask=function(a,c){var b=[],d;for(d in c)c.hasOwnProperty(d)&&("undefined"===typeof a||"undefined"===typeof a[d]?b.push(d):"undefined"!==typeof a[d]&&typeof a[d]!==c[d]&&!0!==c[d]&&b.push(d));return 0===b.length?null:b};return d}(smallmachine||
{});(function(d){function b(){return this}function p(){return this}function l(c){this._channel=c;return this}function k(c,a,b){"undefined"===typeof a&&d.error(Error("Parameter 'key' is required when instantiating the sm.NamedValue type"));this.namespace=c;this.key=a;this.value=b;return this}function m(){this._collection={};return this}var e=new d.Ontology("sm.properties");e.addTerm("property");e.addTerm("type");e.addTerm("ontology");e.addTerm("behavior");e.addTerm("hasMemberType");e.addTerm("hasMember");
e.addTerm("Ontology");e.addTerm("Behavior");e.addTerm("Constructor");e.addTerm("Null");e.ontology.isA(e.property);e.behavior.isA(e.property);e.Ontology.isA(e.type);e.Behavior.isA(e.type);e.Constructor.isA(e.type);e.Null.isA(e.type);e.ontology.relatesTo(e.hasMemberType,e.Ontology);e.behavior.relatesTo(e.hasMemberType,e.Behavior);e.ontology.relatesTo(e.hasMember,e.Null);e.behavior.relatesTo(e.hasMember,e.Null);b.prototype.extendedBy=function(c,a){var b=this.hasMemberType;"undefined"===typeof a&&("undefined"===
b?a=c._name:"undefined"!==typeof c.prototype&&(a=c.prototype._name));if("undefined"!==typeof a&&"function"===typeof c)"undefined"!==typeof this[a]?d.alsoBehavesLike(this[a],c):this[a]=c,"undefined"===typeof this[a]._name&&(this[a]._name=a);else{var e=a||c.namespace||c._name;"undefined"===typeof e&&d.error(Error("Cannot call extendedBy on the core ontology with an object that is missing the 'namepsace' and '_name' properties without specifying a 'typeName'"));if("undefined"!==typeof this[e])d.alsoBehavesLike(this[e],
c);else{var l=d[this._value][b._value];"undefined"===typeof l&&d.error(Error("The specified type does not exist in the core object model: "+b._value));var b=c._name||c.constructor.name,p=!1,k;for(k in l)if(l.hasOwnProperty(k)&&0!==k.indexOf("_")&&k===b){this.hasMember[e]=c;this[e]=c;p=!0;break}p||d.error(Error("Did not find an allowed model type for: "+b))}}};p.prototype._name="Null";d.alsoBehavesLike(d,e.getModel(b));d.ontology.extendedBy(new p);d.behavior.extendedBy(new p);l.prototype._name="AsyncResult";
l.prototype.publish=function(c,a){this._channel.publish(c,a);return this};d.type.extendedBy(l);k.prototype.adapt=function(c,a){this.namespace=c;if("undefined"!==typeof a)for(var b=[].concat(a),e=0;e<b.length;e++)d.alsoBehavesLike(this,b[e]);return this};k.prototype._name="NamedValue";d.type.extendedBy(k);m.prototype._name="NamedValueCollection";m.prototype.exists=function(c,a){var b=c;null===d.typeMask(c,{namespace:!0,key:!0})&&(b=c.namespace,a=c.key);return"undefined"!==typeof this._collection[b]&&
"undefined"!==typeof this._collection[b][a]};m.prototype.add=function(c,a,b){var e=c.namespace||c,l=c.key||a;"undefined"!==typeof this._collection[e]&&"undefined"!==this._collection[e][l]&&d.error(Error("Cannot add a new entry to the collection (already exists): ["+e+"]"+l));this.modify(c,a,b);return this};m.prototype.modify=function(c,a,b){var e=c.namespace||c;a=c.key||a;c=c.value||b;"undefined"===typeof a&&d.error(Error("Must supply a valid key"));"undefined"===typeof c&&d.error(Error("Must supply a valid value"));
"undefined"===typeof this._collection[e]&&(this._collection[e]={});this._collection[e][a]=c;return this};m.prototype.remove=function(c,a){if(!("undefined"===typeof this._collection[c]||"undefined"===typeof this._collection[c][a]))return delete this._collection[c][a],this};m.prototype.getValue=function(c,a){var b=c.namespace||c,d=c.key||a;if(!("undefined"===typeof this._collection[b]||"undefined"===this._collection[b][d]))return b=this._collection[b][d],"undefined"!==typeof b&&("function"===typeof c.setValue?
c.setValue(b):"undefined"!==typeof c.value&&(c.value=b)),b};d.type.extendedBy(m)})(smallmachine);(function(d){var b=new d.Ontology("sm.channels");b.addTerm("thing");b.addTerm("all");b.addTerm("user");b.addTerm("system");b.addTerm("action");b.addTerm("task");b.addTerm("initialize");b.addTerm("insert");b.addTerm("remove");b.addTerm("get");b.addTerm("set");b.addTerm("messenger");b.addTerm("success");b.addTerm("error");b.addTerm("performs");b.addTerm("reactsTo");b.all.isA(b.thing);b.user.isA(b.thing);b.user.relatesTo(b.performs,b.action);b.system.isA(b.thing);b.system.relatesTo(b.performs,b.task);
b.messenger.isA(b.thing);b.get.isA(b.task);b.set.isA(b.task);b.success.isA(b.messenger);b.error.isA(b.messenger);b.initialize.isA(b.task);b.insert.isA(b.task);b.remove.isA(b.task);b.performs.hasRange(b.action).hasRange(b.task);b.reactsTo.hasRange(b.action).hasDomain(b.system);b.registerActivator(function(b){function p(a,c,e){if("undefined"!==typeof jQuery)try{jQuery.ajax({dataType:"json",url:a,type:"GET",success:function(c,p,f){b.messenger.success.publish(p);e.publish(new d.type.NamedValue("sm.channels",
a,c))},error:function(a,b,e){c?c(a,b,e):d.error(Error(e))}})}catch(k){d.error(Error(k))}else{var m=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP.3.0");m.onprogress=function(){};m.onerror={};m.onreadystatechange=function(){4>m.readyState||(200==m.status?(b.messenger.success.publish(m.statusText),e.publish(new d.type.NamedValue("sm.channels",a,JSON.parse(m.responseText)))):d.error(Error(m.statusText)))};m.open("GET",a,!0);m.setRequestHeader("X-Requested-With","XMLHttpRequest");
m.setRequestHeader("Content-type","application/json");m.send(null)}return e}var m={update:function(a){return"undefined"!==typeof a.key&&"undefined"!==typeof a.namespace?function(a){b.memory.modify(a)}:!1}};d.alsoBehavesLike(b,{memory:new d.type.NamedValueCollection});b.set.subscribe({update:function(a){return m}});var e={update:function(a){return"undefined"!==typeof a.key&&"undefined"!==typeof a.namespace?function(a){b.memory.getValue(a)}:!1}};b.get.subscribe({update:function(a){return e}});"function"===
typeof b.initialize.addHelper&&b.initialize.addHelper("json",p,2);"function"===typeof b.set.addHelper&&b.set.addHelper("config",function(a){return new d.type.NamedValue("sm.channels","config",a)});if("function"===typeof b.get.addHelper){b.get.addHelper("json",p,2);var c=function(){this.namespace="sm.channels";this.key="config";return this};c.prototype._name="Config";c.prototype.setValue=function(a){d.alsoBehavesLike(this,a)};d.type.extendedBy(c);b.get.addHelper("config",function(a){return a})}});
try{d.ontology.extendedBy(b)}catch(p){d.error(Error("Could not extend the smallmachine.ontology property with the 'sm.channels' ontology: "+p.message+"\n"+p.stack))}})(smallmachine);(function(d){function b(b,d){this._value=b;this._type=d;return this}b.prototype._name="Channel";b.prototype.backchannel=function(b){"undefined"===typeof this._backchannels&&(this._backchannels=[]);this._backchannels.push(b)};b.prototype.forward=function(b,d){null!=this._value&&(d[this._value]=!0);for(var k in this)if(this.hasOwnProperty(k)&&!("function"===typeof this[k]||0===k.indexOf("_"))&&!0!==d[k]&&"function"===typeof this[k].publish)d[k]=!0,this[k].publish(b,d);if("undefined"!==typeof this._relatesTo)for(k=
0;k<this._relatesTo.length;k++)"undefined"!==typeof this._relatesTo[k]._subscribers&&this.notify(b,this._relatesTo[k]._subscribers)};b.prototype.unsubscribe=function(b){"undefined"!==typeof this._subscribers&&delete this._subscribers[b]};b.prototype.subscribe=function(b){"undefined"===typeof this._subscribers&&(this._subscribers={});var l=d.getGuid();"function"===typeof b?this._subscribers[l]={update:b,lifetime:1}:("undefined"===typeof b.lifetime&&(b.lifetime=1),this._subscribers[l]=b);return l};
b.prototype.notify=function(b,l){var k=!1,m={},e=0,c=[],a;for(a in l){var g=l[a].update(b);"undefined"!==typeof l[a]&&(0>=l[a].lifetime&&this.unsubscribe(a),!0===g?k=!0:"function"===typeof g?(c.push(g),k=!0):g&&"function"===typeof g.update&&(m[d.getGuid()]=g,e++))}if(k){a=0===c.length;for(g=0;g<c.length;g++)!1===!c[g](b)&&(a=!0);!1===a&&(k=!1)}!1==k&&0<e&&this.notify(b,m)};b.prototype.publish=function(b,l){l=l||{};if("function"===typeof b&&(b=b(new d.type.AsyncResult(this)),"undefined"!==typeof b&&
"undefined"!==typeof b._channel&&"function"===typeof b.publish))return this;if("undefined"!==typeof this._backchannels)for(var k=0,m=this._backchannels.length;k<m;k++){var e=this._backchannels[k];e.notify({value:this._value,id:this._id,message:b},e._subscribers)}if("undefined"===typeof this._subscribers)return this.forward(b,l),this;this.notify(b,this._subscribers);this.forward(b,l);return this};b.prototype.addHelper=function(d,l,k){var m=b.prototype.publish,e=this;this[d]=function(){for(var b=[],
a=0;a<arguments.length;a++)b.push(arguments[a]);if("undefined"!==typeof k)for(a=0;a<k-b.length;a++)b.push(null);return m.apply(e,[function(a){b.push(a);return l.apply(e,b)}])};return this};d.behavior.extendedBy(b)})(smallmachine);(function(d,b){function p(d){"undefined"!==typeof b.fn&&(b.fn.subscribe=function(b,d){return this.each(function(){var e=this;b.subscribe(function(b){e.subscriber=this;d.apply(e,[b])})})});return this}p.prototype._name="ChannelExtension";p.prototype.initializer=!0;d.behavior.extendedBy(p)})(smallmachine,jQuery||{});
