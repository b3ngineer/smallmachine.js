var smallmachine=function(d){"function"!==typeof Object.getPrototypeOf&&(Object.getPrototypeOf="object"===typeof"test".__proto__?function(b){return b.__proto__}:function(b){return b.constructor.prototype});var a=function(b,e){for(var c=0;c<e.dependencies.length;c++){for(var l=!1,f=0;f<b.length;f++)if(e.dependencies[c]==b[f].title){l=!0;break}if(!l)return e.dependencies[c]}return null};d=function(b,e){if("undefined"===typeof b)throw Error("Missing required parameter for smallmachine constructor: one or more instances of type [object Ontology]");
for(var c=[].concat(b),l="",f=0;f<c.length;f++)"function"!==typeof c[f].ofType||!c[f].ofType("Ontology")?"undefined"!==typeof d.ontology[c[f]]&&(l=l+c[f]+",",c[f]=d.ontology[c[f]]):l+=c[f].title;l=new d.Ontology(l.substring(0,l.length-1));for(f=0;f<c.length;f++){for(var g in c[f])c[f].hasOwnProperty(g)&&"function"===typeof c[f][g].ofType&&c[f][g].ofType("Proxy")&&l.addTerm(c[f][g]._term._value);for(var n=0;n<c[f]._inferencer._rules.length;n++)l._inferencer._rules.push(c[f]._inferencer._rules[n]);
for(n=0;n<c[f]._activators.length;n++){var h=a(c,c[f]._activators[n]);if(null!==h)throw Error("Cannot wire-in ontology with missing activator dependency on '"+h+"'");l.registerActivator(c[f]._activators[n]);l._activators.sort(function(b,c){if(b.title==c.title)return 0;for(var e=0;e<b.dependencies.length;e++)if(c.title==b.dependencies[e])return 1;for(e=0;e<c.dependencies.length;e++)if(b.title==c.dependencies[e])return-1;return 0})}}return l.getModel(e)};d.alsoBehavesLike=function(b,e){if("undefined"===
typeof b||"undefined"===typeof e)throw Error("Cannot mixin with an undefined object");for(var c in e)if(e.hasOwnProperty(c)&&0!=c.indexOf("_"))if("undefined"!==typeof b[c]){var l="undefined"!==typeof b[c].prototype?b[c].prototype.virtual:!1,g="undefined"!==typeof e[c].prototype?e[c].prototype.virtual:!1;if(!l||!g)l&&(b[c]=e[c])}else b[c]=e[c];"undefined"!==typeof e.prototype&&("undefined"===typeof b.prototype&&(b.prototype={}),d.alsoBehavesLike(b.prototype,e.prototype))};d.CONCEPT="concept";d.RELATIONSHIP=
"relationship";var p=function(b,e){this._term=b;this._rules=e._rules;return this};p.prototype.getType=function(){return"[object Proxy]"};p.prototype.ofType=function(b){return"Proxy"===b||"function"===typeof b.getType&&b.getType()===this.getType()};var m=function(){return this};m.prototype.relate=function(b){"undefined"===typeof this._relatesTo&&(this._relatesTo=[]);for(var e=!1,c=0;c<this._relatesTo.length;c++)if(this._relatesTo[c]._id==b._id){e=!0;break}e||this._relatesTo.push(b)};m.prototype.getType=
function(){return"[object Term]"};m.prototype.ofType=function(b){return"Term"===b||"function"===typeof b.getType&&b.getType()===this.getType()};d.Behavior=function(b){this.title=b;return this};d.Ontology=function(b){this.title=b;this._inferencer=new g;this._activators=[];this._term=function(b){this._id=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(b){var e=16*Math.random()|0;return("x"==b?e:e&3|8).toString(16)})}();"undefined"!==typeof b._value&&"undefined"!==typeof b._type?
(this._value=b._value,this._type=b._type):(this._value=b,this._type=null);return this};return this};d.Ontology.prototype.getType=function(){return"[object Ontology]"};d.Ontology.prototype.addTerm=function(b){if("undefined"!==typeof this[b])return this;var e=this._term;e.prototype.relate=m.prototype.relate;e.prototype.getType=m.prototype.getType;e.prototype.ofType=m.prototype.ofType;e=new e(b);this[b]=new p(e,this._inferencer);return this};d.Ontology.prototype.registerActivator=function(b,e){"undefined"===
typeof e&&(e=[]);"function"!==typeof b&&"function"===typeof b.getType&&"[object Activator]"===b.getType()?this._activators.push(b):this._activators.push({fn:b,title:this.title,dependencies:e,getType:function(){return"[object Activator]"}})};d.Ontology.prototype.getModel=function(b){var e=new function(b){return this},c;for(c in this)if(this.hasOwnProperty(c)&&!("undefined"===typeof this[c]||"undefined"===this[c]._term)&&0!==c.indexOf("_"))if("undefined"!==typeof this[c]._term){if(e[c]=this[c]._term,
"undefined"!==typeof b)for(var g=[].concat(b),f=0;f<g.length;f++)d.alsoBehavesLike(Object.getPrototypeOf(e[c]),g[f].prototype)}else e[c]=this[c];this._inferencer._rules.sort(function(b,c){return b._priority-c._priority});for(f=0;f<this._inferencer._rules.length;f++)b=this._inferencer._rules[f],b._fn.apply(e,b._args);for(f=0;f<this._activators.length;f++)this._activators[f].fn(e);return e};var g=function(){this._term={_value:null};this._rules=[];return this},n=function(b,e,c){this._fn=e;this._args=
c;this._priority=b;return this};g.prototype.isA=function(b){this._rules.push(new n(1,k,[this._term._value,b._term._value]));return this};g.prototype.relatesTo=function(b,e){this._rules.push(new n(10,h,[this._term._value,b._term._value,e._term._value]));return this};g.prototype.hasDomain=function(b){this._rules.push(new n(3,q,[this._term._value,b._term._value]));return this};g.prototype.hasRange=function(b){this._rules.push(new n(2,r,[this._term._value,b._term._value]));return this};d.alsoBehavesLike(p,
g);var h=function(b,e,c){b=this[b];var g=this[e],f=this[c];if(g._type===d.CONCEPT)throw Error("Cannot define a relationship with a concept type: "+g._value);null===g._type&&(g._type=d.RELATIONSHIP);if(f._type===d.RELATIONSHIP)throw Error("Cannot create a relationship with a relationship type: "+f._value);null===f._type&&(f._type=d.CONCEPT);if(b._type===d.RELATIONSHIP)throw Error("Cannot create a relationship from a relationship type: "+b._value);null===b._type&&(b._type=d.CONCEPT);"undefined"===typeof b[e]&&
(b[e]=new b.constructor(g));"undefined"===typeof b[e][c]&&(b[e][c]=f);"undefined"===typeof b[c]&&(b[c]=f);f.relate(b[e]);for(var a in f)f.hasOwnProperty(a)&&(f[a].getType&&"[object Term]"===f[a].getType())&&("undefined"===typeof b[e][a]&&(b[e][a]=f[a]),"undefined"===typeof b[a]&&(b[a]=f[a]),f[a].relate(b[e]))},k=function(b,e){var c=this[b],g=this[e];if(g._type===d.RELATIONSHIP)throw Error("Cannot apply isA to a relationship type: "+g._value);null===g._type&&(g._type=d.CONCEPT);if(c._type===d.RELATIONSHIP)throw Error("Cannot apply isA to a relationship type: "+
c._value);null===c._type&&(c._type=d.CONCEPT);"undefined"===typeof g[b]&&(g[b]=c)},r=function(b,g){var c=this[b],a=this[g];if(a._type===d.RELATIONSHIP)throw Error("Cannot apply hasRange to a relationship type: "+a._value);null===a._type&&(a._type=d.CONCEPT);if(c._type===d.CONCEPT)throw Error("Cannot assign hasRange from a concept type: "+c._value);null===c._type&&(c._type=d.RELATIONSHIP);"undefined"===typeof c[g]&&(c[g]=a);a.relate(c);for(var f in a)if(a.hasOwnProperty(f)&&a[f].getType&&"[object Term]"===
a[f].getType()){var n=a[f]._value;"undefined"===typeof c[n]&&(c[n]=a[f]);a[f].relate(c)}},q=function(b,g){var c=this[b],a=this[g];if(a._type===d.RELATIONSIP)throw Error("Cannot apply hasRange to a relationship type: "+a._value);null===a._type&&(a._type=d.CONCEPT);if(c._type===d.CONCEPT)throw Error("Cannot assign hasRange from a concept type: "+c._value);null===c._type&&(c._type=d.RELATIONSHIP);"undefined"===typeof a[b]&&(a[b]=c)};d.typeMask=function(b,g){var c=[],a;for(a in g)g.hasOwnProperty(a)&&
(!0===g[a]?"undefined"===typeof b[a]&&c.push(a):"undefinedf"!==typeof b[a]&&typeof b[a]!==g[a]&&c.push(a));return 0===c.length?null:c};return d}(smallmachine||{});(function(d){var a=new d.Ontology("sm.properties");a.addTerm("property");a.addTerm("type");a.addTerm("ontology");a.addTerm("behavior");a.addTerm("hasMemberType");a.addTerm("hasMember");a.addTerm("Ontology");a.addTerm("Behavior");a.addTerm("Constructor");a.addTerm("Null");a.ontology.isA(a.property);a.behavior.isA(a.property);a.Ontology.isA(a.type);a.Behavior.isA(a.type);a.Constructor.isA(a.type);a.Null.isA(a.type);a.ontology.relatesTo(a.hasMemberType,a.Ontology);a.behavior.relatesTo(a.hasMemberType,
a.Behavior);a.ontology.relatesTo(a.hasMember,a.Null);a.behavior.relatesTo(a.hasMember,a.Null);var p=function(){return this};p.prototype.extendedBy=function(g,a){if("undefined"!==typeof a&&"function"===typeof g)"undefined"!==typeof this[a]?d.alsoBehavesLike(this[a],g):this[a]=g,"function"!==typeof this[a].prototype.getType&&(this[a].prototype.getType=function(){return"[object "+a+"]"}),"function"!==typeof this[a].prototype.ofType&&(this[a].prototype.ofType=function(b){return"function"===typeof b.getType?
this.getType()===b.getType():this.getType()==="[object "+b+"]"});else{var h=a||g.title;if("undefined"===typeof h)throw Error("Cannot call extendedBy on the core ontology with an object that is missing the 'title' property without specifying a 'typeName'");if("undefined"!==typeof this[h])d.alsoBehavesLike(this[h],g);else{var k=this.hasMemberType;if("undefined"===typeof k||"undefined"===typeof k.getType)throw Error("The specified concept does not have a valid 'hasMemberType' relationship with another concept");
var m=d[this._value][k._value];if("undefined"===typeof m)throw Error("The specified type does not exist in the core object model: "+k._value);if("function"!==typeof g.getType)throw Error("The specified model is missing the getType function: "+h);var k=g.getType(),p=!1,b;for(b in m)if(m.hasOwnProperty(b)&&"undefined"!==typeof this[b].getType&&"[object "+b+"]"===k){this.hasMember[h]=g;this[h]=g;p=!0;break}if(!p)throw Error("Did not find an allowed model type for: "+k);}}};var m=function(){this.title=
"Null";return this};m.prototype.getType=function(){return"[object Null]"};m.prototype.ofType=function(a){return null===a||"null"===a||"Null"===a?!0:!1};d.alsoBehavesLike(d,a.getModel(p));d.ontology.extendedBy(new m);d.behavior.extendedBy(new m);a=function(a){this._channel=a;return this};a.prototype.publish=function(a,d){this._channel.publish(a,d);return this};d.type.extendedBy(a,"AsyncResult");d.type.extendedBy(function(a,d,h){if("undefined"===typeof d)throw Error("Parameter 'key' is required when instantiating the sm.NamedValue type");
this.namespace=a;this.key=d;this.value=h;return this},"NamedValue");a=function(){this.title="NamedValueCollection";this._collection={};return this};a.prototype.exists=function(a,d){var h=a;"function"===typeof a.ofType&&a.ofType("NamedValue")&&(h=a.namespace,d=a.key);return"undefined"!==typeof this._collection[h]&&"undefined"!==typeof this._collection[h][d]};a.prototype.add=function(a,d,h){var k=a.namespace||a,m=a.key||d;if("undefined"!==typeof this._collection[k]&&"undefined"!==this._collection[k][m])throw Error("Cannot add a new entry to the collection (already exists): ["+
k+"]"+m);this.modify(a,d,h);return this};a.prototype.modify=function(a,d,h){var k=a.namespace||a;d=a.key||d;a=a.value||h;if("undefined"===typeof d)throw Error("Must supply a valid key");if("undefined"===typeof a)throw Error("Must supply a valid value");"undefined"===typeof this._collection[k]&&(this._collection[k]={});this._collection[k][d]=a;return this};a.prototype.remove=function(a,d){if(!("undefined"===typeof this._collection[a]||"undefined"===typeof this._collection[a][d]))return delete this._collection[a][d],
this};a.prototype.getValue=function(a,d){var h=a.namespace||a,k=a.key||d;if(!("undefined"===typeof this._collection[h]||"undefined"===this._collection[h][k]))return h=this._collection[h][k],"function"===typeof a.ofType&&a.ofType("NamedValue")&&"undefined"!==typeof h&&(a.value=h),h};a.prototype.ofType=function(a){return"NamedValueCollection"===a||"function"===typeof a.getType&&a.getType()===this.getType()};d.type.extendedBy(a,"NamedValueCollection")})(smallmachine);
