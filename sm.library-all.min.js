var smallmachine=function(f){function e(a,b){for(var c=0;c<b.dependencies.length;c++){for(var d=!1,f=0;f<a.length;f++)if(b.dependencies[c]==a[f].namespace){d=!0;break}if(!d)return b.dependencies[c]}return null}function l(a,b){this._term=a;this._rules=b._rules;return this}function k(){return this}function g(){return this}function m(a){this._id=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"==a?b:b&3|8).toString(16)})}();"undefined"!==
typeof a._value&&"undefined"!==typeof a._type?(this._value=a._value,this._type=a._type):(this._value=a,this._type=null);return this}function a(a){this.namespace=a;this._inferencer=new c;this._activators=[];this._term=m;return this}function c(){this._term={_value:null};this._rules=[];return this}function b(a,b){var c=this[a];"function"===typeof b?f.alsoBehavesLike(c,b.prototype):f.alsoBehavesLike(c,b);for(var d in c)c.hasOwnProperty(d)&&0!==d.indexOf("_")&&"undefined"!==typeof c[d]._type&&c[d]._type===
f.CONCEPT&&("function"===typeof b?f.alsoBehavesLike(c[d],b.prototype):f.alsoBehavesLike(c[d],b))}function d(a,b,c){a=this[a];var d=this[b],h=this[c];d._type===f.CONCEPT?f.error(Error("Cannot define a relationship with a concept type: "+d._value)):null===d._type&&(d._type=f.RELATIONSHIP);h._type===f.RELATIONSHIP?f.error(Error("Cannot create a relationship with a relationship type: "+h._value)):null===h._type&&(h._type=f.CONCEPT);a._type===f.RELATIONSHIP?f.error(Error("Cannot create a relationship from a relationship type: "+
a._value)):null===a._type&&(a._type=f.CONCEPT);"undefined"===typeof a[b]&&(a[b]=new a.constructor(d));"undefined"===typeof a[b][c]&&(a[b][c]=h);"undefined"===typeof a[c]&&(a[c]=h);h.relate(a[b]);for(var e in h)h.hasOwnProperty(e)&&"function"===typeof h[e].relate&&("undefined"===typeof a[b][e]&&(a[b][e]=h[e]),"undefined"===typeof a[e]&&(a[e]=h[e]),h[e].relate(a[b]))}function n(a,b){var c=this[a],d=this[b];d._type===f.RELATIONSHIP?f.error(Error("Cannot apply isA to a relationship type: "+d._value)):
null===d._type&&(d._type=f.CONCEPT);c._type===f.RELATIONSHIP?f.error(Error("Cannot apply isA to a relationship type: "+c._value)):null===c._type&&(c._type=f.CONCEPT);"undefined"===typeof d[a]&&(d[a]=c)}function p(a,b){var c=this[a],d=this[b];d._type===f.RELATIONSHIP?f.error(Error("Cannot apply hasRange to a relationship type: "+d._value)):null===d._type&&(d._type=f.CONCEPT);c._type===f.CONCEPT?f.error(Error("Cannot assign hasRange from a concept type: "+c._value)):null===c._type&&(c._type=f.RELATIONSHIP);
"undefined"===typeof c[b]&&(c[b]=d);d.relate(c);for(var h in d)if(d.hasOwnProperty(h)&&"function"===typeof d[h].relate){var e=d[h]._value||null;null!==e&&("undefined"===typeof c[e]&&(c[e]=d[h]),d[h].relate(c))}}function h(a,c){var b=this[a],d=this[c];d._type===f.RELATIONSIP?f.error(Error("Cannot apply hasRange to a relationship type: "+d._value)):null===d._type&&(d._type=f.CONCEPT);b._type===f.CONCEPT?f.error(Error("Cannot assign hasRange from a concept type: "+b._value)):null===b._type&&(b._type=
f.RELATIONSHIP);"undefined"===typeof d[a]&&(d[a]=b)}"function"!==typeof Object.getPrototypeOf&&(Object.getPrototypeOf="object"===typeof"test".__proto__?function(a){return a.__proto__}:function(a){return a.constructor.prototype});f=function(b,c){"undefined"===typeof b&&f.error(Error("Missing required parameter for smallmachine constructor: one or more instances of type 'Ontology'"));for(var d=[].concat(b),h="",n=0;n<d.length;n++)"undefined"===typeof d[n]&&f.error(Error("Element "+n+" of the ontologies argument passed to the smallmachine constructor is undefined")),
"undefined"===typeof d[n].namespace?"undefined"!==typeof f.ontology[d[n]]&&(h=h+d[n]+",",d[n]=f.ontology[d[n]]):h=h+d[n].namespace+",";h=new a(h.substring(0,h.length-1));for(n=0;n<d.length;n++){for(var k in d[n])d[n].hasOwnProperty(k)&&"undefined"!==typeof d[n][k]._name&&"Proxy"==d[n][k]._name&&h.addTerm(d[n][k]._term._value);for(var g=0;g<d[n]._inferencer._rules.length;g++)h._inferencer._rules.push(d[n]._inferencer._rules[g]);for(g=0;g<d[n]._activators.length;g++){var q=e(d,d[n]._activators[g]);
null!==q&&f.error(Error("Cannot wire-in ontology with missing activator dependency on '"+q+"'"));h.registerActivator(d[n]._activators[g]);h._activators.sort(function(a,b){if(a.namespace==b.namespace)return 0;for(var c=0;c<a.dependencies.length;c++)if(b.namespace==a.dependencies[c])return 1;for(c=0;c<b.dependencies.length;c++)if(a.namespace==b.dependencies[c])return-1;return 0})}}return h.getModel(c)};f.alsoBehavesLike=function(a,b){("undefined"===typeof a||"undefined"===typeof b)&&f.error(Error("Cannot mixin with an undefined object"));
for(var c in b)if(b.hasOwnProperty(c)&&!(0==c.indexOf("_")||"initializer"===c))if("undefined"!==typeof a[c]){if("undefined"!==typeof b[c].prototype){if("undefined"!==typeof b[c].prototype.initializer&&!0==b[c].prototype.initializer)continue;var d="undefined"!==typeof b[c].prototype.virtual?b[c].prototype.virtual:!1}var h="undefined"!==typeof a[c].prototype?a[c].prototype.virtual:!1;if(!h||!d)h&&(a[c]=b[c])}else a[c]=b[c];"undefined"!==typeof b.prototype&&"undefined"!==typeof a.prototype&&f.alsoBehavesLike(a.prototype,
b.prototype)};f.error=function(a,c){if("undefined"!==typeof c&&"function"===typeof c.handleError)c.handleError(a);else if("function"===typeof f.handleError)f.handleError(a);else throw a;};var q=function(a){var c=16*Math.random()|0;return("x"==a?c:c&3|8).toString(16)};f.getGuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,q)};f.CONCEPT="concept";f.RELATIONSHIP="relationship";l.prototype._name="Proxy";k.prototype.relate=function(a){"undefined"===typeof this._relatesTo&&(this._relatesTo=
[]);for(var c=!1,b=0;b<this._relatesTo.length;b++)if(this._relatesTo[b]._id==a._id){c=!0;break}c||this._relatesTo.push(a)};g.prototype._name="Behavior";f.Behavior=g;a.prototype._name="Ontology";a.prototype.addTerm=function(a){if("undefined"!==typeof this[a])return this;this._term.prototype.relate=k.prototype.relate;var c=new this._term(a);this[a]=new l(c,this._inferencer);return this};a.prototype.addTerms=function(a){for(var c=0;c<a.length;c++)this.addTerm(a[c])};a.prototype.registerActivator=function(a,
c){"undefined"===typeof c&&(c=[]);null===f.typeMask(a,{fn:"function",namespace:!0,dependencies:!0})?this._activators.push(a):this._activators.push({fn:a,namespace:this.namespace,dependencies:c})};a.prototype.getModel=function(a){var c=new function(){return this},b=[];if("undefined"!==typeof a){b=b.concat(a);for(a=0;a<b.length;a++)if("undefined"===typeof b[a]&&f.error("One or more [behaviors] arguments were supplied to the smallmachine constructor that are 'undefined'; error creating object model"),
"undefined"!==typeof b[a].prototype&&!0===b[a].prototype.initializer)b[a](c)}for(var d in this)if(this.hasOwnProperty(d)&&!("undefined"===typeof this[d]||"undefined"===this[d]._term)&&0!==d.indexOf("_"))if("undefined"!==typeof this[d]._term){c[d]=this[d]._term;for(a=0;a<b.length;a++)f.alsoBehavesLike(Object.getPrototypeOf(c[d]),b[a].prototype)}else c[d]=this[d];this._inferencer._rules.sort(function(a,c){return a._priority-c._priority});for(a=0;a<this._inferencer._rules.length;a++)b=this._inferencer._rules[a],
b._fn.apply(c,b._args);for(a=0;a<this._activators.length;a++)this._activators[a].fn(c);return c};f.Ontology=a;var r=function(a,c,b){this._fn=c;this._args=b;this._priority=a;return this};c.prototype.isA=function(a){this._rules.push(new r(1,n,[this._term._value,a._term._value]));return this};c.prototype.relatesTo=function(a,c){this._rules.push(new r(10,d,[this._term._value,a._term._value,c._term._value]));return this};c.prototype.hasDomain=function(a){this._rules.push(new r(3,h,[this._term._value,a._term._value]));
return this};c.prototype.hasRange=function(a){this._rules.push(new r(2,p,[this._term._value,a._term._value]));return this};c.prototype.alsoBehavesLike=function(a){this._rules.push(new r(20,b,[this._term._value,a]));return this};f.alsoBehavesLike(l,c);f.typeMask=function(a,c){var b=[],d;for(d in c)c.hasOwnProperty(d)&&("undefined"===typeof a||"undefined"===typeof a[d]?b.push(d):"undefined"!==typeof a[d]&&typeof a[d]!==c[d]&&!0!==c[d]&&b.push(d));return 0===b.length?null:b};return f}(smallmachine||
{});(function(f){function e(){return this}function l(){return this}function k(a){this._channel=a;return this}function g(a,b,d){"undefined"===typeof b&&f.error(Error("Parameter 'key' is required when instantiating the sm.NamedValue type"));this.namespace=a;this.key=b;this.value=d;return this}function m(){this._collection={};return this}var a=new f.Ontology("sm.properties");a.addTerm("property");a.addTerm("type");a.addTerm("ontology");a.addTerm("behavior");a.addTerm("hasMemberType");a.addTerm("hasMember");
a.addTerm("Ontology");a.addTerm("Behavior");a.addTerm("Constructor");a.addTerm("Null");a.ontology.isA(a.property);a.behavior.isA(a.property);a.Ontology.isA(a.type);a.Behavior.isA(a.type);a.Constructor.isA(a.type);a.Null.isA(a.type);a.ontology.relatesTo(a.hasMemberType,a.Ontology);a.behavior.relatesTo(a.hasMemberType,a.Behavior);a.ontology.relatesTo(a.hasMember,a.Null);a.behavior.relatesTo(a.hasMember,a.Null);e.prototype.extendedBy=function(a,b){var d=this.hasMemberType;"undefined"===typeof b&&("undefined"===
d?b=a._name:"undefined"!==typeof a.prototype&&(b=a.prototype._name));if("undefined"!==typeof b&&"function"===typeof a)"undefined"!==typeof this[b]?f.alsoBehavesLike(this[b],a):this[b]=a,"undefined"===typeof this[b]._name&&(this[b]._name=b);else{var e=b||a.namespace||a._name;"undefined"===typeof e&&f.error(Error("Cannot call extendedBy on the core ontology with an object that is missing the 'namepsace' and '_name' properties without specifying a 'typeName'"));if("undefined"!==typeof this[e])f.alsoBehavesLike(this[e],
a);else{var k=f[this._value][d._value];"undefined"===typeof k&&f.error(Error("The specified type does not exist in the core object model: "+d._value));var d=a._name||a.constructor.name,h=!1,g;for(g in k)if(k.hasOwnProperty(g)&&0!==g.indexOf("_")&&g===d){this.hasMember[e]=a;this[e]=a;h=!0;break}h||f.error(Error("Did not find an allowed model type for: "+d))}}};l.prototype._name="Null";f.alsoBehavesLike(f,a.getModel(e));f.ontology.extendedBy(new l);f.behavior.extendedBy(new l);k.prototype._name="AsyncResult";
k.prototype.publish=function(a,b){this._channel.publish(a,b);return this};f.type.extendedBy(k);g.prototype.adapt=function(a,b){this.namespace=a;if("undefined"!==typeof b)for(var d=[].concat(b),e=0;e<d.length;e++)f.alsoBehavesLike(this,d[e]);return this};g.prototype._name="NamedValue";f.type.extendedBy(g);m.prototype._name="NamedValueCollection";m.prototype.exists=function(a,b){var d=a;null===f.typeMask(a,{namespace:!0,key:!0})&&(d=a.namespace,b=a.key);return"undefined"!==typeof this._collection[d]&&
"undefined"!==typeof this._collection[d][b]};m.prototype.add=function(a,b,d){var e=a.namespace||a,k=a.key||b;"undefined"!==typeof this._collection[e]&&"undefined"!==this._collection[e][k]&&f.error(Error("Cannot add a new entry to the collection (already exists): ["+e+"]"+k));this.modify(a,b,d);return this};m.prototype.modify=function(a,b,d){var e=a.namespace||a;b=a.key||b;a=a.value||d;"undefined"===typeof b&&f.error(Error("Must supply a valid key"));"undefined"===typeof a&&f.error(Error("Must supply a valid value"));
"undefined"===typeof this._collection[e]&&(this._collection[e]={});this._collection[e][b]=a;return this};m.prototype.remove=function(a,b){if(!("undefined"===typeof this._collection[a]||"undefined"===typeof this._collection[a][b]))return delete this._collection[a][b],this};m.prototype.getValue=function(a,b){var d=a.namespace||a,f=a.key||b;if(!("undefined"===typeof this._collection[d]||"undefined"===this._collection[d][f]))return d=this._collection[d][f],"undefined"!==typeof d&&("function"===typeof a.setValue?
a.setValue(d):"undefined"!==typeof a.value&&(a.value=d)),d};f.type.extendedBy(m)})(smallmachine);(function(f){var e=new f.Ontology("sm.channels");e.addTerm("thing");e.addTerm("user");e.addTerm("system");e.addTerm("action");e.addTerm("click");e.addTerm("doubleClick");e.addTerm("keyPress");e.addTerm("task");e.addTerm("initialize");e.addTerm("insert");e.addTerm("remove");e.addTerm("get");e.addTerm("set");e.addTerm("messenger");e.addTerm("success");e.addTerm("error");e.addTerm("performs");e.addTerm("reactsTo");e.user.isA(e.thing);e.user.relatesTo(e.performs,e.action);e.system.isA(e.thing);e.system.relatesTo(e.performs,
e.task);e.messenger.isA(e.thing);e.click.isA(e.action);e.doubleClick.isA(e.action);e.keyPress.isA(e.action);e.get.isA(e.task);e.set.isA(e.task);e.success.isA(e.messenger);e.error.isA(e.messenger);e.initialize.isA(e.task);e.insert.isA(e.task);e.remove.isA(e.task);e.performs.hasRange(e.action).hasRange(e.task);e.reactsTo.hasRange(e.action).hasDomain(e.system);e.registerActivator(function(e){function g(a,c,n){if("undefined"!==typeof jQuery)try{jQuery.ajax({dataType:"json",url:a,type:"GET",success:function(c,
d,h){e.messenger.success.publish(d);n.publish(new f.type.NamedValue("sm.channels",a,c))},error:function(a,b,h){c?c(a,b,h):f.error(Error(h))}})}catch(g){f.error(Error(g))}else{var h=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP.3.0");h.onprogress=function(){};h.onerror={};h.onreadystatechange=function(){4>h.readyState||(200==h.status?(e.messenger.success.publish(h.statusText),n.publish(new f.type.NamedValue("sm.channels",a,JSON.parse(h.responseText)))):f.error(Error(h.statusText)))};
h.open("GET",a,!0);h.setRequestHeader("X-Requested-With","XMLHttpRequest");h.setRequestHeader("Content-type","application/json");h.send(null)}return n}var l={update:function(a){return"undefined"!==typeof a.key&&"undefined"!==typeof a.namespace?function(a){e.memory.modify(a)}:!1}};f.alsoBehavesLike(e,{memory:new f.type.NamedValueCollection});e.set.subscribe({update:function(a){return l}});var a={update:function(a){return"undefined"!==typeof a.key&&"undefined"!==typeof a.namespace?function(a){e.memory.getValue(a)}:
!1}};e.get.subscribe({update:function(b){return a}});"function"===typeof e.initialize.addHelper&&e.initialize.addHelper("json",g,2);"function"===typeof e.set.addHelper&&e.set.addHelper("config",function(a){return new f.type.NamedValue("sm.channels","config",a)});if("function"===typeof e.get.addHelper){e.get.addHelper("json",g,2);var c=function(){this.namespace="sm.channels";this.key="config";return this};c.prototype._name="Config";c.prototype.setValue=function(a){f.alsoBehavesLike(this,a)};f.type.extendedBy(c);
e.get.addHelper("config",function(a){return a})}});try{f.ontology.extendedBy(e)}catch(l){f.error(Error("Could not extend the smallmachine.ontology property with the 'sm.channels' ontology: "+l.message+"\n"+l.stack))}})(smallmachine);(function(f){function e(e,f){this._value=e;this._type=f;return this}e.prototype._name="Channel";e.prototype.forward=function(e,f){null!=this._value&&(f[this._value]=!0);for(var g in this)if(this.hasOwnProperty(g)&&!("function"===typeof this[g]||0===g.indexOf("_"))&&!0!==f[g]&&"function"===typeof this[g].publish)f[g]=!0,this[g].publish(e,f);if("undefined"!==typeof this._relatesTo)for(g=0;g<this._relatesTo.length;g++)"undefined"!==typeof this._relatesTo[g]._subscribers&&this.notify(e,this._relatesTo[g]._subscribers)};
e.prototype.unsubscribe=function(e){"undefined"!==typeof this._subscribers&&delete this._subscribers[e]};e.prototype.subscribe=function(e){"undefined"===typeof this._subscribers&&(this._subscribers={});var k=f.getGuid();"function"===typeof e?this._subscribers[k]={update:e,lifetime:1}:("undefined"===typeof e.lifecycle&&(e.lifetime=1),this._subscribers[k]=e);return k};e.prototype.notify=function(e,k){var g=!1,m={},a=0,c=[],b;for(b in k){var d=k[b].update(e);"undefined"!==typeof k[b]&&(0>=k[b].lifetime&&
this.unsubscribe(b),!0===d?g=!0:"function"===typeof d?(c.push(d),g=!0):d&&"function"===typeof d.update&&(m[f.getGuid()]=d,a++))}if(g){b=0===c.length;for(d=0;d<c.length;d++)!1===!c[d](e)&&(b=!0);!1===b&&(g=!1)}!1==g&&0<a&&this.notify(e,m)};e.prototype.publish=function(e,k){k=k||{};if("function"===typeof e&&(e=e(new f.type.AsyncResult(this)),"undefined"!==typeof e&&"undefined"!==typeof e._channel&&"function"===typeof e.publish))return this;if("undefined"===typeof this._subscribers)return this.forward(e,
k),this;this.notify(e,this._subscribers);this.forward(e,k);return this};e.prototype.addHelper=function(f,k,g){var m=e.prototype.publish,a=this;this[f]=function(){for(var c=[],b=0;b<arguments.length;b++)c.push(arguments[b]);if("undefined"!==typeof g)for(b=0;b<g-c.length;b++)c.push(null);return m.apply(a,[function(b){c.push(b);return k.apply(a,c)}])};return this};f.behavior.extendedBy(e)})(smallmachine);(function(f,e){function l(f){"undefined"!==typeof e.fn&&e.extend({sm:f});return this}l.prototype._name="Extension";l.prototype.initializer=!0;f.behavior.extendedBy(l)})(smallmachine,jQuery||{});(function(f,e){function l(f){"undefined"!==typeof e.fn&&(e.fn.subscribe=function(e,f){return this.each(function(){var a=this;e.subscribe(function(c){f.apply(a,[c])})})});return this}l.prototype._name="ChannelExtension";l.prototype.initializer=!0;f.behavior.extendedBy(l)})(smallmachine,jQuery||{});(function(f){function e(){this.length=0;this._min=this._max=-1;return this}function l(){return this}e.prototype.add=function(e,g){"undefined"===typeof this[e]?(0<this._max&&this._max<this.length+1&&f.error(Error("The maximum number of items already exists in this collection (max "+this._max+")")),this[e]=g,this.length++):f.error(Error("Cannot add an item to a collection when it's key has already present: "+e))};e.prototype.exists=function(e){return"undefined"!==typeof this[e]};e.prototype.remove=
function(e){"undefined"!==typeof this[e]?(delete this[e],this.length--):f.error(Error("An item with the specified key has not been added: "+e))};l.prototype._name="Restrictions";l.prototype.max=function(f){"undefined"===typeof this._collection&&(this._collection=new e);this._collection._max=f};l.prototype.add=function(f,g){"undefined"===typeof this._collection&&(this._collection=new e);this._collection.add(f,g)};l.prototype.min=function(f){"undefined"===typeof this._collection&&(this._collection=
new e);this._collection._min=f};f.behavior.extendedBy(l)})(smallmachine);(function(f){function e(a,b){b.y=parseFloat(a.y);b.x=parseFloat(a.x);b.width=parseFloat(a.width);b.height=parseFloat(a.height);return this}function l(a){new e(a,this);return this}function k(a){new e(a,this);return this}function g(a){new e(a,this);return this}function m(a){new e(a,this);return this}function a(a,b,c,d){this.shape=new n[a.shape||"ellipse"](a);this.id=a.id||f.getGuid();this.edges=a.edges||[];this.label=a.label||this.id;this.paper=b;this.shapeAttr=c;this.shapeLabelAttr=d;this.data=a.data||
{};this.title=a.title||a.label;return this}function c(a,b,c,d,e,f){this.id1=a.id;this.id2=b.id;this.r1=a.shape.width/2;this.r2=b.shape.width/2;this.x1=a.shape.x;this.y1=a.shape.y;this.x2=b.shape.x;this.y2=b.shape.y;this.label=a.edges[c].label||"";this.paper=d;this.lineAttr=e;this.edgeLabelAttr=f;this.data={};return this}function b(a){this._model=a;this.handleError=function(b){a.messenger.error.publish(b)};return this}var d=new f.Ontology("sm.nodes");d.addTerm("task");d.addTerm("insert");d.addTerm("connect");
d.addTerm("set");d.addTerm("get");d.addTerm("paint");d.addTerm("paintNodes");d.paint.isA(d.task);d.insert.isA(d.task);d.connect.isA(d.task);d.set.isA(d.task);d.get.isA(d.task);d.paintNodes.isA(d.paint);l.prototype.draw=function(a){return a.ellipse(this.x,this.y,this.width/2,this.height/2)};k.prototype.draw=function(a){return a.rect(this.x-this.width/2,this.y-this.height/2,this.width,this.height)};g.prototype.draw=function(a){var b=this.x-this.width/2,c=this.y;return a.path(["M",b,c,"L",this.x,this.y-
this.height/2,"L",this.x+this.width/2,this.y,"L",this.x,this.y+this.height/2,"L",b,c])};m.prototype.draw=function(a){var b=this.x-this.width/2,c=this.y+this.height/2;return a.path(["M",b,c,"L",this.x,this.y-this.height/2,"L",this.x+this.width/2,this.y+this.height/2,"L",b,c])};var n={ellipse:l,rectangle:k,diamond:g,triangle:m};a.prototype.update=function(a){a=this.shape.draw(this.paper);a.id=this.id;"function"===typeof this.shapeAttr?this.shapeAttr(a,this):a.attr(this.shapeAttr);var b=this.paper.text(this.shape.x,
this.shape.y,this.label);""!=this.title&&(a.attr("title",this.title),b.attr("title",this.title));"function"===typeof this.shapeLabelAttr?this.shapeLabelAttr(b,this):b.attr(this.shapeLabelAttr);return!0};c.prototype.update=function(a){a=this.paper.path(["M",this.x1,this.y1,"L",this.x2,this.y2]);"function"===typeof this.lineAttr?this.lineAttr(a,this):a.attr(this.lineAttr);a=this.paper.text((this.x1+this.x2)/2,(this.y1+this.y2)/2,this.label);"function"===typeof this.edgeLabelAttr?this.edgeLabelAttr(a,
this):a.attr(this.edgeLabelAttr);var b=180*Math.atan2(this.y2-this.y1,this.x2-this.x1)/Math.PI;90<b?a.transform("t-6,-6r"+(b+180)):a.transform("t6,-6r"+b);return!0};b.prototype.update=function(b){var d=new f.type.Config;this._model.system.get.config(d);b=b.value;if("undefined"===typeof b)return!1;null!==f.typeMask(b,{length:!0,sort:"function"})&&f.error(Error("Cannot determine the JSON type; expecting an array (or comparable object) of node objects but received "+b),this);var e=new f.type.NamedValue("sm.raphaeljs",
"paper",null);this._model.get.publish(e);e.value.clear();for(var n=0;n<b.length;n++){for(var g=new a(b[n],e.value,d.shapeAttr||{},d.shapeLabelAttr||{}),k=0;k<g.edges.length;k++){var p;a:{p=b;for(var l=g.edges[k].id,m=0;m<p.length;m++)if(p[m].id===l){p=new a(p[m]);break a}p=null}null!==p&&("undefined"!=typeof p.shape.x&&"undefined"!==typeof p.shape.y)&&(p=new c(g,p,k,e.value,d.lineAttr||{},d.edgeLabelAttr||{}),this._model.connect.publish(p))}this._model.insert.publish(g)}};d.registerActivator(function(a){var c=
new b(a);a.paintNodes.subscribe(function(a){return c});a.connect.subscribe(function(a){return a});a.insert.subscribe(function(a){return a})},["sm.channels","sm.raphaeljs"]);try{f.ontology.extendedBy(d)}catch(p){f.error(Error("Could not extend the smallmachine.ontology property with the 'sm.nodes' ontology: "+p.message+"\n"+p.stack))}})(smallmachine);(function(f,e,l){function k(){this.leftSiblingNode=null;return this}function g(a,c,b){this.nodeIndex={};"undefined"===typeof b&&(b={});this.defaultWidth=b.defaultWidth||60;this.defaultNodeMargin=b.defaultNodeMargin||40;this.defaultTreeMargin=b.defaultTreeMargin||80;this.root=a[0];this.size={height:0,width:0,left:0,right:0};this.minimiumVerticalDistance=b.minimiumVerticalDistance||40;for(b=0;b<a.length;b++){a[b].id===c&&(this.root=a[b]);a[b].prelim=0;a[b].mod=0;a[b].thread=null;a[b].ancestor=a[b];
a[b].shift=0;a[b].change=0;a[b].num=a[b].num||0;a[b].vert=this.minimiumVerticalDistance;a[b].width="undefined"===typeof a[b].width?this.defaultWidth:parseFloat(a[b].width);"undefined"!==typeof a[b].height&&(a[b].height=parseFloat(a[b].height),a[b].height>this.minimiumVerticalDistance&&(a[b].vert=a[b].height));"undefined"===typeof a[b].children&&(a[b].children=[]);if("undefined"!==typeof a[b].edges)for(var d=0;d<a[b].edges.length;d++){var e=this._getNodeFromIndex(a[b].edges[d].id,a);if("undefined"===
typeof e.parentNodeId||null==e.parentNodeId)e.parentNodeId=a[b].id,e.num=d,a[b].children.push(e)}for(d=0;d<a[b].children.length;d++)a[b].children[d].leftMostSiblingNode=a[b].children[0],1>d||(a[b].children[d].leftSiblingNode=a[b].children[d-1]);"undefined"===typeof a[b].isLeaf&&(a[b].__proto__=k.prototype,f.alsoBehavesLike(a[b],k.prototype))}"undefined"!==typeof this.root.parentNodeId&&f.error(Error("Aborting; An infinite loop may occur because the root node has a value for parentNodeId (which is set to "+
this.root.parentNodeId+")"))}e=new f.Ontology("sm.treelayout");e.addTerm("paint");e.addTerm("get");k.prototype.leftMostChild=function(){return this.children[0]||null};k.prototype.rightMostChild=function(){return 1>this.children.length?this.children[0]||null:this.children[this.children.length-1]};k.prototype.leftSibling=function(){return this.leftSiblingNode||null};k.prototype.leftMostSibling=function(){return this.leftMostSiblingNode||null};k.prototype.isLeaf=function(){return 0===this.children.length};
g.prototype.walk=function(a){this.firstWalk(this.root);this.secondWalk(this.root,-this.root.prelim,0,0,a);this.size.width=-1*(this.size.left-this.size.right)};g.prototype._name="TreeLayout";g.prototype._getNodeFromIndex=function(a,c){if("undefined"!==typeof this.nodeIndex[a])return this.nodeIndex[a];for(var b=c.length-1;0<=b;b--)if("undefined"===typeof this.nodeIndex[c[b].id]&&(this.nodeIndex[c[b].id]=c[b]),c[b].id===a)return c[b]};g.prototype.getSpacing=function(a,c,b){return(b?this.defaultNodeMargin:
this.defaultTreeMargin)+0.5*(a.width+c.width)};g.prototype.firstWalk=function(a){if(a.isLeaf()){var c=a.leftSibling();null===c?a.prelim=0:(a.prelim=c.prelim+this.getSpacing(c,a,!0),c.vert>a.vert&&(a.vert=c.vert))}else{for(var c=a.leftMostChild(),b=0;b<a.children.length;b++)this.firstWalk(a.children[b]),c=this.apportion(a.children[b],c);this.executeShifts(a);b=0.5*(a.leftMostChild().prelim+a.rightMostChild().prelim);c=a.leftSibling();null!==c?(a.prelim=c.prelim+this.getSpacing(c,a,!0),a.mod=a.prelim-
b,c.vert>a.vert&&(a.vert=c.vert)):a.prelim=b}};g.prototype.apportion=function(a,c){var b=a.leftSibling();if(null!==b){for(var d=a,e=a,f=b,b=a.leftMostSibling(),h=d.mod,g=e.mod,k=f.mod,l=b.mod,f=this.nextRight(f),d=this.nextLeft(d);null!==f&&null!==d;){b=this.nextLeft(b);e=this.nextRight(e);e.ancestor=a;var m=f.prelim+k-(d.prelim+h)+this.getSpacing(f,d,!1);0<m&&(this.moveSubtree(this.ancestor(f,a,c),a,m),h+=m,g+=m);k+=f.mod;h+=d.mod;l+=b.mod;g+=e.mod;f=this.nextRight(f);d=this.nextLeft(d)}null!==f&&
null===this.nextRight(e)&&(e.thread=f,e.mod+=k-g);null!==d&&null===this.nextLeft(b)&&(b.thread=d,b.mod+=h-l,c=a)}return c};g.prototype.moveSubtree=function(a,c,b){var d=c.num-a.num;c.change-=b/d;c.shift+=b;a.change+=b/d;c.prelim+=b;c.mod+=b};g.prototype.executeShifts=function(a){for(var c=0,b=0,d=a.children.length-1;0<=d;d--){var e=a.children[d];e.prelim+=c;e.mod+=c;b+=e.change;c+=e.shift+b}};g.prototype.secondWalk=function(a,c,b,d,e){"undefined"===typeof e&&(e=0);a.x=a.prelim+c+e;var f=a.x-a.width-
this.defaultNodeMargin,h=a.x+a.width+this.defaultNodeMargin;f<this.size.left?this.size.left=f:h>this.size.right&&(this.size.right=h);d+=0.5*a.vert;a.y=b++*this.defaultNodeMargin+d;a.y+a.height>this.size.height&&(this.size.height=a.y+a.height);d+=0.5*a.vert;f=0;for(h=a.children.length;f<h;f++)this.secondWalk(a.children[f],c+a.mod,b,d,e)};g.prototype.shift=function(a,c,b){"undefined"===typeof b&&(b=this.root);b.x+=a;b.y+=c;for(var d=0,e=b.children.length;d<e;d++)this.shift(a,c,b.children[d])};g.prototype.nextRight=
function(a){var c=a.rightMostChild();return null!==c?c:a.thread};g.prototype.nextLeft=function(a){var c=a.leftMostChild();return null!==c?c:a.thread};g.prototype.ancestor=function(a,c,b){return a.ancestor.parentNodeId===c.parentNodeId?a.ancestor:b};g.prototype.areSiblings=function(a,c){return a.parentNodeId===c.parentNodeId};f.type.extendedBy(g);e.registerActivator(function(a){a.paint.subscribe(function(c){if(null===f.typeMask(c.value,{length:!0,sort:"function"}))return function(b){var d=new f.type.NamedValue("sm.treelayout",
"root",null);a.get.publish(d);b=new f.type.NamedValue("sm.raphaeljs","paper",null);a.get.publish(b);var e=new f.type.Config;a.system.get.config(e);d=new f.type.TreeLayout(c.value,d.value,e);null!==b.value?(d.walk(b.value.width/2),b.value.setSize(d.size.width,d.size.height),0>d.size.left&&d.shift(-1*d.size.left,0)):d.walk();return!1}})},["sm.channels","sm.nodes","sm.raphaeljs"]);try{f.ontology.extendedBy(e)}catch(m){f.error(Error("Could not extend the smallmachine.ontology property with the 'sm.nodes' ontology: "+
m.message+"\n"+m.stack))}})(smallmachine,jQuery,Raphael);(function(f,e){var l=new f.Ontology("sm.raphaeljs");l.addTerm("set");l.registerActivator(function(g){var k=/^(\d+)%?$/,a=function(a,b,d,g){g=document.getElementById(a+"");if("undefined"===typeof g||!g)throw Error("The specified element ID could not be found: "+a);var l=window,h=document,q=h.documentElement,r=h.getElementsByTagName("body")[0],h=l.innerWidth||q.clientWidth||r.clientWidth,l=l.innerHeight||q.clientHeight||r.clientHeight,q=b;null===b&&(q=g.offsetWidth||h);r=k.exec(q+"");if(!r)throw Error("The specified value for width is invalid (number, percentage or null allowed): "+
b);"function"===typeof q.indexOf&&0<q.indexOf("%")&&(q=100*(g.offsetWidth||h)/parseFloat(r[0]));b=d;null==d&&(b=g.offsetHeight||l);h=k.exec(b+"");if(!h)throw Error("The specified value for height is invalid (number, percentage or null allowed): "+d);"function"===typeof b.indexOf&&0<b.indexOf("%")&&(b=(g.offsetHeight||l)*parseFloat(h[0])/100);a=e(a,q,b);return new f.type.NamedValue("sm.raphaeljs","paper",a)};"function"===typeof g.set.addHelper&&g.set.addHelper("svg",a)},["sm.channels"]);try{f.ontology.extendedBy(l)}catch(k){throw Error("Could not extend the smallmachine.ontology property with the 'sm.raphaeljs' ontology: "+
k.message+"\n"+k.stack);}})(smallmachine,Raphael);(function(f,e){var l=new f.Ontology("sm.sammyjs");l.addTerm("initialize");var k=function(a,c,b){this._id=a;this._callback=c;this._runArg=b||"#/";return this};k.prototype._name="Sammy";f.type.extendedBy(k);var g={update:function(a){return null===f.typeMask(a,{_id:!0,_callback:!0,_runArg:!0})?function(a){e("#"+a._id,a._callback).run(a._runArg)}:!1}};l.registerActivator(function(a){a.initialize.subscribe({update:function(a){return g}})},["sm.channels"]);try{f.ontology.extendedBy(l)}catch(m){throw Error("Could not extend the smallmachine.ontology property with the 'sm.sammyjs' ontology: "+
m.message+"\n"+m.stack);}})(smallmachine,Sammy);var Sammy="undefined"===typeof Sammy?{}:Sammy;
(function(f,e){function l(e){function f(){this._terms=[];this._terms[0]=[];this._rules=[];this._conflictStrategy=null}var l={equal:0,greaterThanOrEqual:1,greaterThan:2,lessThanOrEqual:-1,lessThan:-2};f.prototype._name="SearchModel";f.prototype._numberExists=function(a){for(var c=this._terms[0].length,b=0,d=c-1,c=Math.floor(c/2);d>=b;){var e=this._terms[0][c];if(a===e)return!0;a<e?d=c-1:b=c+1;c=Math.floor((b+d)/2)}return!1};f.prototype.addTerm=function(a){if("number"===typeof a)this._numberExists(a)||
(this._terms[0].push(a),this._terms[0].sort());else{var c=a.toString();a=c.length;if("undefined"===typeof this._terms[a])this._terms[a]=c;else if(!(-1<this._terms[a].indexOf(c))){for(var b=this._terms[a].length/a,c=[c],d=0;d<b;d++)c.push(this._terms[a].substring(d*a,d*a+a));c.sort();this._terms[a]=c.join("")}}};f.prototype.addRules=function(a){for(var c=0,b=a.length;c<b;c++)for(var d=0,e=a[c].terms.length;d<e;d++){var f=a[c].terms[d];this.addTerm(f)}c=0;for(b=a.length;c<b;c++){for(var h=[],e=a[c].terms.length,
g=0,d=0;d<e;d++){var f=a[c].terms[d],k=this.getTermId(f),f=k[0],s=k[1];f>g&&(g=f);"undefined"===typeof h[f]&&(h[f]=[]);h[f][s]=k;"undefined"!==typeof a[c].operators&&"undefined"!=typeof a[c].operators[d]?(k=l[a[c].operators[d].toString()],h[f][s][2]="undefined"!==typeof k?k:a[c].operators[d]):h[f][s][2]=0}h[g+1]=e;h[g+2]=a[c].action;this._rules.push(h)}};f.prototype.getNumberId=function(a){for(var c=this._terms[0].length,b=0,d=c-1,c=Math.floor(c/2);d>=b;){var e=this._terms[0][c];if(a===e)return[0,
c];a<e?d=c-1:b=c+1;c=Math.floor((b+d)/2)}return!1};f.prototype.getTermId=function(a){if("number"===typeof a)return this.getNumberId(a);a=a.toString();var c=a.length;if(!this._terms[c])return!1;for(var b=this._terms[c].length/c,d=0,e=b-1,b=Math.floor(b/2);e>=d;){var f=c*b,g=this._terms[c].substr(f,c);if(a===g)return[c,f/c];a<g?e=b-1:d=b+1;b=Math.floor((d+e)/2)}return!1};f.prototype.isEqualTermId=function(a,c){if(!a||!c||a.length!==c.length)return!1;for(var b=0;b<a.length;b++)if(a[b]!==c[b])return!1;
return!0};f.prototype.executeQuery=function(a){for(var c=[],b=[],d=0,e=a.length;d<e;d++)for(var f=this.getTermId(a[d]),g=0,k=this._rules.length;g<k;g++){if("undefined"===typeof c[g])c[g]=0;else if(!1===c[g])continue;var l=f[1],m=this._rules[g][f[0]];"undefined"===typeof m||"undefined"===typeof m[l]||!(m[l]instanceof Array)?c[g]=!1:c[g]++}d=0;for(a=c.length;d<a;d++)e=this._rules[d].length,c[d]===this._rules[d][e-2]&&b.push(this._rules[d][e-1]);"function"===typeof this._conflictStrategy&&this._conflictStrategy(b);
return b};this.searchModel=new f;e={addDataModel:function(a){"undefined"!==typeof a._terms&&0<a._terms.length&&"undefined"!==typeof a._rules&&0<a._rules.length?(this.searchModel._terms=a._terms,this.searchModel._rules=a._rules):this.searchModel.addRules(a.rules);this.searchModel._conflictStrategy=a.conflictStrategy},isEqualTermId:function(a,c){return this.searchModel.isEqualTermId(a,c)},getNumberId:function(a){return this.searchModel.getNumberId(a)},getTermId:function(a){return this.searchModel.getTermId(a)},
executeQuery:function(a){return this.searchModel.executeQuery(a)}};"function"===typeof this.helpers?this.helpers(e):(this.addDataModel=e.addDataModel,this.getTermId=e.getTermId,this.getNumberId=e.getNumberId,this.isEqualTermId=e.isEqualTermId,this.executeQuery=e.executeQuery)}l.prototype._name="StateQueryModel";f.type.extendedBy(l)})(smallmachine,Sammy);
