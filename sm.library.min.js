var smallmachine=function(a){Function.prototype.alsoBehavesLike=function(a){for(var c in a.prototype)0!=c.indexOf("_")&&"undefined"===typeof this.prototype[c]&&(this.prototype[c]=a.prototype[c]);for(c in a)a.hasOwnProperty(c)&&0!=c.indexOf("_")&&"undefined"===typeof this.prototype[c]&&(this.prototype[c]=a[c])};a.CONCEPT="concept";a.RELATIONSHIP="relationship";a.AsyncResult=function(a){this._type="AsyncResult";this._channel=a;return this};a.AsyncResult.prototype.publish=function(a,c){this._channel.publish(a,
c)};var e=function(){return this};e.prototype.forward=function(){throw Error("Missing implementation of forward");};e.prototype.subscribe=function(a){"undefined"===typeof this._subscribers&&(this._subscribers=[]);if("function"===typeof a)return this._subscribers.push({update:a}),this;this._subscribers.push(a);return this};var f=function(a,c){for(var d=!1,e=[],g=[],h=0;h<c.length;h++){var f=c[h].update(a);!0===f?d=!0:"function"===typeof f?g.push(f):"object"===typeof f&&"function"===typeof f.update&&
e.push(f.update)}if(d)for(h=0;h<g.length;h++)g[h](a);else for(h=0;h<e.length;h++)e[h](a)};e.prototype.publish=function(b,c){c=c||{};if("function"===typeof b&&(b=b(new a.AsyncResult(this)),"undefined"!==typeof b&&"undefined"!==typeof b._type&&"AsyncResult"===b._type))return this;if("undefined"===typeof this._subscribers)return this.forward(b,c),this;f(b,this._subscribers);this.forward(b,c);return this};e.prototype.addHelper=function(a,c){var d=e.prototype.publish,f=this;this[a]=function(){for(var a=
[],b=0;b<arguments.length;b++)a.push(arguments[b]);return d.apply(f,[function(b){a.push(b);return c.apply(f,a)}])};return this};var g=function(){return this};g.prototype.isA=function(a){throw Error("Missing implementation for isA");};g.prototype.hasRange=function(a){throw Error("Missing implementation for hasRange");};g.prototype.hasDomain=function(a){throw Error("Missing implementation for hasDomain");};g.prototype.relatesTo=function(a,c){throw Error("Missing implementation for relatesTo");};a.Term=
function(a){"undefined"!==typeof a._value&&"undefined"!==typeof a._type?(this._value=a._value,this._type=a._type):(this._value=a,this._type=null);return this};a.add=function(b){return a[b._value]=b};a.Term.prototype.forward=function(a,c){null!=this._value&&(c[this._value]=!0);for(var d in this)if(this.hasOwnProperty(d)&&!("function"===typeof this[d]||0===d.indexOf("_"))&&!0!==c[d]&&"function"===typeof this[d].publish)c[d]=!0,this[d].publish(a,c);if("undefined"!==typeof this._relatesTo)for(d=0;d<this._relatesTo.length;d++)"undefined"!==
typeof this._relatesTo[d]._subscribers&&f(a,this._relatesTo[d]._subscribers)};a.Term.prototype.relatesTo=function(b,c){if(b._type===a.CONCEPT)throw Error("Cannot define a relationship with a concept type: "+b._value);null===b._type&&(b._type=a.RELATIONSHIP);if(c._type===a.RELATIONSHIP)throw Error("Cannot create a relationship with a relationship type: "+c._value);null===c._type&&(c._type=a.CONCEPT);if(this._type===a.RELATIONSHIP)throw Error("Cannot create a relationship from a relationship type: "+
this._value);null===this._type&&(this._type=a.CONCEPT);a[this._value][b._value]=new a.Term(b);a[this._value][b._value][c._value]=c;a[this._value][c._value]=c;"undefined"===typeof c._relatesTo&&(c._relatesTo=[]);c._relatesTo.push(a[this._value][b._value]);for(var d in c)if(c.hasOwnProperty(d)&&!("function"===typeof c[d]||0===d.indexOf("_"))&&"undefined"!==typeof c[d]._value)a[this._value][b._value][d]=c[d],a[this._value][d]=c[d],"undefined"===typeof c[d]._relatesTo&&(c[d]._relatesTo=[]),c[d]._relatesTo.push(a[this._value][b._value]);
return this};a.Term.prototype.isA=function(b){if(b._type===a.RELATIONSHIP)throw Error("Cannot apply isA to a relationship type: "+b._value);null===b._type&&(b._type=a.CONCEPT);if(this._type===a.RELATIONSHIP)throw Error("Cannot apply isA to a relationship type: "+this._value);null===this._type&&(this._type=a.CONCEPT);a[b._value][this._value]=this;return this};a.Term.prototype.hasRange=function(b){if(b._type===a.RELATIONSHIP)throw Error("Cannot apply hasRange to a relationship type: "+b._value);null===
b._type&&(b._type=a.CONCEPT);if(this._type===a.CONCEPT)throw Error("Cannot assign hasRange from a concept type: "+this._value);null===this._type&&(this._type=a.RELATIONSHIP);a[this._value][b._value]=b;"undefined"===typeof b._relatesTo&&(b._relatesTo=[]);b._relatesTo.push(this);for(var c in b)if(b.hasOwnProperty(c)&&!("function"===typeof b[c]||0===c.indexOf("_"))&&"undefined"!==typeof b[c]._value)a[this._value][b[c]._value]=b[c],"undefined"===typeof b[c]._relatesTo&&(b[c]._relatesTo=[]),b[c]._relatesTo.push(this);
return this};a.Term.prototype.hasDomain=function(b){if(b._type===a.RELATIONSHIP)throw Error("Cannot apply hasRange to a relationship type: "+b._value);null===b._type&&(b._type=a.CONCEPT);if(this._type===a.CONCEPT)throw Error("Cannot assign hasRange from a concept type: "+this._value);null===this._type&&(this._type=a.RELATIONSHIP);a[b._value][this._value]=this;return this};a.Term.alsoBehavesLike(e);a.Term.alsoBehavesLike(g);return a}(smallmachine||{});(function(a){a.add(new a.Term("thing"));a.add(new a.Term("user"));a.add(new a.Term("system"));a.add(new a.Term("action"));a.add(new a.Term("click"));a.add(new a.Term("doubleClick"));a.add(new a.Term("keyPress"));a.add(new a.Term("task"));a.add(new a.Term("initialize"));a.add(new a.Term("insert"));a.add(new a.Term("remove"));a.add(new a.Term("get"));a.add(new a.Term("set"));a.add(new a.Term("messenger"));a.add(new a.Term("success"));a.add(new a.Term("error"));a.add(new a.Term("performs"));a.add(new a.Term("reactsTo"));
a.user.isA(a.thing);a.system.isA(a.thing);a.action.isA(a.thing);a.task.isA(a.thing);a.messenger.isA(a.thing);a.click.isA(a.action);a.doubleClick.isA(a.action);a.keyPress.isA(a.action);a.get.isA(a.task);a.set.isA(a.task);a.success.isA(a.messenger);a.error.isA(a.messenger);a.initialize.isA(a.task);a.insert.isA(a.task);a.remove.isA(a.task);a.performs.hasRange(a.action).hasRange(a.task);a.reactsTo.hasRange(a.action).hasDomain(a.system);a.user.relatesTo(a.performs,a.action);a.system.relatesTo(a.performs,
a.task)})(smallmachine);(function(a){a.system.initialize.addHelper("json",function(e,f){if("undefined"!==typeof jQuery)try{jQuery.ajax({dataType:"json",url:e,type:"GET",success:function(b,d,e){a.messenger.success.publish(d);f.publish(b)},error:function(b,d,f){a.messenger.error.publish(f)}})}catch(g){a.messenger.error.publish(g)}else{var b=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP.3.0");b.onprogress=function(){};b.onerror={};b.onreadystatechange=function(){4>b.readyState||(200==b.status?(a.messenger.success.publish(b.statusText),
f.publish(JSON.parse(b.responseText))):a.messenger.error.publish(b.statusText))};b.open("GET",e,!0);b.setRequestHeader("X-Requested-With","XMLHttpRequest");b.setRequestHeader("Content-type","application/json");b.send(null)}return f})})(smallmachine);(function(a){function e(a,e){this.target=a;this.context=e;return this}e.prototype.getType=function(){return"[object Hook]"};a.system.insert.addHelper("hook",function(a,g,b){return new e(a,g)})})(smallmachine);
