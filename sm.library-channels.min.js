var smallmachine=function(b){function a(f,b){for(var h=0;h<b.dependencies.length;h++){for(var a=!1,c=0;c<f.length;c++)if(b.dependencies[h]==f[c].namespace){a=!0;break}if(!a)return b.dependencies[h]}return null}function k(f,b){this._term=f;this._rules=b._rules;return this}function d(){return this}function l(){return this}function m(f){this._id=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(f){var b=16*Math.random()|0;return("x"==f?b:b&3|8).toString(16)})}();"undefined"!==
typeof f._value&&"undefined"!==typeof f._type?(this._value=f._value,this._type=f._type):(this._value=f,this._type=null);return this}function g(f){this.namespace=f;this._inferencer=new c;this._activators=[];this._term=m;return this}function c(){this._term={_value:null};this._rules=[];return this}function e(f,a){var h=this[f];"function"===typeof a?b.alsoBehavesLike(h,a.prototype):b.alsoBehavesLike(h,a);for(var c in h)h.hasOwnProperty(c)&&0!==c.indexOf("_")&&"undefined"!==typeof h[c]._type&&h[c]._type===
b.CONCEPT&&("function"===typeof a?b.alsoBehavesLike(h[c],a.prototype):b.alsoBehavesLike(h[c],a))}function n(f,a,h){f=this[f];var c=this[a],e=this[h];c._type===b.CONCEPT?b.error(Error("Cannot define a relationship with a concept type: "+c._value)):null===c._type&&(c._type=b.RELATIONSHIP);e._type===b.RELATIONSHIP?b.error(Error("Cannot create a relationship with a relationship type: "+e._value)):null===e._type&&(e._type=b.CONCEPT);f._type===b.RELATIONSHIP?b.error(Error("Cannot create a relationship from a relationship type: "+
f._value)):null===f._type&&(f._type=b.CONCEPT);"undefined"===typeof f[a]&&(f[a]=new f.constructor(c));"undefined"===typeof f[a][h]&&(f[a][h]=e);"undefined"===typeof f[h]&&(f[h]=e);e.relate(f[a]);for(var d in e)e.hasOwnProperty(d)&&"function"===typeof e[d].relate&&("undefined"===typeof f[a][d]&&(f[a][d]=e[d]),"undefined"===typeof f[d]&&(f[d]=e[d]),e[d].relate(f[a]))}function q(f,a){var h=this[f],c=this[a];c._type===b.RELATIONSHIP?b.error(Error("Cannot apply isA to a relationship type: "+c._value)):
null===c._type&&(c._type=b.CONCEPT);h._type===b.RELATIONSHIP?b.error(Error("Cannot apply isA to a relationship type: "+h._value)):null===h._type&&(h._type=b.CONCEPT);"undefined"===typeof c[f]&&(c[f]=h)}function r(f,a){var h=this[f],c=this[a];c._type===b.RELATIONSHIP?b.error(Error("Cannot apply hasRange to a relationship type: "+c._value)):null===c._type&&(c._type=b.CONCEPT);h._type===b.CONCEPT?b.error(Error("Cannot assign hasRange from a concept type: "+h._value)):null===h._type&&(h._type=b.RELATIONSHIP);
"undefined"===typeof h[a]&&(h[a]=c);c.relate(h);for(var e in c)if(c.hasOwnProperty(e)&&"function"===typeof c[e].relate){var d=c[e]._value||null;null!==d&&("undefined"===typeof h[d]&&(h[d]=c[e]),c[e].relate(h))}}function s(f,a){var c=this[f],e=this[a];e._type===b.RELATIONSIP?b.error(Error("Cannot apply hasRange to a relationship type: "+e._value)):null===e._type&&(e._type=b.CONCEPT);c._type===b.CONCEPT?b.error(Error("Cannot assign hasRange from a concept type: "+c._value)):null===c._type&&(c._type=
b.RELATIONSHIP);"undefined"===typeof e[f]&&(e[f]=c)}"function"!==typeof Object.getPrototypeOf&&(Object.getPrototypeOf="object"===typeof"test".__proto__?function(f){return f.__proto__}:function(f){return f.constructor.prototype});b=function(f,c){"undefined"===typeof f&&b.error(Error("Missing required parameter for smallmachine constructor: one or more instances of type 'Ontology'"));for(var h=[].concat(f),e="",d=0;d<h.length;d++)"undefined"===typeof h[d]&&b.error(Error("Element "+d+" of the ontologies argument passed to the smallmachine constructor is undefined")),
"undefined"===typeof h[d].namespace?"undefined"!==typeof b.ontology[h[d]]&&(e=e+h[d]+",",h[d]=b.ontology[h[d]]):e=e+h[d].namespace+",";e=new g(e.substring(0,e.length-1));for(d=0;d<h.length;d++){for(var k in h[d])h[d].hasOwnProperty(k)&&"undefined"!==typeof h[d][k]._name&&"Proxy"==h[d][k]._name&&e.addTerm(h[d][k]._term._value);for(var n=0;n<h[d]._inferencer._rules.length;n++)e._inferencer._rules.push(h[d]._inferencer._rules[n]);for(n=0;n<h[d]._activators.length;n++){var l=a(h,h[d]._activators[n]);
null!==l&&b.error(Error("Cannot wire-in ontology with missing activator dependency on '"+l+"'"));e.registerActivator(h[d]._activators[n]);e._activators.sort(function(f,c){if(f.namespace==c.namespace)return 0;for(var a=0;a<f.dependencies.length;a++)if(c.namespace==f.dependencies[a])return 1;for(a=0;a<c.dependencies.length;a++)if(f.namespace==c.dependencies[a])return-1;return 0})}}return e.getModel(c)};b.alsoBehavesLike=function(f,c){("undefined"===typeof f||"undefined"===typeof c)&&b.error(Error("Cannot mixin with an undefined object"));
for(var a in c)if(c.hasOwnProperty(a)&&!(0==a.indexOf("_")||"initializer"===a))if("undefined"!==typeof f[a]){if("undefined"!==typeof c[a].prototype){if("undefined"!==typeof c[a].prototype.initializer&&!0==c[a].prototype.initializer)continue;var e="undefined"!==typeof c[a].prototype.virtual?c[a].prototype.virtual:!1}var d="undefined"!==typeof f[a].prototype?f[a].prototype.virtual:!1;if(!d||!e)d&&(f[a]=c[a])}else f[a]=c[a];"undefined"!==typeof c.prototype&&"undefined"!==typeof f.prototype&&b.alsoBehavesLike(f.prototype,
c.prototype)};b.error=function(a,c){if("undefined"!==typeof c&&"function"===typeof c.handleError)c.handleError(a);else if("function"===typeof b.handleError)b.handleError(a);else throw a;};var t=function(a){var c=16*Math.random()|0;return("x"==a?c:c&3|8).toString(16)};b.getGuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,t)};b.CONCEPT="concept";b.RELATIONSHIP="relationship";k.prototype._name="Proxy";d.prototype.relate=function(a){"undefined"===typeof this._relatesTo&&(this._relatesTo=
[]);for(var c=!1,b=0;b<this._relatesTo.length;b++)if(this._relatesTo[b]._id==a._id){c=!0;break}c||this._relatesTo.push(a)};l.prototype._name="Behavior";b.Behavior=l;g.prototype._name="Ontology";g.prototype.addTerm=function(a){if("undefined"!==typeof this[a])return this;this._term.prototype.relate=d.prototype.relate;var c=new this._term(a);this[a]=new k(c,this._inferencer);return this};g.prototype.addTerms=function(a){for(var c=0;c<a.length;c++)this.addTerm(a[c])};g.prototype.registerActivator=function(a,
c){"undefined"===typeof c&&(c=[]);null===b.typeMask(a,{fn:"function",namespace:!0,dependencies:!0})?this._activators.push(a):this._activators.push({fn:a,namespace:this.namespace,dependencies:c})};g.prototype.getModel=function(a){var c=new function(){return this},e=[];if("undefined"!==typeof a){e=e.concat(a);for(a=0;a<e.length;a++)if("undefined"===typeof e[a]&&b.error("One or more [behaviors] arguments were supplied to the smallmachine constructor that are 'undefined'; error creating object model"),
"undefined"!==typeof e[a].prototype&&!0===e[a].prototype.initializer)e[a](c)}for(var d in this)if(this.hasOwnProperty(d)&&!("undefined"===typeof this[d]||"undefined"===this[d]._term)&&0!==d.indexOf("_"))if("undefined"!==typeof this[d]._term){c[d]=this[d]._term;for(a=0;a<e.length;a++)b.alsoBehavesLike(Object.getPrototypeOf(c[d]),e[a].prototype)}else c[d]=this[d];this._inferencer._rules.sort(function(a,c){return a._priority-c._priority});for(a=0;a<this._inferencer._rules.length;a++)e=this._inferencer._rules[a],
e._fn.apply(c,e._args);for(a=0;a<this._activators.length;a++)this._activators[a].fn(c);return c};b.Ontology=g;var p=function(a,c,e){this._fn=c;this._args=e;this._priority=a;return this};c.prototype.isA=function(a){this._rules.push(new p(1,q,[this._term._value,a._term._value]));return this};c.prototype.relatesTo=function(a,c){this._rules.push(new p(10,n,[this._term._value,a._term._value,c._term._value]));return this};c.prototype.hasDomain=function(a){this._rules.push(new p(3,s,[this._term._value,a._term._value]));
return this};c.prototype.hasRange=function(a){this._rules.push(new p(2,r,[this._term._value,a._term._value]));return this};c.prototype.alsoBehavesLike=function(a){this._rules.push(new p(20,e,[this._term._value,a]));return this};b.alsoBehavesLike(k,c);b.typeMask=function(a,c){var e=[],b;for(b in c)c.hasOwnProperty(b)&&("undefined"===typeof a||"undefined"===typeof a[b]?e.push(b):"undefined"!==typeof a[b]&&typeof a[b]!==c[b]&&!0!==c[b]&&e.push(b));return 0===e.length?null:e};return b}(smallmachine||
{});(function(b){function a(){return this}function k(){return this}function d(a){this._channel=a;return this}function l(a,e,d){"undefined"===typeof e&&b.error(Error("Parameter 'key' is required when instantiating the sm.NamedValue type"));this.namespace=a;this.key=e;this.value=d;return this}function m(){this._collection={};return this}var g=new b.Ontology("sm.properties");g.addTerm("property");g.addTerm("type");g.addTerm("ontology");g.addTerm("behavior");g.addTerm("hasMemberType");g.addTerm("hasMember");
g.addTerm("Ontology");g.addTerm("Behavior");g.addTerm("Constructor");g.addTerm("Null");g.ontology.isA(g.property);g.behavior.isA(g.property);g.Ontology.isA(g.type);g.Behavior.isA(g.type);g.Constructor.isA(g.type);g.Null.isA(g.type);g.ontology.relatesTo(g.hasMemberType,g.Ontology);g.behavior.relatesTo(g.hasMemberType,g.Behavior);g.ontology.relatesTo(g.hasMember,g.Null);g.behavior.relatesTo(g.hasMember,g.Null);a.prototype.extendedBy=function(a,e){var d=this.hasMemberType;"undefined"===typeof e&&("undefined"===
d?e=a._name:"undefined"!==typeof a.prototype&&(e=a.prototype._name));if("undefined"!==typeof e&&"function"===typeof a)"undefined"!==typeof this[e]?b.alsoBehavesLike(this[e],a):this[e]=a,"undefined"===typeof this[e]._name&&(this[e]._name=e);else{var k=e||a.namespace||a._name;"undefined"===typeof k&&b.error(Error("Cannot call extendedBy on the core ontology with an object that is missing the 'namepsace' and '_name' properties without specifying a 'typeName'"));if("undefined"!==typeof this[k])b.alsoBehavesLike(this[k],
a);else{var g=b[this._value][d._value];"undefined"===typeof g&&b.error(Error("The specified type does not exist in the core object model: "+d._value));var d=a._name||a.constructor.name,l=!1,m;for(m in g)if(g.hasOwnProperty(m)&&0!==m.indexOf("_")&&m===d){this.hasMember[k]=a;this[k]=a;l=!0;break}l||b.error(Error("Did not find an allowed model type for: "+d))}}};k.prototype._name="Null";b.alsoBehavesLike(b,g.getModel(a));b.ontology.extendedBy(new k);b.behavior.extendedBy(new k);d.prototype._name="AsyncResult";
d.prototype.publish=function(a,e){this._channel.publish(a,e);return this};b.type.extendedBy(d);l.prototype.adapt=function(a,e){this.namespace=a;if("undefined"!==typeof e)for(var d=[].concat(e),k=0;k<d.length;k++)b.alsoBehavesLike(this,d[k]);return this};l.prototype._name="NamedValue";b.type.extendedBy(l);m.prototype._name="NamedValueCollection";m.prototype.exists=function(a,e){var d=a;null===b.typeMask(a,{namespace:!0,key:!0})&&(d=a.namespace,e=a.key);return"undefined"!==typeof this._collection[d]&&
"undefined"!==typeof this._collection[d][e]};m.prototype.add=function(a,d,k){var g=a.namespace||a,l=a.key||d;"undefined"!==typeof this._collection[g]&&"undefined"!==this._collection[g][l]&&b.error(Error("Cannot add a new entry to the collection (already exists): ["+g+"]"+l));this.modify(a,d,k);return this};m.prototype.modify=function(a,d,k){var g=a.namespace||a;d=a.key||d;a=a.value||k;"undefined"===typeof d&&b.error(Error("Must supply a valid key"));"undefined"===typeof a&&b.error(Error("Must supply a valid value"));
"undefined"===typeof this._collection[g]&&(this._collection[g]={});this._collection[g][d]=a;return this};m.prototype.remove=function(a,d){if(!("undefined"===typeof this._collection[a]||"undefined"===typeof this._collection[a][d]))return delete this._collection[a][d],this};m.prototype.getValue=function(a,d){var b=a.namespace||a,k=a.key||d;if(!("undefined"===typeof this._collection[b]||"undefined"===this._collection[b][k]))return b=this._collection[b][k],"undefined"!==typeof b&&("function"===typeof a.setValue?
a.setValue(b):"undefined"!==typeof a.value&&(a.value=b)),b};b.type.extendedBy(m)})(smallmachine);(function(b){var a=new b.Ontology("sm.channels");a.addTerm("thing");a.addTerm("user");a.addTerm("system");a.addTerm("action");a.addTerm("click");a.addTerm("doubleClick");a.addTerm("keyPress");a.addTerm("task");a.addTerm("initialize");a.addTerm("insert");a.addTerm("remove");a.addTerm("get");a.addTerm("set");a.addTerm("messenger");a.addTerm("success");a.addTerm("error");a.addTerm("performs");a.addTerm("reactsTo");a.user.isA(a.thing);a.user.relatesTo(a.performs,a.action);a.system.isA(a.thing);a.system.relatesTo(a.performs,
a.task);a.messenger.isA(a.thing);a.click.isA(a.action);a.doubleClick.isA(a.action);a.keyPress.isA(a.action);a.get.isA(a.task);a.set.isA(a.task);a.success.isA(a.messenger);a.error.isA(a.messenger);a.initialize.isA(a.task);a.insert.isA(a.task);a.remove.isA(a.task);a.performs.hasRange(a.action).hasRange(a.task);a.reactsTo.hasRange(a.action).hasDomain(a.system);a.registerActivator(function(a){function k(c,g){if("undefined"!==typeof jQuery)try{jQuery.ajax({dataType:"json",url:c,type:"GET",success:function(k,
l,m){a.messenger.success.publish(l);g.publish(new b.type.NamedValue("sm.channels",c,k))},error:function(a,d,c){b.error(Error(c))}})}catch(l){b.error(Error(l))}else{var m=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP.3.0");m.onprogress=function(){};m.onerror={};m.onreadystatechange=function(){4>m.readyState||(200==m.status?(a.messenger.success.publish(m.statusText),g.publish(new b.type.NamedValue("sm.channels",c,JSON.parse(m.responseText)))):b.error(Error(m.statusText)))};
m.open("GET",c,!0);m.setRequestHeader("X-Requested-With","XMLHttpRequest");m.setRequestHeader("Content-type","application/json");m.send(null)}return g}var m={update:function(b){return"undefined"!==typeof b.key&&"undefined"!==typeof b.namespace?function(b){a.memory.modify(b)}:!1}};b.alsoBehavesLike(a,{memory:new b.type.NamedValueCollection});a.set.subscribe({update:function(a){return m}});var g={update:function(b){return"undefined"!==typeof b.key&&"undefined"!==typeof b.namespace?function(b){a.memory.getValue(b)}:
!1}};a.get.subscribe({update:function(a){return g}});"function"===typeof a.initialize.addHelper&&a.initialize.addHelper("json",k);"function"===typeof a.set.addHelper&&a.set.addHelper("config",function(a){return new b.type.NamedValue("sm.channels","config",a)});if("function"===typeof a.get.addHelper){a.get.addHelper("json",k);var c=function(){this.namespace="sm.channels";this.key="config";return this};c.prototype._name="Config";c.prototype.setValue=function(a){b.alsoBehavesLike(this,a)};b.type.extendedBy(c);
a.get.addHelper("config",function(a){return a})}});try{b.ontology.extendedBy(a)}catch(k){b.error(Error("Could not extend the smallmachine.ontology property with the 'sm.channels' ontology: "+k.message+"\n"+k.stack))}})(smallmachine);(function(b){function a(a,b){this._value=a;this._type=b;return this}a.prototype._name="Channel";a.prototype.forward=function(a,b){null!=this._value&&(b[this._value]=!0);for(var l in this)if(this.hasOwnProperty(l)&&!("function"===typeof this[l]||0===l.indexOf("_"))&&!0!==b[l]&&"function"===typeof this[l].publish)b[l]=!0,this[l].publish(a,b);if("undefined"!==typeof this._relatesTo)for(l=0;l<this._relatesTo.length;l++)"undefined"!==typeof this._relatesTo[l]._subscribers&&this.notify(a,this._relatesTo[l]._subscribers)};
a.prototype.unsubscribe=function(a){"undefined"!==typeof this._subscribers&&delete this._subscribers[a]};a.prototype.subscribe=function(a){"undefined"===typeof this._subscribers&&(this._subscribers={});var d=b.getGuid();"function"===typeof a?this._subscribers[d]={update:a,lifetime:1}:("undefined"===typeof a.lifecycle&&(a.lifetime=1),this._subscribers[d]=a);return d};a.prototype.notify=function(a,d){var l=!1,m={},g=0,c=[],e;for(e in d){var n=d[e].update(a);"undefined"!==typeof d[e]&&(0>=d[e].lifetime&&
this.unsubscribe(e),!0===n?l=!0:"function"===typeof n?(c.push(n),l=!0):n&&"function"===typeof n.update&&(m[b.getGuid()]=n,g++))}if(l){e=0===c.length;for(n=0;n<c.length;n++)!1===!c[n](a)&&(e=!0);!1===e&&(l=!1)}!1==l&&0<g&&this.notify(a,m)};a.prototype.publish=function(a,d){d=d||{};if("function"===typeof a&&(a=a(new b.type.AsyncResult(this)),"undefined"!==typeof a&&"undefined"!==typeof a._channel&&"function"===typeof a.publish))return this;if("undefined"===typeof this._subscribers)return this.forward(a,
d),this;this.notify(a,this._subscribers);this.forward(a,d);return this};a.prototype.addHelper=function(b,d){var l=a.prototype.publish,m=this;this[b]=function(){for(var a=[],b=0;b<arguments.length;b++)a.push(arguments[b]);return l.apply(m,[function(b){a.push(b);return d.apply(m,a)}])};return this};b.behavior.extendedBy(a)})(smallmachine);(function(b,a){function k(b){"undefined"!==typeof a.fn&&a.extend({sm:b});return this}k.prototype._name="Extension";k.prototype.initializer=!0;b.behavior.extendedBy(k)})(smallmachine,jQuery||{});(function(b,a){function k(b){"undefined"!==typeof a.fn&&(a.fn.subscribe=function(a,b){return this.each(function(){var d=this;a.subscribe(function(a){b.apply(d,[a])})})});return this}k.prototype._name="ChannelExtension";k.prototype.initializer=!0;b.behavior.extendedBy(k)})(smallmachine,jQuery||{});(function(b){function a(){this.length=0;this._min=this._max=-1;return this}function k(){return this}a.prototype.add=function(a,k){"undefined"===typeof this[a]?(0<this._max&&this._max<this.length+1&&b.error(Error("The maximum number of items already exists in this collection (max "+this._max+")")),this[a]=k,this.length++):b.error(Error("Cannot add an item to a collection when it's key has already present: "+a))};a.prototype.exists=function(a){return"undefined"!==typeof this[a]};a.prototype.remove=
function(a){"undefined"!==typeof this[a]?(delete this[a],this.length--):b.error(Error("An item with the specified key has not been added: "+a))};k.prototype._name="Restrictions";k.prototype.max=function(b){"undefined"===typeof this._collection&&(this._collection=new a);this._collection._max=b};k.prototype.add=function(b,k){"undefined"===typeof this._collection&&(this._collection=new a);this._collection.add(b,k)};k.prototype.min=function(b){"undefined"===typeof this._collection&&(this._collection=
new a);this._collection._min=b};b.behavior.extendedBy(k)})(smallmachine);
