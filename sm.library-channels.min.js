var smallmachine=function(c){function a(g,c){for(var l=0;l<c.dependencies.length;l++){for(var a=!1,e=0;e<g.length;e++)if(c.dependencies[l]==g[e].namespace){a=!0;break}if(!a)return c.dependencies[l]}return null}function f(g,c){this._term=g;this._rules=c._rules;return this}function d(){return this}function k(){return this}function m(g){this._id=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(g){var c=16*Math.random()|0;return("x"==g?c:c&3|8).toString(16)})}();"undefined"!==
typeof g._value&&"undefined"!==typeof g._type?(this._value=g._value,this._type=g._type):(this._value=g,this._type=null);return this}function h(g){this.namespace=g;this._inferencer=new e;this._activators=[];this._term=m;return this}function e(){this._term={_value:null};this._rules=[];return this}function b(g,a){var l=this[g];"function"===typeof a?c.alsoBehavesLike(l,a.prototype):c.alsoBehavesLike(l,a);for(var e in l)l.hasOwnProperty(e)&&0!==e.indexOf("_")&&"undefined"!==typeof l[e]._type&&l[e]._type===
c.CONCEPT&&("function"===typeof a?c.alsoBehavesLike(l[e],a.prototype):c.alsoBehavesLike(l[e],a))}function n(g,a,l){g=this[g];var e=this[a],b=this[l];e._type===c.CONCEPT?c.error(Error("Cannot define a relationship with a concept type: "+e._value)):null===e._type&&(e._type=c.RELATIONSHIP);b._type===c.RELATIONSHIP?c.error(Error("Cannot create a relationship with a relationship type: "+b._value)):null===b._type&&(b._type=c.CONCEPT);g._type===c.RELATIONSHIP?c.error(Error("Cannot create a relationship from a relationship type: "+
g._value)):null===g._type&&(g._type=c.CONCEPT);"undefined"===typeof g[a]&&(g[a]=new g.constructor(e));"undefined"===typeof g[a][l]&&(g[a][l]=b);"undefined"===typeof g[l]&&(g[l]=b);b.relate(g[a]);for(var d in b)b.hasOwnProperty(d)&&"function"===typeof b[d].relate&&("undefined"===typeof g[a][d]&&(g[a][d]=b[d]),"undefined"===typeof g[d]&&(g[d]=b[d]),b[d].relate(g[a]))}function q(g,a){var l=this[g],e=this[a];e._type===c.RELATIONSHIP?c.error(Error("Cannot apply isA to a relationship type: "+e._value)):
null===e._type&&(e._type=c.CONCEPT);l._type===c.RELATIONSHIP?c.error(Error("Cannot apply isA to a relationship type: "+l._value)):null===l._type&&(l._type=c.CONCEPT);"undefined"===typeof e[g]&&(e[g]=l)}function r(g,a){var l=this[g],e=this[a];e._type===c.RELATIONSHIP?c.error(Error("Cannot apply hasRange to a relationship type: "+e._value)):null===e._type&&(e._type=c.CONCEPT);l._type===c.CONCEPT?c.error(Error("Cannot assign hasRange from a concept type: "+l._value)):null===l._type&&(l._type=c.RELATIONSHIP);
"undefined"===typeof l[a]&&(l[a]=e);e.relate(l);for(var b in e)if(e.hasOwnProperty(b)&&"function"===typeof e[b].relate){var d=e[b]._value||null;null!==d&&("undefined"===typeof l[d]&&(l[d]=e[b]),e[b].relate(l))}}function s(g,e){var a=this[g],b=this[e];b._type===c.RELATIONSIP?c.error(Error("Cannot apply hasRange to a relationship type: "+b._value)):null===b._type&&(b._type=c.CONCEPT);a._type===c.CONCEPT?c.error(Error("Cannot assign hasRange from a concept type: "+a._value)):null===a._type&&(a._type=
c.RELATIONSHIP);"undefined"===typeof b[g]&&(b[g]=a)}"function"!==typeof Object.getPrototypeOf&&(Object.getPrototypeOf="object"===typeof"test".__proto__?function(g){return g.__proto__}:function(g){return g.constructor.prototype});c=function(g,e){"undefined"===typeof g&&c.error(Error("Missing required parameter for smallmachine constructor: one or more instances of type 'Ontology'"));for(var b=[].concat(g),d="",f=0;f<b.length;f++)"undefined"===typeof b[f]&&c.error(Error("Element "+f+" of the ontologies argument passed to the smallmachine constructor is undefined")),
"undefined"===typeof b[f].namespace?"undefined"!==typeof c.ontology[b[f]]&&(d=d+b[f]+",",b[f]=c.ontology[b[f]]):d=d+b[f].namespace+",";d=new h(d.substring(0,d.length-1));for(f=0;f<b.length;f++){for(var n in b[f])b[f].hasOwnProperty(n)&&"undefined"!==typeof b[f][n]._name&&"Proxy"==b[f][n]._name&&d.addTerm(b[f][n]._term._value);for(var k=0;k<b[f]._inferencer._rules.length;k++)d._inferencer._rules.push(b[f]._inferencer._rules[k]);for(k=0;k<b[f]._activators.length;k++){var q=a(b,b[f]._activators[k]);
null!==q&&c.error(Error("Cannot wire-in ontology with missing activator dependency on '"+q+"'"));d.registerActivator(b[f]._activators[k]);d._activators.sort(function(g,b){if(g.namespace==b.namespace)return 0;for(var a=0;a<g.dependencies.length;a++)if(b.namespace==g.dependencies[a])return 1;for(a=0;a<b.dependencies.length;a++)if(g.namespace==b.dependencies[a])return-1;return 0})}}return d.getModel(e)};c.alsoBehavesLike=function(g,a){("undefined"===typeof g||"undefined"===typeof a)&&c.error(Error("Cannot mixin with an undefined object"));
for(var b in a)if(a.hasOwnProperty(b)&&!(0==b.indexOf("_")||"initializer"===b))if("undefined"!==typeof g[b]){if("undefined"!==typeof a[b].prototype){if("undefined"!==typeof a[b].prototype.initializer&&!0==a[b].prototype.initializer)continue;var e="undefined"!==typeof a[b].prototype.virtual?a[b].prototype.virtual:!1}var d="undefined"!==typeof g[b].prototype?g[b].prototype.virtual:!1;if(!d||!e)d&&(g[b]=a[b])}else g[b]=a[b];"undefined"!==typeof a.prototype&&"undefined"!==typeof g.prototype&&c.alsoBehavesLike(g.prototype,
a.prototype)};c.error=function(b,a){if("undefined"!==typeof a&&"function"===typeof a.handleError)a.handleError(b);else if("function"===typeof c.handleError)c.handleError(b);else throw b;};var t=function(b){var a=16*Math.random()|0;return("x"==b?a:a&3|8).toString(16)};c.getGuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,t)};c.CONCEPT="concept";c.RELATIONSHIP="relationship";f.prototype._name="Proxy";d.prototype.relate=function(b){"undefined"===typeof this._relatesTo&&(this._relatesTo=
[]);for(var a=!1,e=0;e<this._relatesTo.length;e++)if(this._relatesTo[e]._id==b._id){a=!0;break}a||this._relatesTo.push(b)};k.prototype._name="Behavior";c.Behavior=k;h.prototype._name="Ontology";h.prototype.addTerm=function(b){if("undefined"!==typeof this[b])return this;this._term.prototype.relate=d.prototype.relate;var a=new this._term(b);this[b]=new f(a,this._inferencer);return this};h.prototype.addTerms=function(b){for(var a=0;a<b.length;a++)this.addTerm(b[a])};h.prototype.registerActivator=function(b,
a){"undefined"===typeof a&&(a=[]);null===c.typeMask(b,{fn:"function",namespace:!0,dependencies:!0})?this._activators.push(b):this._activators.push({fn:b,namespace:this.namespace,dependencies:a})};h.prototype.getModel=function(b){var a=new function(){return this},e=[];if("undefined"!==typeof b){e=e.concat(b);for(b=0;b<e.length;b++)if("undefined"===typeof e[b]&&c.error("One or more [behaviors] arguments were supplied to the smallmachine constructor that are 'undefined'; error creating object model"),
"undefined"!==typeof e[b].prototype&&!0===e[b].prototype.initializer)e[b](a)}for(var d in this)if(this.hasOwnProperty(d)&&!("undefined"===typeof this[d]||"undefined"===this[d]._term)&&0!==d.indexOf("_"))if("undefined"!==typeof this[d]._term){a[d]=this[d]._term;for(b=0;b<e.length;b++)c.alsoBehavesLike(Object.getPrototypeOf(a[d]),e[b].prototype)}else a[d]=this[d];this._inferencer._rules.sort(function(b,a){return b._priority-a._priority});for(b=0;b<this._inferencer._rules.length;b++)e=this._inferencer._rules[b],
e._fn.apply(a,e._args);for(b=0;b<this._activators.length;b++)this._activators[b].fn(a);return a};c.Ontology=h;var p=function(b,a,e){this._fn=a;this._args=e;this._priority=b;return this};e.prototype.isA=function(b){this._rules.push(new p(1,q,[this._term._value,b._term._value]));return this};e.prototype.relatesTo=function(b,a){this._rules.push(new p(10,n,[this._term._value,b._term._value,a._term._value]));return this};e.prototype.hasDomain=function(b){this._rules.push(new p(3,s,[this._term._value,b._term._value]));
return this};e.prototype.hasRange=function(b){this._rules.push(new p(2,r,[this._term._value,b._term._value]));return this};e.prototype.alsoBehavesLike=function(a){this._rules.push(new p(20,b,[this._term._value,a]));return this};c.alsoBehavesLike(f,e);c.typeMask=function(b,a){var e=[],c;for(c in a)a.hasOwnProperty(c)&&("undefined"===typeof b||"undefined"===typeof b[c]?e.push(c):"undefined"!==typeof b[c]&&typeof b[c]!==a[c]&&!0!==a[c]&&e.push(c));return 0===e.length?null:e};return c}(smallmachine||
{});(function(c){function a(){return this}function f(){return this}function d(a){this._channel=a;return this}function k(a,b,d){"undefined"===typeof b&&c.error(Error("Parameter 'key' is required when instantiating the sm.NamedValue type"));this.namespace=a;this.key=b;this.value=d;return this}function m(){this._collection={};return this}var h=new c.Ontology("sm.properties");h.addTerm("property");h.addTerm("type");h.addTerm("ontology");h.addTerm("behavior");h.addTerm("hasMemberType");h.addTerm("hasMember");
h.addTerm("Ontology");h.addTerm("Behavior");h.addTerm("Constructor");h.addTerm("Null");h.ontology.isA(h.property);h.behavior.isA(h.property);h.Ontology.isA(h.type);h.Behavior.isA(h.type);h.Constructor.isA(h.type);h.Null.isA(h.type);h.ontology.relatesTo(h.hasMemberType,h.Ontology);h.behavior.relatesTo(h.hasMemberType,h.Behavior);h.ontology.relatesTo(h.hasMember,h.Null);h.behavior.relatesTo(h.hasMember,h.Null);a.prototype.extendedBy=function(a,b){var d=this.hasMemberType;"undefined"===typeof b&&("undefined"===
d?b=a._name:"undefined"!==typeof a.prototype&&(b=a.prototype._name));if("undefined"!==typeof b&&"function"===typeof a)"undefined"!==typeof this[b]?c.alsoBehavesLike(this[b],a):this[b]=a,"undefined"===typeof this[b]._name&&(this[b]._name=b);else{var f=b||a.namespace||a._name;"undefined"===typeof f&&c.error(Error("Cannot call extendedBy on the core ontology with an object that is missing the 'namepsace' and '_name' properties without specifying a 'typeName'"));if("undefined"!==typeof this[f])c.alsoBehavesLike(this[f],
a);else{var h=c[this._value][d._value];"undefined"===typeof h&&c.error(Error("The specified type does not exist in the core object model: "+d._value));var d=a._name||a.constructor.name,k=!1,m;for(m in h)if(h.hasOwnProperty(m)&&0!==m.indexOf("_")&&m===d){this.hasMember[f]=a;this[f]=a;k=!0;break}k||c.error(Error("Did not find an allowed model type for: "+d))}}};f.prototype._name="Null";c.alsoBehavesLike(c,h.getModel(a));c.ontology.extendedBy(new f);c.behavior.extendedBy(new f);d.prototype._name="AsyncResult";
d.prototype.publish=function(a,b){this._channel.publish(a,b);return this};c.type.extendedBy(d);k.prototype.adapt=function(a,b){this.namespace=a;if("undefined"!==typeof b)for(var d=[].concat(b),f=0;f<d.length;f++)c.alsoBehavesLike(this,d[f]);return this};k.prototype._name="NamedValue";c.type.extendedBy(k);m.prototype._name="NamedValueCollection";m.prototype.exists=function(a,b){var d=a;null===c.typeMask(a,{namespace:!0,key:!0})&&(d=a.namespace,b=a.key);return"undefined"!==typeof this._collection[d]&&
"undefined"!==typeof this._collection[d][b]};m.prototype.add=function(a,b,d){var f=a.namespace||a,h=a.key||b;"undefined"!==typeof this._collection[f]&&"undefined"!==this._collection[f][h]&&c.error(Error("Cannot add a new entry to the collection (already exists): ["+f+"]"+h));this.modify(a,b,d);return this};m.prototype.modify=function(a,b,d){var f=a.namespace||a;b=a.key||b;a=a.value||d;"undefined"===typeof b&&c.error(Error("Must supply a valid key"));"undefined"===typeof a&&c.error(Error("Must supply a valid value"));
"undefined"===typeof this._collection[f]&&(this._collection[f]={});this._collection[f][b]=a;return this};m.prototype.remove=function(a,b){if(!("undefined"===typeof this._collection[a]||"undefined"===typeof this._collection[a][b]))return delete this._collection[a][b],this};m.prototype.getValue=function(a,b){var d=a.namespace||a,c=a.key||b;if(!("undefined"===typeof this._collection[d]||"undefined"===this._collection[d][c]))return d=this._collection[d][c],"undefined"!==typeof d&&("function"===typeof a.setValue?
a.setValue(d):"undefined"!==typeof a.value&&(a.value=d)),d};c.type.extendedBy(m)})(smallmachine);(function(c){var a=new c.Ontology("sm.channels");a.addTerm("thing");a.addTerm("user");a.addTerm("system");a.addTerm("action");a.addTerm("click");a.addTerm("doubleClick");a.addTerm("keyPress");a.addTerm("task");a.addTerm("initialize");a.addTerm("insert");a.addTerm("remove");a.addTerm("get");a.addTerm("set");a.addTerm("messenger");a.addTerm("success");a.addTerm("error");a.addTerm("performs");a.addTerm("reactsTo");a.user.isA(a.thing);a.user.relatesTo(a.performs,a.action);a.system.isA(a.thing);a.system.relatesTo(a.performs,
a.task);a.messenger.isA(a.thing);a.click.isA(a.action);a.doubleClick.isA(a.action);a.keyPress.isA(a.action);a.get.isA(a.task);a.set.isA(a.task);a.success.isA(a.messenger);a.error.isA(a.messenger);a.initialize.isA(a.task);a.insert.isA(a.task);a.remove.isA(a.task);a.performs.hasRange(a.action).hasRange(a.task);a.reactsTo.hasRange(a.action).hasDomain(a.system);a.registerActivator(function(a){function f(b,e,h){if("undefined"!==typeof jQuery)try{jQuery.ajax({dataType:"json",url:b,type:"GET",success:function(f,
e,g){a.messenger.success.publish(e);h.publish(new c.type.NamedValue("sm.channels",b,f))},error:function(a,b,d){e?e(a,b,d):c.error(Error(d))}})}catch(k){c.error(Error(k))}else{var m=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP.3.0");m.onprogress=function(){};m.onerror={};m.onreadystatechange=function(){4>m.readyState||(200==m.status?(a.messenger.success.publish(m.statusText),h.publish(new c.type.NamedValue("sm.channels",b,JSON.parse(m.responseText)))):c.error(Error(m.statusText)))};
m.open("GET",b,!0);m.setRequestHeader("X-Requested-With","XMLHttpRequest");m.setRequestHeader("Content-type","application/json");m.send(null)}return h}var m={update:function(b){return"undefined"!==typeof b.key&&"undefined"!==typeof b.namespace?function(b){a.memory.modify(b)}:!1}};c.alsoBehavesLike(a,{memory:new c.type.NamedValueCollection});a.set.subscribe({update:function(a){return m}});var h={update:function(b){return"undefined"!==typeof b.key&&"undefined"!==typeof b.namespace?function(b){a.memory.getValue(b)}:
!1}};a.get.subscribe({update:function(a){return h}});"function"===typeof a.initialize.addHelper&&a.initialize.addHelper("json",f,2);"function"===typeof a.set.addHelper&&a.set.addHelper("config",function(a){return new c.type.NamedValue("sm.channels","config",a)});if("function"===typeof a.get.addHelper){a.get.addHelper("json",f,2);var e=function(){this.namespace="sm.channels";this.key="config";return this};e.prototype._name="Config";e.prototype.setValue=function(a){c.alsoBehavesLike(this,a)};c.type.extendedBy(e);
a.get.addHelper("config",function(a){return a})}});try{c.ontology.extendedBy(a)}catch(f){c.error(Error("Could not extend the smallmachine.ontology property with the 'sm.channels' ontology: "+f.message+"\n"+f.stack))}})(smallmachine);(function(c){function a(a,c){this._value=a;this._type=c;return this}a.prototype._name="Channel";a.prototype.forward=function(a,c){null!=this._value&&(c[this._value]=!0);for(var k in this)if(this.hasOwnProperty(k)&&!("function"===typeof this[k]||0===k.indexOf("_"))&&!0!==c[k]&&"function"===typeof this[k].publish)c[k]=!0,this[k].publish(a,c);if("undefined"!==typeof this._relatesTo)for(k=0;k<this._relatesTo.length;k++)"undefined"!==typeof this._relatesTo[k]._subscribers&&this.notify(a,this._relatesTo[k]._subscribers)};
a.prototype.unsubscribe=function(a){"undefined"!==typeof this._subscribers&&delete this._subscribers[a]};a.prototype.subscribe=function(a){"undefined"===typeof this._subscribers&&(this._subscribers={});var d=c.getGuid();"function"===typeof a?this._subscribers[d]={update:a,lifetime:1}:("undefined"===typeof a.lifecycle&&(a.lifetime=1),this._subscribers[d]=a);return d};a.prototype.notify=function(a,d){var k=!1,m={},h=0,e=[],b;for(b in d){var n=d[b].update(a);"undefined"!==typeof d[b]&&(0>=d[b].lifetime&&
this.unsubscribe(b),!0===n?k=!0:"function"===typeof n?(e.push(n),k=!0):n&&"function"===typeof n.update&&(m[c.getGuid()]=n,h++))}if(k){b=0===e.length;for(n=0;n<e.length;n++)!1===!e[n](a)&&(b=!0);!1===b&&(k=!1)}!1==k&&0<h&&this.notify(a,m)};a.prototype.publish=function(a,d){d=d||{};if("function"===typeof a&&(a=a(new c.type.AsyncResult(this)),"undefined"!==typeof a&&"undefined"!==typeof a._channel&&"function"===typeof a.publish))return this;if("undefined"===typeof this._subscribers)return this.forward(a,
d),this;this.notify(a,this._subscribers);this.forward(a,d);return this};a.prototype.addHelper=function(c,d,k){var m=a.prototype.publish,h=this;this[c]=function(){for(var a=[],b=0;b<arguments.length;b++)a.push(arguments[b]);if("undefined"!==typeof k)for(b=0;b<k-a.length;b++)a.push(null);return m.apply(h,[function(b){a.push(b);return d.apply(h,a)}])};return this};c.behavior.extendedBy(a)})(smallmachine);(function(c,a){function f(c){"undefined"!==typeof a.fn&&a.extend({sm:c});return this}f.prototype._name="Extension";f.prototype.initializer=!0;c.behavior.extendedBy(f)})(smallmachine,jQuery||{});(function(c,a){function f(c){"undefined"!==typeof a.fn&&(a.fn.subscribe=function(a,c){return this.each(function(){var d=this;a.subscribe(function(a){c.apply(d,[a])})})});return this}f.prototype._name="ChannelExtension";f.prototype.initializer=!0;c.behavior.extendedBy(f)})(smallmachine,jQuery||{});(function(c){function a(){this.length=0;this._min=this._max=-1;return this}function f(){return this}a.prototype.add=function(a,f){"undefined"===typeof this[a]?(0<this._max&&this._max<this.length+1&&c.error(Error("The maximum number of items already exists in this collection (max "+this._max+")")),this[a]=f,this.length++):c.error(Error("Cannot add an item to a collection when it's key has already present: "+a))};a.prototype.exists=function(a){return"undefined"!==typeof this[a]};a.prototype.remove=
function(a){"undefined"!==typeof this[a]?(delete this[a],this.length--):c.error(Error("An item with the specified key has not been added: "+a))};f.prototype._name="Restrictions";f.prototype.max=function(c){"undefined"===typeof this._collection&&(this._collection=new a);this._collection._max=c};f.prototype.add=function(c,f){"undefined"===typeof this._collection&&(this._collection=new a);this._collection.add(c,f)};f.prototype.min=function(c){"undefined"===typeof this._collection&&(this._collection=
new a);this._collection._min=c};c.behavior.extendedBy(f)})(smallmachine);
