var smallmachine=function(d){function a(k,a){for(var c=0;c<a.dependencies.length;c++){for(var d=!1,b=0;b<k.length;b++)if(a.dependencies[c]==k[b].title){d=!0;break}if(!d)return a.dependencies[c]}return null}function l(a,c){this._term=a;this._rules=c._rules;return this}function h(){return this}function e(a){this.title=a;this._inferencer=new f;this._activators=[];this._term=function(a){this._id=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var k=16*Math.random()|
0;return("x"==a?k:k&3|8).toString(16)})}();"undefined"!==typeof a._value&&"undefined"!==typeof a._type?(this._value=a._value,this._type=a._type):(this._value=a,this._type=null);return this};return this}function f(){this._term={_value:null};this._rules=[];return this}"function"!==typeof Object.getPrototypeOf&&(Object.getPrototypeOf="object"===typeof"test".__proto__?function(a){return a.__proto__}:function(a){return a.constructor.prototype});void 0===Function.prototype.name&&void 0!==Object.defineProperty&&
Object.defineProperty(Function.prototype,"name",{get:function(){var a=/function\s([^(]{1,})\(/.exec(this.toString());return a&&1<a.length?a[1].trim():""},set:function(a){}});d=function(k,c){"undefined"===typeof k&&d.error(Error("Missing required parameter for smallmachine constructor: one or more instances of type [object Ontology]"));for(var b=[].concat(k),n="",g=0;g<b.length;g++)"function"!==typeof b[g].ofType||!b[g].ofType("Ontology")?"undefined"!==typeof d.ontology[b[g]]&&(n=n+b[g]+",",b[g]=d.ontology[b[g]]):
n+=b[g].title;n=new e(n.substring(0,n.length-1));for(g=0;g<b.length;g++){for(var m in b[g])b[g].hasOwnProperty(m)&&"function"===typeof b[g][m].ofType&&b[g][m].ofType("Proxy")&&n.addTerm(b[g][m]._term._value);for(var f=0;f<b[g]._inferencer._rules.length;f++)n._inferencer._rules.push(b[g]._inferencer._rules[f]);for(f=0;f<b[g]._activators.length;f++){var h=a(b,b[g]._activators[f]);null!==h&&d.error(Error("Cannot wire-in ontology with missing activator dependency on '"+h+"'"));n.registerActivator(b[g]._activators[f]);
n._activators.sort(function(a,k){if(a.title==k.title)return 0;for(var c=0;c<a.dependencies.length;c++)if(k.title==a.dependencies[c])return 1;for(c=0;c<k.dependencies.length;c++)if(a.title==k.dependencies[c])return-1;return 0})}}return n.getModel(c)};d.alsoBehavesLike=function(a,c){("undefined"===typeof a||"undefined"===typeof c)&&d.error(Error("Cannot mixin with an undefined object"));for(var b in c)if(c.hasOwnProperty(b)&&!(0==b.indexOf("_")||"initializer"===b))if("undefined"!==typeof a[b]){if("undefined"!==
typeof c[b].prototype){if("undefined"!==typeof c[b].prototype.initializer&&!0==c[b].prototype.initializer)continue;var e="undefined"!==typeof c[b].prototype.virtual?c[b].prototype.virtual:!1}var g="undefined"!==typeof a[b].prototype?a[b].prototype.virtual:!1;if(!g||!e)g&&(a[b]=c[b])}else a[b]=c[b];"undefined"!==typeof c.prototype&&("undefined"===typeof a.prototype&&(a.prototype={}),d.alsoBehavesLike(a.prototype,c.prototype))};d.error=function(a,c){if("undefined"!==typeof c&&"function"===typeof c.handleError)c.handleError(a);
else if("function"===typeof d.handleError)d.handleError(a);else throw a;};var b=function(a){var c=16*Math.random()|0;return("x"==a?c:c&3|8).toString(16)};d.getGuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,b)};d.CONCEPT="concept";d.RELATIONSHIP="relationship";l.prototype.getType=function(){return"[object Proxy]"};l.prototype.ofType=function(a){return"Proxy"===a||"function"===typeof a.getType&&a.getType()===this.getType()};h.prototype.relate=function(a){"undefined"===
typeof this._relatesTo&&(this._relatesTo=[]);for(var c=!1,b=0;b<this._relatesTo.length;b++)if(this._relatesTo[b]._id==a._id){c=!0;break}c||this._relatesTo.push(a)};h.prototype.getType=function(){return"[object Term]"};h.prototype.ofType=function(a){return"Term"===a||"function"===typeof a.getType&&a.getType()===this.getType()};d.Behavior=function(a){this.title=a;return this};e.prototype.getType=function(){return"[object Ontology]"};e.prototype.addTerm=function(a){if("undefined"!==typeof this[a])return this;
var c=this._term;c.prototype.relate=h.prototype.relate;c.prototype.getType=h.prototype.getType;c.prototype.ofType=h.prototype.ofType;c=new c(a);this[a]=new l(c,this._inferencer);return this};e.prototype.registerActivator=function(a,c){"undefined"===typeof c&&(c=[]);"function"!==typeof a&&"function"===typeof a.getType&&"[object Activator]"===a.getType()?this._activators.push(a):this._activators.push({fn:a,title:this.title,dependencies:c,getType:function(){return"[object Activator]"}})};e.prototype.getModel=
function(a){var c=new function(a){return this},b=[];if("undefined"!==typeof a){b=b.concat(a);for(a=0;a<b.length;a++)if("undefined"===typeof b[a]&&d.error("One or more [behaviors] arguments were supplied to the smallmachine constructor that are 'undefined'; error creating object model"),"undefined"!==typeof b[a].prototype&&!0===b[a].prototype.initializer)b[a](c)}for(var e in this)if(this.hasOwnProperty(e)&&!("undefined"===typeof this[e]||"undefined"===this[e]._term)&&0!==e.indexOf("_"))if("undefined"!==
typeof this[e]._term){c[e]=this[e]._term;for(a=0;a<b.length;a++)d.alsoBehavesLike(Object.getPrototypeOf(c[e]),b[a].prototype)}else c[e]=this[e];this._inferencer._rules.sort(function(a,c){return a._priority-c._priority});for(a=0;a<this._inferencer._rules.length;a++)b=this._inferencer._rules[a],b._fn.apply(c,b._args);for(a=0;a<this._activators.length;a++)this._activators[a].fn(c);return c};d.Ontology=e;var c=function(a,c,b){this._fn=c;this._args=b;this._priority=a;return this};f.prototype.isA=function(a){this._rules.push(new c(1,
q,[this._term._value,a._term._value]));return this};f.prototype.relatesTo=function(a,b){this._rules.push(new c(10,g,[this._term._value,a._term._value,b._term._value]));return this};f.prototype.hasDomain=function(a){this._rules.push(new c(3,s,[this._term._value,a._term._value]));return this};f.prototype.hasRange=function(a){this._rules.push(new c(2,m,[this._term._value,a._term._value]));return this};d.alsoBehavesLike(l,f);var g=function(a,c,b){a=this[a];var e=this[c],g=this[b];e._type===d.CONCEPT?
d.error(Error("Cannot define a relationship with a concept type: "+e._value)):null===e._type&&(e._type=d.RELATIONSHIP);g._type===d.RELATIONSHIP?d.error(Error("Cannot create a relationship with a relationship type: "+g._value)):null===g._type&&(g._type=d.CONCEPT);a._type===d.RELATIONSHIP?d.error(Error("Cannot create a relationship from a relationship type: "+a._value)):null===a._type&&(a._type=d.CONCEPT);"undefined"===typeof a[c]&&(a[c]=new a.constructor(e));"undefined"===typeof a[c][b]&&(a[c][b]=
g);"undefined"===typeof a[b]&&(a[b]=g);g.relate(a[c]);for(var f in g)g.hasOwnProperty(f)&&(g[f].getType&&"[object Term]"===g[f].getType())&&("undefined"===typeof a[c][f]&&(a[c][f]=g[f]),"undefined"===typeof a[f]&&(a[f]=g[f]),g[f].relate(a[c]))},q=function(a,c){var b=this[a],e=this[c];e._type===d.RELATIONSHIP?d.error(Error("Cannot apply isA to a relationship type: "+e._value)):null===e._type&&(e._type=d.CONCEPT);b._type===d.RELATIONSHIP?d.error(Error("Cannot apply isA to a relationship type: "+b._value)):
null===b._type&&(b._type=d.CONCEPT);"undefined"===typeof e[a]&&(e[a]=b)},m=function(a,c){var b=this[a],e=this[c];e._type===d.RELATIONSHIP?d.error(Error("Cannot apply hasRange to a relationship type: "+e._value)):null===e._type&&(e._type=d.CONCEPT);b._type===d.CONCEPT?d.error(Error("Cannot assign hasRange from a concept type: "+b._value)):null===b._type&&(b._type=d.RELATIONSHIP);"undefined"===typeof b[c]&&(b[c]=e);e.relate(b);for(var g in e)if(e.hasOwnProperty(g)&&e[g].getType&&"[object Term]"===e[g].getType()){var f=
e[g]._value;"undefined"===typeof b[f]&&(b[f]=e[g]);e[g].relate(b)}},s=function(a,c){var b=this[a],e=this[c];e._type===d.RELATIONSIP?d.error(Error("Cannot apply hasRange to a relationship type: "+e._value)):null===e._type&&(e._type=d.CONCEPT);b._type===d.CONCEPT?d.error(Error("Cannot assign hasRange from a concept type: "+b._value)):null===b._type&&(b._type=d.RELATIONSHIP);"undefined"===typeof e[a]&&(e[a]=b)};d.typeMask=function(a,c){var b=[],e;for(e in c)c.hasOwnProperty(e)&&("undefined"===typeof a||
"undefined"===typeof a[e]?b.push(e):"undefined"!==typeof a[e]&&typeof a[e]!==c[e]&&!0!==c[e]&&b.push(e));return 0===b.length?null:b};return d}(smallmachine||{});(function(d){var a=new d.Ontology("sm.properties");a.addTerm("property");a.addTerm("type");a.addTerm("ontology");a.addTerm("behavior");a.addTerm("hasMemberType");a.addTerm("hasMember");a.addTerm("Ontology");a.addTerm("Behavior");a.addTerm("Constructor");a.addTerm("Null");a.ontology.isA(a.property);a.behavior.isA(a.property);a.Ontology.isA(a.type);a.Behavior.isA(a.type);a.Constructor.isA(a.type);a.Null.isA(a.type);a.ontology.relatesTo(a.hasMemberType,a.Ontology);a.behavior.relatesTo(a.hasMemberType,
a.Behavior);a.ontology.relatesTo(a.hasMember,a.Null);a.behavior.relatesTo(a.hasMember,a.Null);var l=function(){return this};l.prototype.extendedBy=function(a,f){if("undefined"!==typeof f&&"function"===typeof a)"undefined"!==typeof this[f]?d.alsoBehavesLike(this[f],a):this[f]=a,"function"!==typeof this[f].prototype.getType&&(this[f].prototype.getType=function(){return"[object "+f+"]"}),"function"!==typeof this[f].prototype.ofType&&(this[f].prototype.ofType=function(a){return"function"===typeof a.getType?
this.getType()===a.getType():this.getType()==="[object "+a+"]"});else{var b=f||a.title;"undefined"===typeof b&&d.error(Error("Cannot call extendedBy on the core ontology with an object that is missing the 'title' property without specifying a 'typeName'"));if("undefined"!==typeof this[b])d.alsoBehavesLike(this[b],a);else{var c=this.hasMemberType;("undefined"===typeof c||"undefined"===typeof c.getType)&&d.error(Error("The specified concept does not have a valid 'hasMemberType' relationship with another concept"));
var g=d[this._value][c._value];"undefined"===typeof g&&d.error(Error("The specified type does not exist in the core object model: "+c._value));"function"!==typeof a.getType&&d.error(Error("The specified model is missing the getType function: "+b));var c=a.getType(),h=!1,m;for(m in g)if(g.hasOwnProperty(m)&&"undefined"!==typeof this[m].getType&&"[object "+m+"]"===c){this.hasMember[b]=a;this[b]=a;h=!0;break}h||d.error(Error("Did not find an allowed model type for: "+c))}}};var h=function(){this.title=
"Null";return this};h.prototype.getType=function(){return"[object Null]"};h.prototype.ofType=function(a){return null===a||"null"===a||"Null"===a?!0:!1};d.alsoBehavesLike(d,a.getModel(l));d.ontology.extendedBy(new h);d.behavior.extendedBy(new h);a=function(a){this._channel=a;return this};a.prototype.publish=function(a,d){this._channel.publish(a,d);return this};d.type.extendedBy(a,"AsyncResult");a=function(a,f,b){"undefined"===typeof f&&d.error(Error("Parameter 'key' is required when instantiating the sm.NamedValue type"));
this.namespace=a;this.key=f;this.value=b;return this};a.prototype.adapt=function(a,f){this.namespace=a;if("undefined"!==typeof f)for(var b=[].concat(f),c=0;c<b.length;c++)d.alsoBehavesLike(this,b[c]);return this};d.type.extendedBy(a,"NamedValue");a=function(){this.title="NamedValueCollection";this._collection={};return this};a.prototype.exists=function(a,f){var b=a;null===d.typeMask(a,{namespace:!0,key:!0})&&(b=a.namespace,f=a.key);return"undefined"!==typeof this._collection[b]&&"undefined"!==typeof this._collection[b][f]};
a.prototype.add=function(a,f,b){var c=a.namespace||a,g=a.key||f;"undefined"!==typeof this._collection[c]&&"undefined"!==this._collection[c][g]&&d.error(Error("Cannot add a new entry to the collection (already exists): ["+c+"]"+g));this.modify(a,f,b);return this};a.prototype.modify=function(a,f,b){var c=a.namespace||a;f=a.key||f;a=a.value||b;"undefined"===typeof f&&d.error(Error("Must supply a valid key"));"undefined"===typeof a&&d.error(Error("Must supply a valid value"));"undefined"===typeof this._collection[c]&&
(this._collection[c]={});this._collection[c][f]=a;return this};a.prototype.remove=function(a,d){if(!("undefined"===typeof this._collection[a]||"undefined"===typeof this._collection[a][d]))return delete this._collection[a][d],this};a.prototype.getValue=function(a,d){var b=a.namespace||a,c=a.key||d;if(!("undefined"===typeof this._collection[b]||"undefined"===this._collection[b][c]))return b=this._collection[b][c],"undefined"!==typeof b&&("function"===typeof a.setValue?a.setValue(b):"undefined"!==typeof a.value&&
(a.value=b)),b};a.prototype.ofType=function(a){return"NamedValueCollection"===a||"function"===typeof a.getType&&a.getType()===this.getType()};d.type.extendedBy(a,"NamedValueCollection")})(smallmachine);(function(d){var a=new d.Ontology("sm.channels");a.addTerm("thing");a.addTerm("user");a.addTerm("system");a.addTerm("action");a.addTerm("click");a.addTerm("doubleClick");a.addTerm("keyPress");a.addTerm("task");a.addTerm("initialize");a.addTerm("insert");a.addTerm("remove");a.addTerm("get");a.addTerm("set");a.addTerm("messenger");a.addTerm("success");a.addTerm("error");a.addTerm("performs");a.addTerm("reactsTo");a.user.isA(a.thing);a.user.relatesTo(a.performs,a.action);a.system.isA(a.thing);a.system.relatesTo(a.performs,
a.task);a.action.isA(a.thing);a.task.isA(a.thing);a.messenger.isA(a.thing);a.click.isA(a.action);a.doubleClick.isA(a.action);a.keyPress.isA(a.action);a.get.isA(a.task);a.set.isA(a.task);a.success.isA(a.messenger);a.error.isA(a.messenger);a.initialize.isA(a.task);a.insert.isA(a.task);a.remove.isA(a.task);a.performs.hasRange(a.action).hasRange(a.task);a.reactsTo.hasRange(a.action).hasDomain(a.system);a.registerActivator(function(a){var e=function(c,b){if("undefined"!==typeof jQuery)try{jQuery.ajax({dataType:"json",
url:c,type:"GET",success:function(e,f,m){a.messenger.success.publish(f);b.publish(new d.type.NamedValue("sm.channels",c,e))},error:function(a,c,b){d.error(Error(b))}})}catch(e){d.error(Error(e))}else{var f=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP.3.0");f.onprogress=function(){};f.onerror={};f.onreadystatechange=function(){4>f.readyState||(200==f.status?(a.messenger.success.publish(f.statusText),b.publish(new d.type.NamedValue("sm.channels",c,JSON.parse(f.responseText)))):
d.error(Error(f.statusText)))};f.open("GET",c,!0);f.setRequestHeader("X-Requested-With","XMLHttpRequest");f.setRequestHeader("Content-type","application/json");f.send(null)}return b},f={update:function(c){return"function"===typeof c.ofType&&c.ofType("NamedValue")?function(c){a.memory.modify(c)}:!1}};d.alsoBehavesLike(a,{memory:new d.type.NamedValueCollection});a.set.subscribe({update:function(a){return f}});var b={update:function(c){return"function"===typeof c.ofType?function(c){a.memory.getValue(c)}:
!1}};a.get.subscribe({update:function(a){return b}});"function"===typeof a.initialize.addHelper&&a.initialize.addHelper("json",e);"function"===typeof a.set.addHelper&&a.set.addHelper("config",function(a){return new d.type.NamedValue("sm.channels","config",a)});"function"===typeof a.get.addHelper&&(a.get.addHelper("json",e),e=function(){this.namespace="sm.channels";this.key="config";return this},e.prototype.setValue=function(a){d.alsoBehavesLike(this,a)},d.type.extendedBy(e,"Config"),a.get.addHelper("config",
function(a){return a}))});try{d.ontology.extendedBy(a)}catch(l){d.error(Error("Could not extend the smallmachine.ontology property with the 'sm.channels' ontology: "+l.message+"\n"+l.stack))}})(smallmachine);(function(d){var a=function(a,d){this._value=a;this._type=d;return this};a.prototype.forward=function(a,d){null!=this._value&&(d[this._value]=!0);for(var e in this)if(this.hasOwnProperty(e)&&!("function"===typeof this[e]||0===e.indexOf("_"))&&!0!==d[e]&&"function"===typeof this[e].publish)d[e]=!0,this[e].publish(a,d);if("undefined"!==typeof this._relatesTo)for(e=0;e<this._relatesTo.length;e++)"undefined"!==typeof this._relatesTo[e]._subscribers&&this.notify(a,this._relatesTo[e]._subscribers)};a.prototype.unsubscribe=
function(a){"undefined"!==typeof this._subscribers&&delete this._subscribers[a]};a.prototype.subscribe=function(a){"undefined"===typeof this._subscribers&&(this._subscribers={});var h=d.getGuid();"function"===typeof a?this._subscribers[h]={update:a,lifetime:1}:("undefined"===typeof a.lifecycle&&(a.lifetime=1),this._subscribers[h]=a);return h};a.prototype.notify=function(a,h){var e=!1,f={},b=0,c=[],g;for(g in h){var q=h[g].update(a);"undefined"!==typeof h[g]&&(0>=h[g].lifetime&&this.unsubscribe(g),
!0===q?e=!0:"function"===typeof q?(c.push(q),e=!0):q&&"function"===typeof q.update&&(f[d.getGuid()]=q,b++))}if(e){g=!1;for(q=0;q<c.length;q++)!1===!c[q](a)&&(g=!0);!1===g&&(e=!1)}!1==e&&0<b&&this.notify(a,f)};a.prototype.publish=function(a,h){h=h||{};if("function"===typeof a&&(a=a(new d.type.AsyncResult(this)),"undefined"!==typeof a&&"function"===typeof a.getType&&"[object AsyncResult]"===a.getType()))return this;if("undefined"===typeof this._subscribers)return this.forward(a,h),this;this.notify(a,
this._subscribers);this.forward(a,h);return this};a.prototype.addHelper=function(d,h){var e=a.prototype.publish,f=this;this[d]=function(){for(var a=[],c=0;c<arguments.length;c++)a.push(arguments[c]);return e.apply(f,[function(c){a.push(c);return h.apply(f,a)}])};return this};a.prototype.getType=function(){return"[object Channel]"};a.prototype.ofType=function(a){return"Channel"===a||"function"===typeof a.getType&&a.getType()===this.getType()};d.behavior.extendedBy(a,"Channel")})(smallmachine);(function(d,a){var l=function(d){"undefined"!==typeof a.fn&&a.extend({sm:d});return this};l.prototype.initializer=!0;d.behavior.extendedBy(l,"Extension")})(smallmachine,jQuery||{});(function(d){var a=new d.Ontology("sm.nodes");a.addTerm("task");a.addTerm("insert");a.addTerm("connect");a.addTerm("set");a.addTerm("get");a.addTerm("paint");a.addTerm("paintNodes");a.paint.isA(a.task);a.insert.isA(a.task);a.connect.isA(a.task);a.set.isA(a.task);a.get.isA(a.task);a.paintNodes.isA(a.paint);var l=function(a,c,g,e){this.id=a.id||d.getGuid();this.width=parseFloat(a.width)||50;this.height=parseFloat(a.height)||50;this.y=parseFloat(a.y);this.x=parseFloat(a.x);this.edges=a.edges||[];this.label=
a.label||this.id;this.paper=c;this.shapeAttr=g;this.shapeLabelAttr=e;this.data={};return this};l.prototype.update=function(a){a=this.paper.circle(this.x,this.y,this.width/2,this.height/2);a.id=this.id;"function"===typeof this.shapeAttr?this.shapeAttr(a,this):a.attr(this.shapeAttr);a=this.paper.text(this.x,this.y,this.label);"function"===typeof this.shapeLabelAttr?this.shapeLabelAttr(a,this):a.attr(this.shapeLabelAttr);return!0};var h=function(a,c,d,e,f,h){this.id1=a.id;this.id2=c.id;this.r1=a.width/
2;this.r2=c.width/2;this.x1=parseFloat(a.x);this.y1=parseFloat(a.y);this.x2=parseFloat(c.x);this.y2=parseFloat(c.y);this.label=a.edges[d].label||"";this.paper=e;this.lineAttr=f;this.edgeLabelAttr=h;this.data={};return this};h.prototype.update=function(a){var c=Math.sqrt(Math.pow(this.x2-this.x1,2)+Math.pow(this.y2-this.y1,2));a=this.r1/c;c=(c-this.r2)/c;a=this.paper.path(["M",a*this.x2+(1-a)*this.x1,a*this.y2+(1-a)*this.y1,"L",c*this.x2+(1-c)*this.x1,c*this.y2+(1-c)*this.y1]);"function"===typeof this.lineAttr?
this.lineAttr(a,this):a.attr(this.lineAttr);a=this.paper.text((this.x1+this.x2)/2,(this.y1+this.y2)/2,this.label);"function"===typeof this.edgeLabelAttr?this.edgeLabelAttr(a,this):a.attr(this.edgeLabelAttr);c=180*Math.atan2(this.y2-this.y1,this.x2-this.x1)/Math.PI;90<c?a.transform("t-6,-6r"+(c+180)):a.transform("t6,-6r"+c);return!0};var e=function(a){this._model=a;this.handleError=function(c){a.messenger.error.publish(c)};return this};e.prototype.update=function(a){var c=new d.type.Config;this._model.system.get.config(c);
a=a.value;if("undefined"===typeof a)return!1;null!==d.typeMask(a,{length:!0,sort:"function"})&&d.error(Error("Cannot determine the JSON type; expecting an array (or comparable object) of node objects but received "+a),this);var e=new d.type.NamedValue("sm.raphaeljs","paper",null);this._model.get.publish(e);e.value.clear();for(var f=0;f<a.length;f++){for(var m=new l(a[f],e.value,c.shapeAttr||{},c.shapeLabelAttr||{}),s=0;s<m.edges.length;s++){var k;a:{for(k=0;k<a.length;k++)if(a[k].id===m.edges[s].id){k=
a[k];break a}k=null}null!==k&&("undefined"!=typeof k.x&&"undefined"!==typeof k.y)&&(k=new h(m,k,s,e.value,c.lineAttr||{},c.edgeLabelAttr||{}),this._model.connect.publish(k))}this._model.insert.publish(m)}};a.registerActivator(function(a){var c=new e(a);a.paintNodes.subscribe(function(a){return c});a.connect.subscribe(function(a){return a});a.insert.subscribe(function(a){return a})},["sm.channels","sm.raphaeljs"]);try{d.ontology.extendedBy(a)}catch(f){d.error(Error("Could not extend the smallmachine.ontology property with the 'sm.nodes' ontology: "+
f.message+"\n"+f.stack))}})(smallmachine);(function(d,a,l){a=new d.Ontology("sm.flowchart");a.addTerm("paint");a.addTerm("get");var h=function(a,b,d,e){"undefined"===typeof a?(this.y=50,this.previousSector={y:0,height:0}):(this.previousSector=a,this.y=this.previousSector.y+this.previousSector.height+80);this.height=0;this.x=0.5*b;this.width=0;this.layoutWidth=b;this.lastNodeGroup=null;this.nodeGroups=0;this.nodes=[];return this};h.prototype.add=function(a,b){var d=parseFloat(a.width);null===this.lastNodeGroup?this.lastNodeGroup=b:this.lastNodeGroup!=
b&&(this.nodeGroups++,this.lastNodeGroup=b);this.width=this.width+40+d;var e=parseFloat(a.height);this.height=this.height<e?e:this.height;this.x=this.x-20-0.5*d;for(e=d=0;e<a.edges.length;e++)a.edges[e].label.length>d&&(d=a.edges[e].label.length);6<d&&(d=this.height+10*(d-6),d>this.height&&(this.height=d));this.nodes.push({node:a,nodeGroup:b})};h.prototype.finalize=function(a){if("undefined"===typeof a||0>a)a=0;a*=0.5;for(var b=null,d=0,e=0;e<this.nodes.length;e++)null===b?b=this.nodes[e].nodeGroup:
this.nodes[e].nodeGroup!=b&&(d++,b=this.nodes[e].nodeGroup),this.nodes[e].node.x=this.x+(40*e+40*d)+this.nodes[e].node.width*e+a,this.nodes[e].node.y=this.y};var e=function(a){this.paper=a;this.width=parseFloat(a.width);this.height=parseFloat(a.height);this.finalWidth=this.width;this.finalHeight=this.height;this.sectors=[];return this};e.prototype.addToSector=function(a,b,d){var e=this.sectors[b];"undefined"===typeof e&&(e=new h(this.sectors[b-1],this.width,this.height,d),this.sectors[b]=e);e.add(a,
d)};e.prototype.finalize=function(){for(var a=0;a<this.sectors.length;a++)this.sectors[a].width+=40*this.sectors[a].nodeGroups,this.sectors[a].width>this.finalWidth&&(this.finalWidth=this.sectors[a].width);for(a=0;a<this.sectors.length;a++)this.sectors[a].finalize(this.finalWidth-this.width)};var f=function(a,b,d,e,h,k){e.addToSector(a,h++,k);for(k=0;k<a.edges.length;k++)f(b[d[a.edges[k].id]],b,d,e,h,a.id)};a.registerActivator(function(a){a.paint.subscribe(function(b){if(null===d.typeMask(b.value,
{length:!0,sort:"function"}))return function(h){h=b.value;var m=new d.type.NamedValue("sm.flowchart","root",null);a.get.publish(m);var l=new d.type.NamedValue("sm.raphaeljs","paper",null);a.get.publish(l);for(var k=new e(l.value),m=m.value,p={},r=h[0],n=0;n<h.length;n++)p[h[n].id]=n,h[n].id===m&&(r=h[n]);f(r,h,p,k,0,r.id);k.finalize();l.value.setSize(1.05*k.finalWidth,1.05*k.finalHeight);return!1}})},["sm.channels","sm.nodes","sm.raphaeljs"]);try{d.ontology.extendedBy(a)}catch(b){d.error(Error("Could not extend the smallmachine.ontology property with the 'sm.nodes' ontology: "+
b.message+"\n"+b.stack))}})(smallmachine,jQuery,Raphael);(function(d,a){var l=new d.Ontology("sm.raphaeljs");l.addTerm("set");l.registerActivator(function(e){var f=/^(\d+)%?$/,b=function(c,b,e,h){h=document.getElementById(c+"");if("undefined"===typeof h||!h)throw Error("The specified element ID could not be found: "+c);var l=window,k=document,p=k.documentElement,r=k.getElementsByTagName("body")[0],k=l.innerWidth||p.clientWidth||r.clientWidth,l=l.innerHeight||p.clientHeight||r.clientHeight,p=b;null===b&&(p=h.offsetWidth||k);r=f.exec(p+"");if(!r)throw Error("The specified value for width is invalid (number, percentage or null allowed): "+
b);"function"===typeof p.indexOf&&0<p.indexOf("%")&&(p=100*(h.offsetWidth||k)/parseFloat(r[0]));b=e;null==e&&(b=h.offsetHeight||l);k=f.exec(b+"");if(!k)throw Error("The specified value for height is invalid (number, percentage or null allowed): "+e);"function"===typeof b.indexOf&&0<b.indexOf("%")&&(b=(h.offsetHeight||l)*parseFloat(k[0])/100);c=a(c,p,b);return new d.type.NamedValue("sm.raphaeljs","paper",c)};"function"===typeof e.set.addHelper&&e.set.addHelper("svg",b)},["sm.channels"]);try{d.ontology.extendedBy(l)}catch(h){throw Error("Could not extend the smallmachine.ontology property with the 'sm.raphaeljs' ontology: "+
h.message+"\n"+h.stack);}})(smallmachine,Raphael);(function(d,a){var l=new d.Ontology("sm.sammyjs");l.addTerm("initialize");d.type.extendedBy(function(a,b,c){this._id=a;this._callback=b;this._runArg=c||"#/";return this},"Sammy");var h={update:function(e){return null===d.typeMask(e,{_id:!0,_callback:!0,_runArg:!0})?function(b){a("#"+b._id,b._callback).run(b._runArg)}:!1}};l.registerActivator(function(a){a.initialize.subscribe({update:function(a){return h}})},["sm.channels"]);try{d.ontology.extendedBy(l)}catch(e){throw Error("Could not extend the smallmachine.ontology property with the 'sm.sammyjs' ontology: "+
e.message+"\n"+e.stack);}})(smallmachine,Sammy);
