var smallmachine=function(b){"function"!==typeof Object.getPrototypeOf&&(Object.getPrototypeOf="object"===typeof"test".__proto__?function(g){return g.__proto__}:function(g){return g.constructor.prototype});var a=function(g,a){for(var d=0;d<a.dependencies.length;d++){for(var b=!1,e=0;e<g.length;e++)if(a.dependencies[d]==g[e].title){b=!0;break}if(!b)return a.dependencies[d]}return null};b=function(g,e){"undefined"===typeof g&&b.error(Error("Missing required parameter for smallmachine constructor: one or more instances of type [object Ontology]"));
for(var d=[].concat(g),k="",l=0;l<d.length;l++)"function"!==typeof d[l].ofType||!d[l].ofType("Ontology")?"undefined"!==typeof b.ontology[d[l]]&&(k=k+d[l]+",",d[l]=b.ontology[d[l]]):k+=d[l].title;k=new b.Ontology(k.substring(0,k.length-1));for(l=0;l<d.length;l++){for(var f in d[l])d[l].hasOwnProperty(f)&&"function"===typeof d[l][f].ofType&&d[l][f].ofType("Proxy")&&k.addTerm(d[l][f]._term._value);for(var c=0;c<d[l]._inferencer._rules.length;c++)k._inferencer._rules.push(d[l]._inferencer._rules[c]);
for(c=0;c<d[l]._activators.length;c++){var m=a(d,d[l]._activators[c]);null!==m&&b.error(Error("Cannot wire-in ontology with missing activator dependency on '"+m+"'"));k.registerActivator(d[l]._activators[c]);k._activators.sort(function(g,a){if(g.title==a.title)return 0;for(var d=0;d<g.dependencies.length;d++)if(a.title==g.dependencies[d])return 1;for(d=0;d<a.dependencies.length;d++)if(g.title==a.dependencies[d])return-1;return 0})}}return k.getModel(e)};b.alsoBehavesLike=function(g,a){("undefined"===
typeof g||"undefined"===typeof a)&&b.error(Error("Cannot mixin with an undefined object"));for(var d in a)if(a.hasOwnProperty(d)&&!(0==d.indexOf("_")||"initializer"===d))if("undefined"!==typeof g[d]){if("undefined"!==typeof a[d].prototype){if("undefined"!==typeof a[d].prototype.initializer&&!0==a[d].prototype.initializer)continue;var e="undefined"!==typeof a[d].prototype.virtual?a[d].prototype.virtual:!1}var c="undefined"!==typeof g[d].prototype?g[d].prototype.virtual:!1;if(!c||!e)c&&(g[d]=a[d])}else g[d]=
a[d];"undefined"!==typeof a.prototype&&("undefined"===typeof g.prototype&&(g.prototype={}),b.alsoBehavesLike(g.prototype,a.prototype))};b.error=function(a,e){if("undefined"!==typeof e&&"function"===typeof e.handleError)e.handleError(a);else if("function"===typeof b.handleError)b.handleError(a);else throw a;};b.CONCEPT="concept";b.RELATIONSHIP="relationship";var h=function(a,e){this._term=a;this._rules=e._rules;return this};h.prototype.getType=function(){return"[object Proxy]"};h.prototype.ofType=
function(a){return"Proxy"===a||"function"===typeof a.getType&&a.getType()===this.getType()};var c=function(){return this};c.prototype.relate=function(a){"undefined"===typeof this._relatesTo&&(this._relatesTo=[]);for(var e=!1,d=0;d<this._relatesTo.length;d++)if(this._relatesTo[d]._id==a._id){e=!0;break}e||this._relatesTo.push(a)};c.prototype.getType=function(){return"[object Term]"};c.prototype.ofType=function(a){return"Term"===a||"function"===typeof a.getType&&a.getType()===this.getType()};b.Behavior=
function(a){this.title=a;return this};b.Ontology=function(a){this.title=a;this._inferencer=new e;this._activators=[];this._term=function(a){this._id=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var g=16*Math.random()|0;return("x"==a?g:g&3|8).toString(16)})}();"undefined"!==typeof a._value&&"undefined"!==typeof a._type?(this._value=a._value,this._type=a._type):(this._value=a,this._type=null);return this};return this};b.Ontology.prototype.getType=function(){return"[object Ontology]"};
b.Ontology.prototype.addTerm=function(a){if("undefined"!==typeof this[a])return this;var e=this._term;e.prototype.relate=c.prototype.relate;e.prototype.getType=c.prototype.getType;e.prototype.ofType=c.prototype.ofType;e=new e(a);this[a]=new h(e,this._inferencer);return this};b.Ontology.prototype.registerActivator=function(a,e){"undefined"===typeof e&&(e=[]);"function"!==typeof a&&"function"===typeof a.getType&&"[object Activator]"===a.getType()?this._activators.push(a):this._activators.push({fn:a,
title:this.title,dependencies:e,getType:function(){return"[object Activator]"}})};b.Ontology.prototype.getModel=function(a){var e=new function(a){return this},d=[];if("undefined"!==typeof a){d=d.concat(a);for(a=0;a<d.length;a++)if("undefined"!==typeof d[a].prototype&&!0===d[a].prototype.initializer)d[a](e)}for(var k in this)if(this.hasOwnProperty(k)&&!("undefined"===typeof this[k]||"undefined"===this[k]._term)&&0!==k.indexOf("_"))if("undefined"!==typeof this[k]._term){e[k]=this[k]._term;for(a=0;a<
d.length;a++)b.alsoBehavesLike(Object.getPrototypeOf(e[k]),d[a].prototype)}else e[k]=this[k];this._inferencer._rules.sort(function(a,e){return a._priority-e._priority});for(a=0;a<this._inferencer._rules.length;a++)d=this._inferencer._rules[a],d._fn.apply(e,d._args);for(a=0;a<this._activators.length;a++)this._activators[a].fn(e);return e};var e=function(){this._term={_value:null};this._rules=[];return this},m=function(a,e,d){this._fn=e;this._args=d;this._priority=a;return this};e.prototype.isA=function(a){this._rules.push(new m(1,
f,[this._term._value,a._term._value]));return this};e.prototype.relatesTo=function(a,e){this._rules.push(new m(10,p,[this._term._value,a._term._value,e._term._value]));return this};e.prototype.hasDomain=function(a){this._rules.push(new m(3,q,[this._term._value,a._term._value]));return this};e.prototype.hasRange=function(a){this._rules.push(new m(2,n,[this._term._value,a._term._value]));return this};b.alsoBehavesLike(h,e);var p=function(a,e,d){a=this[a];var k=this[e],c=this[d];k._type===b.CONCEPT?
b.error(Error("Cannot define a relationship with a concept type: "+k._value)):null===k._type&&(k._type=b.RELATIONSHIP);c._type===b.RELATIONSHIP?b.error(Error("Cannot create a relationship with a relationship type: "+c._value)):null===c._type&&(c._type=b.CONCEPT);a._type===b.RELATIONSHIP?b.error(Error("Cannot create a relationship from a relationship type: "+a._value)):null===a._type&&(a._type=b.CONCEPT);"undefined"===typeof a[e]&&(a[e]=new a.constructor(k));"undefined"===typeof a[e][d]&&(a[e][d]=
c);"undefined"===typeof a[d]&&(a[d]=c);c.relate(a[e]);for(var f in c)c.hasOwnProperty(f)&&(c[f].getType&&"[object Term]"===c[f].getType())&&("undefined"===typeof a[e][f]&&(a[e][f]=c[f]),"undefined"===typeof a[f]&&(a[f]=c[f]),c[f].relate(a[e]))},f=function(a,e){var d=this[a],c=this[e];c._type===b.RELATIONSHIP?b.error(Error("Cannot apply isA to a relationship type: "+c._value)):null===c._type&&(c._type=b.CONCEPT);d._type===b.RELATIONSHIP?b.error(Error("Cannot apply isA to a relationship type: "+d._value)):
null===d._type&&(d._type=b.CONCEPT);"undefined"===typeof c[a]&&(c[a]=d)},n=function(a,e){var d=this[a],c=this[e];c._type===b.RELATIONSHIP?b.error(Error("Cannot apply hasRange to a relationship type: "+c._value)):null===c._type&&(c._type=b.CONCEPT);d._type===b.CONCEPT?b.error(Error("Cannot assign hasRange from a concept type: "+d._value)):null===d._type&&(d._type=b.RELATIONSHIP);"undefined"===typeof d[e]&&(d[e]=c);c.relate(d);for(var f in c)if(c.hasOwnProperty(f)&&c[f].getType&&"[object Term]"===c[f].getType()){var m=
c[f]._value;"undefined"===typeof d[m]&&(d[m]=c[f]);c[f].relate(d)}},q=function(a,e){var d=this[a],c=this[e];c._type===b.RELATIONSIP?b.error(Error("Cannot apply hasRange to a relationship type: "+c._value)):null===c._type&&(c._type=b.CONCEPT);d._type===b.CONCEPT?b.error(Error("Cannot assign hasRange from a concept type: "+d._value)):null===d._type&&(d._type=b.RELATIONSHIP);"undefined"===typeof c[a]&&(c[a]=d)};b.typeMask=function(a,e){var d=[],c;for(c in e)e.hasOwnProperty(c)&&(!0===e[c]?"undefined"===
typeof a[c]&&d.push(c):"undefinedf"!==typeof a[c]&&typeof a[c]!==e[c]&&d.push(c));return 0===d.length?null:d};return b}(smallmachine||{});(function(b){var a=new b.Ontology("sm.properties");a.addTerm("property");a.addTerm("type");a.addTerm("ontology");a.addTerm("behavior");a.addTerm("hasMemberType");a.addTerm("hasMember");a.addTerm("Ontology");a.addTerm("Behavior");a.addTerm("Constructor");a.addTerm("Null");a.ontology.isA(a.property);a.behavior.isA(a.property);a.Ontology.isA(a.type);a.Behavior.isA(a.type);a.Constructor.isA(a.type);a.Null.isA(a.type);a.ontology.relatesTo(a.hasMemberType,a.Ontology);a.behavior.relatesTo(a.hasMemberType,
a.Behavior);a.ontology.relatesTo(a.hasMember,a.Null);a.behavior.relatesTo(a.hasMember,a.Null);var h=function(){return this};h.prototype.extendedBy=function(a,c){if("undefined"!==typeof c&&"function"===typeof a)"undefined"!==typeof this[c]?b.alsoBehavesLike(this[c],a):this[c]=a,"function"!==typeof this[c].prototype.getType&&(this[c].prototype.getType=function(){return"[object "+c+"]"}),"function"!==typeof this[c].prototype.ofType&&(this[c].prototype.ofType=function(a){return"function"===typeof a.getType?
this.getType()===a.getType():this.getType()==="[object "+a+"]"});else{var h=c||a.title;"undefined"===typeof h&&b.error(Error("Cannot call extendedBy on the core ontology with an object that is missing the 'title' property without specifying a 'typeName'"));if("undefined"!==typeof this[h])b.alsoBehavesLike(this[h],a);else{var f=this.hasMemberType;("undefined"===typeof f||"undefined"===typeof f.getType)&&b.error(Error("The specified concept does not have a valid 'hasMemberType' relationship with another concept"));
var n=b[this._value][f._value];"undefined"===typeof n&&b.error(Error("The specified type does not exist in the core object model: "+f._value));"function"!==typeof a.getType&&b.error(Error("The specified model is missing the getType function: "+h));var f=a.getType(),q=!1,g;for(g in n)if(n.hasOwnProperty(g)&&"undefined"!==typeof this[g].getType&&"[object "+g+"]"===f){this.hasMember[h]=a;this[h]=a;q=!0;break}q||b.error(Error("Did not find an allowed model type for: "+f))}}};var c=function(){this.title=
"Null";return this};c.prototype.getType=function(){return"[object Null]"};c.prototype.ofType=function(a){return null===a||"null"===a||"Null"===a?!0:!1};b.alsoBehavesLike(b,a.getModel(h));b.ontology.extendedBy(new c);b.behavior.extendedBy(new c);a=function(a){this._channel=a;return this};a.prototype.publish=function(a,c){this._channel.publish(a,c);return this};b.type.extendedBy(a,"AsyncResult");b.type.extendedBy(function(a,c,h){"undefined"===typeof c&&b.error(Error("Parameter 'key' is required when instantiating the sm.NamedValue type"));
this.namespace=a;this.key=c;this.value=h;return this},"NamedValue");a=function(){this.title="NamedValueCollection";this._collection={};return this};a.prototype.exists=function(a,c){var h=a;null===b.typeMask(a,{namespace:!0,key:!0})&&(h=a.namespace,c=a.key);return"undefined"!==typeof this._collection[h]&&"undefined"!==typeof this._collection[h][c]};a.prototype.add=function(a,c,h){var f=a.namespace||a,n=a.key||c;"undefined"!==typeof this._collection[f]&&"undefined"!==this._collection[f][n]&&b.error(Error("Cannot add a new entry to the collection (already exists): ["+
f+"]"+n));this.modify(a,c,h);return this};a.prototype.modify=function(a,c,h){var f=a.namespace||a;c=a.key||c;a=a.value||h;"undefined"===typeof c&&b.error(Error("Must supply a valid key"));"undefined"===typeof a&&b.error(Error("Must supply a valid value"));"undefined"===typeof this._collection[f]&&(this._collection[f]={});this._collection[f][c]=a;return this};a.prototype.remove=function(a,c){if(!("undefined"===typeof this._collection[a]||"undefined"===typeof this._collection[a][c]))return delete this._collection[a][c],
this};a.prototype.getValue=function(a,c){var b=a.namespace||a,f=a.key||c;if(!("undefined"===typeof this._collection[b]||"undefined"===this._collection[b][f]))return b=this._collection[b][f],"undefined"!==typeof b&&("function"===typeof a.setValue?a.setValue(b):"undefined"!==typeof a.value&&(a.value=b)),b};a.prototype.ofType=function(a){return"NamedValueCollection"===a||"function"===typeof a.getType&&a.getType()===this.getType()};b.type.extendedBy(a,"NamedValueCollection")})(smallmachine);(function(b){var a=new b.Ontology("sm.channels");a.addTerm("thing");a.addTerm("user");a.addTerm("system");a.addTerm("action");a.addTerm("click");a.addTerm("doubleClick");a.addTerm("keyPress");a.addTerm("task");a.addTerm("initialize");a.addTerm("insert");a.addTerm("remove");a.addTerm("get");a.addTerm("set");a.addTerm("messenger");a.addTerm("success");a.addTerm("error");a.addTerm("performs");a.addTerm("reactsTo");a.user.isA(a.thing);a.user.relatesTo(a.performs,a.action);a.system.isA(a.thing);a.system.relatesTo(a.performs,
a.task);a.action.isA(a.thing);a.task.isA(a.thing);a.messenger.isA(a.thing);a.click.isA(a.action);a.doubleClick.isA(a.action);a.keyPress.isA(a.action);a.get.isA(a.task);a.set.isA(a.task);a.success.isA(a.messenger);a.error.isA(a.messenger);a.initialize.isA(a.task);a.insert.isA(a.task);a.remove.isA(a.task);a.performs.hasRange(a.action).hasRange(a.task);a.reactsTo.hasRange(a.action).hasDomain(a.system);a.registerActivator(function(a){var e=function(e,h){if("undefined"!==typeof jQuery)try{jQuery.ajax({dataType:"json",
url:e,type:"GET",success:function(b,d,e){a.messenger.success.publish(d);h.publish(b)},error:function(a,c,e){b.error(Error(e))}})}catch(m){b.error(Error(m))}else{var g=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP.3.0");g.onprogress=function(){};g.onerror={};g.onreadystatechange=function(){4>g.readyState||(200==g.status?(a.messenger.success.publish(g.statusText),h.publish(JSON.parse(g.responseText))):b.error(Error(g.statusText)))};g.open("GET",e,!0);g.setRequestHeader("X-Requested-With",
"XMLHttpRequest");g.setRequestHeader("Content-type","application/json");g.send(null)}return h},h={update:function(b){return"function"===typeof b.ofType&&b.ofType("NamedValue")?function(b){a.memory.modify(b)}:!1}};b.alsoBehavesLike(a,{memory:new b.type.NamedValueCollection});a.set.subscribe({update:function(a){return h}});var p={update:function(b){return"function"===typeof b.ofType?function(b){a.memory.getValue(b)}:!1}};a.get.subscribe({update:function(a){return p}});"function"===typeof a.initialize.addHelper&&
a.initialize.addHelper("json",e);"function"===typeof a.set.addHelper&&a.set.addHelper("config",function(a){return new b.type.NamedValue("sm.channels","config",a)});"function"===typeof a.get.addHelper&&(a.get.addHelper("json",e),e=function(){this.namespace="sm.channels";this.key="config";return this},e.prototype.setValue=function(a){b.alsoBehavesLike(this,a)},b.type.extendedBy(e,"Config"),a.get.addHelper("config",function(a){return a}))});try{b.ontology.extendedBy(a)}catch(h){b.error(Error("Could not extend the smallmachine.ontology property with the 'sm.channels' ontology: "+
h.message+"\n"+h.stack))}})(smallmachine);(function(b){var a=function(a,c){this._value=a;this._type=c;return this};a.prototype.forward=function(a,c){null!=this._value&&(c[this._value]=!0);for(var b in this)if(this.hasOwnProperty(b)&&!("function"===typeof this[b]||0===b.indexOf("_"))&&!0!==c[b]&&"function"===typeof this[b].publish)c[b]=!0,this[b].publish(a,c);if("undefined"!==typeof this._relatesTo)for(b=0;b<this._relatesTo.length;b++)"undefined"!==typeof this._relatesTo[b]._subscribers&&this.notify(a,this._relatesTo[b]._subscribers)};a.prototype.subscribe=
function(a){"undefined"===typeof this._subscribers&&(this._subscribers=[]);if("function"===typeof a)return this._subscribers.push({update:a}),this;this._subscribers.push(a);return this};a.prototype.notify=function(a,c){for(var b=!1,m=[],p=[],f=0;f<c.length;f++){var n=c[f].update(a);!0===n?b=!0:"function"===typeof n?(p.push(n),b=!0):n&&"function"===typeof n.update&&m.push(n)}if(b){n=!1;for(f=0;f<p.length;f++)!1===!p[f](a)&&(n=!0);!1===n&&(b=!1)}!1==b&&0<m.length&&this.notify(a,m)};a.prototype.publish=
function(a,c){c=c||{};if("function"===typeof a&&(a=a(new b.type.AsyncResult(this)),"undefined"!==typeof a&&"function"===typeof a.getType&&"[object AsyncResult]"===a.getType()))return this;if("undefined"===typeof this._subscribers)return this.forward(a,c),this;this.notify(a,this._subscribers);this.forward(a,c);return this};a.prototype.addHelper=function(b,c){var e=a.prototype.publish,m=this;this[b]=function(){for(var a=[],b=0;b<arguments.length;b++)a.push(arguments[b]);return e.apply(m,[function(b){a.push(b);
return c.apply(m,a)}])};return this};a.prototype.getType=function(){return"[object Channel]"};a.prototype.ofType=function(a){return"Channel"===a||"function"===typeof a.getType&&a.getType()===this.getType()};b.behavior.extendedBy(a,"Channel")})(smallmachine);(function(b,a){var h=function(b){"undefined"!==typeof a.fn&&a.extend({sm:b});return this};h.prototype.initializer=!0;b.behavior.extendedBy(h,"Extension")})(smallmachine,jQuery||{});
