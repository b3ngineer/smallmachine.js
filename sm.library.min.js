var smallmachine=function(d){function b(a,e){for(var c=0;c<e.dependencies.length;c++){for(var g=!1,d=0;d<a.length;d++)if(e.dependencies[c]==a[d].title){g=!0;break}if(!g)return e.dependencies[c]}return null}function p(a,e){this._term=a;this._rules=e._rules;return this}function n(){return this}function f(a){this.title=a;this._inferencer=new l;this._activators=[];this._term=function(a){this._id=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var e=16*Math.random()|
0;return("x"==a?e:e&3|8).toString(16)})}();"undefined"!==typeof a._value&&"undefined"!==typeof a._type?(this._value=a._value,this._type=a._type):(this._value=a,this._type=null);return this};return this}function l(){this._term={_value:null};this._rules=[];return this}"function"!==typeof Object.getPrototypeOf&&(Object.getPrototypeOf="object"===typeof"test".__proto__?function(a){return a.__proto__}:function(a){return a.constructor.prototype});void 0===Function.prototype.name&&void 0!==Object.defineProperty&&
Object.defineProperty(Function.prototype,"name",{get:function(){var a=/function\s([^(]{1,})\(/.exec(this.toString());return a&&1<a.length?a[1].trim():""},set:function(a){}});d=function(a,e){"undefined"===typeof a&&d.error(Error("Missing required parameter for smallmachine constructor: one or more instances of type [object Ontology]"));for(var c=[].concat(a),g="",m=0;m<c.length;m++)"function"!==typeof c[m].ofType||!c[m].ofType("Ontology")?"undefined"!==typeof d.ontology[c[m]]&&(g=g+c[m]+",",c[m]=d.ontology[c[m]]):
g+=c[m].title;g=new f(g.substring(0,g.length-1));for(m=0;m<c.length;m++){for(var l in c[m])c[m].hasOwnProperty(l)&&"function"===typeof c[m][l].ofType&&c[m][l].ofType("Proxy")&&g.addTerm(c[m][l]._term._value);for(var h=0;h<c[m]._inferencer._rules.length;h++)g._inferencer._rules.push(c[m]._inferencer._rules[h]);for(h=0;h<c[m]._activators.length;h++){var k=b(c,c[m]._activators[h]);null!==k&&d.error(Error("Cannot wire-in ontology with missing activator dependency on '"+k+"'"));g.registerActivator(c[m]._activators[h]);
g._activators.sort(function(a,c){if(a.title==c.title)return 0;for(var e=0;e<a.dependencies.length;e++)if(c.title==a.dependencies[e])return 1;for(e=0;e<c.dependencies.length;e++)if(a.title==c.dependencies[e])return-1;return 0})}}return g.getModel(e)};d.alsoBehavesLike=function(a,e){("undefined"===typeof a||"undefined"===typeof e)&&d.error(Error("Cannot mixin with an undefined object"));for(var c in e)if(e.hasOwnProperty(c)&&!(0==c.indexOf("_")||"initializer"===c))if("undefined"!==typeof a[c]){if("undefined"!==
typeof e[c].prototype){if("undefined"!==typeof e[c].prototype.initializer&&!0==e[c].prototype.initializer)continue;var g="undefined"!==typeof e[c].prototype.virtual?e[c].prototype.virtual:!1}var f="undefined"!==typeof a[c].prototype?a[c].prototype.virtual:!1;if(!f||!g)f&&(a[c]=e[c])}else a[c]=e[c];"undefined"!==typeof e.prototype&&("undefined"===typeof a.prototype&&(a.prototype={}),d.alsoBehavesLike(a.prototype,e.prototype))};d.error=function(a,e){if("undefined"!==typeof e&&"function"===typeof e.handleError)e.handleError(a);
else if("function"===typeof d.handleError)d.handleError(a);else throw a;};var h=function(a){var e=16*Math.random()|0;return("x"==a?e:e&3|8).toString(16)};d.getGuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,h)};d.CONCEPT="concept";d.RELATIONSHIP="relationship";p.prototype.getType=function(){return"[object Proxy]"};p.prototype.ofType=function(a){return"Proxy"===a||"function"===typeof a.getType&&a.getType()===this.getType()};n.prototype.relate=function(a){"undefined"===
typeof this._relatesTo&&(this._relatesTo=[]);for(var e=!1,c=0;c<this._relatesTo.length;c++)if(this._relatesTo[c]._id==a._id){e=!0;break}e||this._relatesTo.push(a)};n.prototype.getType=function(){return"[object Term]"};n.prototype.ofType=function(a){return"Term"===a||"function"===typeof a.getType&&a.getType()===this.getType()};d.Behavior=function(a){this.title=a;return this};f.prototype.getType=function(){return"[object Ontology]"};f.prototype.addTerm=function(a){if("undefined"!==typeof this[a])return this;
var e=this._term;e.prototype.relate=n.prototype.relate;e.prototype.getType=n.prototype.getType;e.prototype.ofType=n.prototype.ofType;e=new e(a);this[a]=new p(e,this._inferencer);return this};f.prototype.registerActivator=function(a,e){"undefined"===typeof e&&(e=[]);"function"!==typeof a&&"function"===typeof a.getType&&"[object Activator]"===a.getType()?this._activators.push(a):this._activators.push({fn:a,title:this.title,dependencies:e,getType:function(){return"[object Activator]"}})};f.prototype.getModel=
function(a){var e=new function(a){return this},c=[];if("undefined"!==typeof a){c=c.concat(a);for(a=0;a<c.length;a++)if("undefined"===typeof c[a]&&d.error("One or more [behaviors] arguments were supplied to the smallmachine constructor that are 'undefined'; error creating object model"),"undefined"!==typeof c[a].prototype&&!0===c[a].prototype.initializer)c[a](e)}for(var g in this)if(this.hasOwnProperty(g)&&!("undefined"===typeof this[g]||"undefined"===this[g]._term)&&0!==g.indexOf("_"))if("undefined"!==
typeof this[g]._term){e[g]=this[g]._term;for(a=0;a<c.length;a++)d.alsoBehavesLike(Object.getPrototypeOf(e[g]),c[a].prototype)}else e[g]=this[g];this._inferencer._rules.sort(function(a,c){return a._priority-c._priority});for(a=0;a<this._inferencer._rules.length;a++)c=this._inferencer._rules[a],c._fn.apply(e,c._args);for(a=0;a<this._activators.length;a++)this._activators[a].fn(e);return e};d.Ontology=f;var k=function(a,e,c){this._fn=e;this._args=c;this._priority=a;return this};l.prototype.isA=function(a){this._rules.push(new k(1,
r,[this._term._value,a._term._value]));return this};l.prototype.relatesTo=function(a,e){this._rules.push(new k(10,s,[this._term._value,a._term._value,e._term._value]));return this};l.prototype.hasDomain=function(a){this._rules.push(new k(3,t,[this._term._value,a._term._value]));return this};l.prototype.hasRange=function(a){this._rules.push(new k(2,q,[this._term._value,a._term._value]));return this};d.alsoBehavesLike(p,l);var s=function(a,e,c){a=this[a];var g=this[e],f=this[c];g._type===d.CONCEPT?
d.error(Error("Cannot define a relationship with a concept type: "+g._value)):null===g._type&&(g._type=d.RELATIONSHIP);f._type===d.RELATIONSHIP?d.error(Error("Cannot create a relationship with a relationship type: "+f._value)):null===f._type&&(f._type=d.CONCEPT);a._type===d.RELATIONSHIP?d.error(Error("Cannot create a relationship from a relationship type: "+a._value)):null===a._type&&(a._type=d.CONCEPT);"undefined"===typeof a[e]&&(a[e]=new a.constructor(g));"undefined"===typeof a[e][c]&&(a[e][c]=
f);"undefined"===typeof a[c]&&(a[c]=f);f.relate(a[e]);for(var b in f)f.hasOwnProperty(b)&&(f[b].getType&&"[object Term]"===f[b].getType())&&("undefined"===typeof a[e][b]&&(a[e][b]=f[b]),"undefined"===typeof a[b]&&(a[b]=f[b]),f[b].relate(a[e]))},r=function(a,e){var c=this[a],f=this[e];f._type===d.RELATIONSHIP?d.error(Error("Cannot apply isA to a relationship type: "+f._value)):null===f._type&&(f._type=d.CONCEPT);c._type===d.RELATIONSHIP?d.error(Error("Cannot apply isA to a relationship type: "+c._value)):
null===c._type&&(c._type=d.CONCEPT);"undefined"===typeof f[a]&&(f[a]=c)},q=function(a,f){var c=this[a],g=this[f];g._type===d.RELATIONSHIP?d.error(Error("Cannot apply hasRange to a relationship type: "+g._value)):null===g._type&&(g._type=d.CONCEPT);c._type===d.CONCEPT?d.error(Error("Cannot assign hasRange from a concept type: "+c._value)):null===c._type&&(c._type=d.RELATIONSHIP);"undefined"===typeof c[f]&&(c[f]=g);g.relate(c);for(var b in g)if(g.hasOwnProperty(b)&&g[b].getType&&"[object Term]"===g[b].getType()){var l=
g[b]._value;"undefined"===typeof c[l]&&(c[l]=g[b]);g[b].relate(c)}},t=function(a,f){var c=this[a],b=this[f];b._type===d.RELATIONSIP?d.error(Error("Cannot apply hasRange to a relationship type: "+b._value)):null===b._type&&(b._type=d.CONCEPT);c._type===d.CONCEPT?d.error(Error("Cannot assign hasRange from a concept type: "+c._value)):null===c._type&&(c._type=d.RELATIONSHIP);"undefined"===typeof b[a]&&(b[a]=c)};d.typeMask=function(a,f){var c=[],b;for(b in f)f.hasOwnProperty(b)&&("undefined"===typeof a||
"undefined"===typeof a[b]?c.push(b):"undefined"!==typeof a[b]&&typeof a[b]!==f[b]&&!0!==f[b]&&c.push(b));return 0===c.length?null:c};return d}(smallmachine||{});(function(d){var b=new d.Ontology("sm.properties");b.addTerm("property");b.addTerm("type");b.addTerm("ontology");b.addTerm("behavior");b.addTerm("hasMemberType");b.addTerm("hasMember");b.addTerm("Ontology");b.addTerm("Behavior");b.addTerm("Constructor");b.addTerm("Null");b.ontology.isA(b.property);b.behavior.isA(b.property);b.Ontology.isA(b.type);b.Behavior.isA(b.type);b.Constructor.isA(b.type);b.Null.isA(b.type);b.ontology.relatesTo(b.hasMemberType,b.Ontology);b.behavior.relatesTo(b.hasMemberType,
b.Behavior);b.ontology.relatesTo(b.hasMember,b.Null);b.behavior.relatesTo(b.hasMember,b.Null);var p=function(){return this};p.prototype.extendedBy=function(f,b){if("undefined"!==typeof b&&"function"===typeof f)"undefined"!==typeof this[b]?d.alsoBehavesLike(this[b],f):this[b]=f,"function"!==typeof this[b].prototype.getType&&(this[b].prototype.getType=function(){return"[object "+b+"]"}),"function"!==typeof this[b].prototype.ofType&&(this[b].prototype.ofType=function(f){return"function"===typeof f.getType?
this.getType()===f.getType():this.getType()==="[object "+f+"]"});else{var h=b||f.title;"undefined"===typeof h&&d.error(Error("Cannot call extendedBy on the core ontology with an object that is missing the 'title' property without specifying a 'typeName'"));if("undefined"!==typeof this[h])d.alsoBehavesLike(this[h],f);else{var k=this.hasMemberType;("undefined"===typeof k||"undefined"===typeof k.getType)&&d.error(Error("The specified concept does not have a valid 'hasMemberType' relationship with another concept"));
var n=d[this._value][k._value];"undefined"===typeof n&&d.error(Error("The specified type does not exist in the core object model: "+k._value));"function"!==typeof f.getType&&d.error(Error("The specified model is missing the getType function: "+h));var k=f.getType(),p=!1,q;for(q in n)if(n.hasOwnProperty(q)&&"undefined"!==typeof this[q].getType&&"[object "+q+"]"===k){this.hasMember[h]=f;this[h]=f;p=!0;break}p||d.error(Error("Did not find an allowed model type for: "+k))}}};var n=function(){this.title=
"Null";return this};n.prototype.getType=function(){return"[object Null]"};n.prototype.ofType=function(f){return null===f||"null"===f||"Null"===f?!0:!1};d.alsoBehavesLike(d,b.getModel(p));d.ontology.extendedBy(new n);d.behavior.extendedBy(new n);b=function(f){this._channel=f;return this};b.prototype.publish=function(f,b){this._channel.publish(f,b);return this};d.type.extendedBy(b,"AsyncResult");b=function(f,b,h){"undefined"===typeof b&&d.error(Error("Parameter 'key' is required when instantiating the sm.NamedValue type"));
this.namespace=f;this.key=b;this.value=h;return this};b.prototype.adapt=function(b,l){this.namespace=b;if("undefined"!==typeof l)for(var h=[].concat(l),k=0;k<h.length;k++)d.alsoBehavesLike(this,h[k]);return this};d.type.extendedBy(b,"NamedValue");b=function(){this.title="NamedValueCollection";this._collection={};return this};b.prototype.exists=function(b,l){var h=b;null===d.typeMask(b,{namespace:!0,key:!0})&&(h=b.namespace,l=b.key);return"undefined"!==typeof this._collection[h]&&"undefined"!==typeof this._collection[h][l]};
b.prototype.add=function(b,l,h){var k=b.namespace||b,n=b.key||l;"undefined"!==typeof this._collection[k]&&"undefined"!==this._collection[k][n]&&d.error(Error("Cannot add a new entry to the collection (already exists): ["+k+"]"+n));this.modify(b,l,h);return this};b.prototype.modify=function(b,l,h){var k=b.namespace||b;l=b.key||l;b=b.value||h;"undefined"===typeof l&&d.error(Error("Must supply a valid key"));"undefined"===typeof b&&d.error(Error("Must supply a valid value"));"undefined"===typeof this._collection[k]&&
(this._collection[k]={});this._collection[k][l]=b;return this};b.prototype.remove=function(b,d){if(!("undefined"===typeof this._collection[b]||"undefined"===typeof this._collection[b][d]))return delete this._collection[b][d],this};b.prototype.getValue=function(b,d){var h=b.namespace||b,k=b.key||d;if(!("undefined"===typeof this._collection[h]||"undefined"===this._collection[h][k]))return h=this._collection[h][k],"undefined"!==typeof h&&("function"===typeof b.setValue?b.setValue(h):"undefined"!==typeof b.value&&
(b.value=h)),h};b.prototype.ofType=function(b){return"NamedValueCollection"===b||"function"===typeof b.getType&&b.getType()===this.getType()};d.type.extendedBy(b,"NamedValueCollection")})(smallmachine);
