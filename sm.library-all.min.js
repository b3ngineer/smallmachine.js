var smallmachine=function(f){function e(a,b){for(var d=0;d<b.dependencies.length;d++){for(var c=!1,f=0;f<a.length;f++)if(b.dependencies[d]==a[f].namespace){c=!0;break}if(!c)return b.dependencies[d]}return null}function k(a,b){this._term=a;this._rules=b._rules;return this}function h(){return this}function g(){return this}function n(a){this._id=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"==a?b:b&3|8).toString(16)})}();"undefined"!==
typeof a._value&&"undefined"!==typeof a._type?(this._value=a._value,this._type=a._type):(this._value=a,this._type=null);return this}function c(b){this.namespace=b;this._inferencer=new a;this._activators=[];this._term=n;return this}function a(){this._term={_value:null};this._rules=[];return this}function d(a,b){var d=this[a];"function"===typeof b?f.alsoBehavesLike(d,b.prototype):f.alsoBehavesLike(d,b);for(var c in d)d.hasOwnProperty(c)&&0!==c.indexOf("_")&&"undefined"!==typeof d[c]._type&&d[c]._type===
f.CONCEPT&&("function"===typeof b?f.alsoBehavesLike(d[c],b.prototype):f.alsoBehavesLike(d[c],b))}function b(a,b,d){a=this[a];var c=this[b],l=this[d];c._type===f.CONCEPT?f.error(Error("Cannot define a relationship with a concept type: "+c._value)):null===c._type&&(c._type=f.RELATIONSHIP);l._type===f.RELATIONSHIP?f.error(Error("Cannot create a relationship with a relationship type: "+l._value)):null===l._type&&(l._type=f.CONCEPT);a._type===f.RELATIONSHIP?f.error(Error("Cannot create a relationship from a relationship type: "+
a._value)):null===a._type&&(a._type=f.CONCEPT);"undefined"===typeof a[b]&&(a[b]=new a.constructor(c));"undefined"===typeof a[b][d]&&(a[b][d]=l);"undefined"===typeof a[d]&&(a[d]=l);l.relate(a[b]);for(var m in l)l.hasOwnProperty(m)&&"function"===typeof l[m].relate&&("undefined"===typeof a[b][m]&&(a[b][m]=l[m]),"undefined"===typeof a[m]&&(a[m]=l[m]),l[m].relate(a[b]))}function m(a,b){var d=this[a],c=this[b];c._type===f.RELATIONSHIP?f.error(Error("Cannot apply isA to a relationship type: "+c._value)):
null===c._type&&(c._type=f.CONCEPT);d._type===f.RELATIONSHIP?f.error(Error("Cannot apply isA to a relationship type: "+d._value)):null===d._type&&(d._type=f.CONCEPT);"undefined"===typeof c[a]&&(c[a]=d)}function p(a,b){var d=this[a],c=this[b];c._type===f.RELATIONSHIP?f.error(Error("Cannot apply hasRange to a relationship type: "+c._value)):null===c._type&&(c._type=f.CONCEPT);d._type===f.CONCEPT?f.error(Error("Cannot assign hasRange from a concept type: "+d._value)):null===d._type&&(d._type=f.RELATIONSHIP);
"undefined"===typeof d[b]&&(d[b]=c);c.relate(d);for(var l in c)if(c.hasOwnProperty(l)&&"function"===typeof c[l].relate){var m=c[l]._value||null;null!==m&&("undefined"===typeof d[m]&&(d[m]=c[l]),c[l].relate(d))}}function l(a,b){var d=this[a],c=this[b];c._type===f.RELATIONSIP?f.error(Error("Cannot apply hasRange to a relationship type: "+c._value)):null===c._type&&(c._type=f.CONCEPT);d._type===f.CONCEPT?f.error(Error("Cannot assign hasRange from a concept type: "+d._value)):null===d._type&&(d._type=
f.RELATIONSHIP);"undefined"===typeof c[a]&&(c[a]=d)}"function"!==typeof Object.getPrototypeOf&&(Object.getPrototypeOf="object"===typeof"test".__proto__?function(a){return a.__proto__}:function(a){return a.constructor.prototype});f=function(a,b){"undefined"===typeof a&&f.error(Error("Missing required parameter for smallmachine constructor: one or more instances of type 'Ontology'"));for(var d=[].concat(a),l="",m=0;m<d.length;m++)"undefined"===typeof d[m]&&f.error(Error("Element "+m+" of the ontologies argument passed to the smallmachine constructor is undefined")),
"undefined"===typeof d[m].namespace?"undefined"!==typeof f.ontology[d[m]]&&(l=l+d[m]+",",d[m]=f.ontology[d[m]]):l=l+d[m].namespace+",";l=new c(l.substring(0,l.length-1));for(m=0;m<d.length;m++){for(var h in d[m])d[m].hasOwnProperty(h)&&"undefined"!==typeof d[m][h]._name&&"Proxy"==d[m][h]._name&&l.addTerm(d[m][h]._term._value);for(var p=0;p<d[m]._inferencer._rules.length;p++)l._inferencer._rules.push(d[m]._inferencer._rules[p]);for(p=0;p<d[m]._activators.length;p++){var s=e(d,d[m]._activators[p]);
null!==s&&f.error(Error("Cannot wire-in ontology with missing activator dependency on '"+s+"'"));l.registerActivator(d[m]._activators[p]);l._activators.sort(function(a,b){if(a.namespace==b.namespace)return 0;for(var d=0;d<a.dependencies.length;d++)if(b.namespace==a.dependencies[d])return 1;for(d=0;d<b.dependencies.length;d++)if(a.namespace==b.dependencies[d])return-1;return 0})}}return l.getModel(b)};f.alsoBehavesLike=function(a,b){("undefined"===typeof a||"undefined"===typeof b)&&f.error(Error("Cannot mixin with an undefined object"));
for(var d in b)if(b.hasOwnProperty(d)&&!(0==d.indexOf("_")||"initializer"===d))if("undefined"!==typeof a[d]){if("undefined"!==typeof b[d].prototype){if("undefined"!==typeof b[d].prototype.initializer&&!0==b[d].prototype.initializer)continue;var c="undefined"!==typeof b[d].prototype.virtual?b[d].prototype.virtual:!1}var l="undefined"!==typeof a[d].prototype?a[d].prototype.virtual:!1;if(!l||!c)l&&(a[d]=b[d])}else a[d]=b[d];"undefined"!==typeof b.prototype&&"undefined"!==typeof a.prototype&&f.alsoBehavesLike(a.prototype,
b.prototype)};f.error=function(a,b){if("undefined"!==typeof b&&"function"===typeof b.handleError)b.handleError(a);else if("function"===typeof f.handleError)f.handleError(a);else throw a;};var s=function(a){var b=16*Math.random()|0;return("x"==a?b:b&3|8).toString(16)};f.getGuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,s)};f.CONCEPT="concept";f.RELATIONSHIP="relationship";k.prototype._name="Proxy";h.prototype.relate=function(a){"undefined"===typeof this._relatesTo&&(this._relatesTo=
[]);for(var b=!1,d=0;d<this._relatesTo.length;d++)if(this._relatesTo[d]._id==a._id){b=!0;break}b||this._relatesTo.push(a)};g.prototype._name="Behavior";f.Behavior=g;c.prototype._name="Ontology";c.prototype.addTerm=function(a){if("undefined"!==typeof this[a])return this;this._term.prototype.relate=h.prototype.relate;var b=new this._term(a);this[a]=new k(b,this._inferencer);return this};c.prototype.registerActivator=function(a,b){"undefined"===typeof b&&(b=[]);null===f.typeMask(a,{fn:"function",namespace:!0,
dependencies:!0})?this._activators.push(a):this._activators.push({fn:a,namespace:this.namespace,dependencies:b})};c.prototype.getModel=function(a){var b=new function(){return this},d=[];if("undefined"!==typeof a){d=d.concat(a);for(a=0;a<d.length;a++)if("undefined"===typeof d[a]&&f.error("One or more [behaviors] arguments were supplied to the smallmachine constructor that are 'undefined'; error creating object model"),"undefined"!==typeof d[a].prototype&&!0===d[a].prototype.initializer)d[a](b)}for(var c in this)if(this.hasOwnProperty(c)&&
!("undefined"===typeof this[c]||"undefined"===this[c]._term)&&0!==c.indexOf("_"))if("undefined"!==typeof this[c]._term){b[c]=this[c]._term;for(a=0;a<d.length;a++)f.alsoBehavesLike(Object.getPrototypeOf(b[c]),d[a].prototype)}else b[c]=this[c];this._inferencer._rules.sort(function(a,b){return a._priority-b._priority});for(a=0;a<this._inferencer._rules.length;a++)d=this._inferencer._rules[a],d._fn.apply(b,d._args);for(a=0;a<this._activators.length;a++)this._activators[a].fn(b);return b};f.Ontology=c;
var q=function(a,b,d){this._fn=b;this._args=d;this._priority=a;return this};a.prototype.isA=function(a){this._rules.push(new q(1,m,[this._term._value,a._term._value]));return this};a.prototype.relatesTo=function(a,d){this._rules.push(new q(10,b,[this._term._value,a._term._value,d._term._value]));return this};a.prototype.hasDomain=function(a){this._rules.push(new q(3,l,[this._term._value,a._term._value]));return this};a.prototype.hasRange=function(a){this._rules.push(new q(2,p,[this._term._value,a._term._value]));
return this};a.prototype.alsoBehavesLike=function(a){this._rules.push(new q(20,d,[this._term._value,a]));return this};f.alsoBehavesLike(k,a);f.typeMask=function(a,b){var d=[],c;for(c in b)b.hasOwnProperty(c)&&("undefined"===typeof a||"undefined"===typeof a[c]?d.push(c):"undefined"!==typeof a[c]&&typeof a[c]!==b[c]&&!0!==b[c]&&d.push(c));return 0===d.length?null:d};return f}(smallmachine||{});(function(f){function e(){return this}function k(){return this}function h(a){this._channel=a;return this}function g(a,d,b){"undefined"===typeof d&&f.error(Error("Parameter 'key' is required when instantiating the sm.NamedValue type"));this.namespace=a;this.key=d;this.value=b;return this}function n(){this._collection={};return this}var c=new f.Ontology("sm.properties");c.addTerm("property");c.addTerm("type");c.addTerm("ontology");c.addTerm("behavior");c.addTerm("hasMemberType");c.addTerm("hasMember");
c.addTerm("Ontology");c.addTerm("Behavior");c.addTerm("Constructor");c.addTerm("Null");c.ontology.isA(c.property);c.behavior.isA(c.property);c.Ontology.isA(c.type);c.Behavior.isA(c.type);c.Constructor.isA(c.type);c.Null.isA(c.type);c.ontology.relatesTo(c.hasMemberType,c.Ontology);c.behavior.relatesTo(c.hasMemberType,c.Behavior);c.ontology.relatesTo(c.hasMember,c.Null);c.behavior.relatesTo(c.hasMember,c.Null);e.prototype.extendedBy=function(a,d){var b=this.hasMemberType;"undefined"===typeof d&&("undefined"===
b?d=a._name:"undefined"!==typeof a.prototype&&(d=a.prototype._name));if("undefined"!==typeof d&&"function"===typeof a)"undefined"!==typeof this[d]?f.alsoBehavesLike(this[d],a):this[d]=a,"undefined"===typeof this[d]._name&&(this[d]._name=d);else{var c=d||a.namespace||a._name;"undefined"===typeof c&&f.error(Error("Cannot call extendedBy on the core ontology with an object that is missing the 'namepsace' and '_name' properties without specifying a 'typeName'"));if("undefined"!==typeof this[c])f.alsoBehavesLike(this[c],
a);else{var e=f[this._value][b._value];"undefined"===typeof e&&f.error(Error("The specified type does not exist in the core object model: "+b._value));var b=a._name||a.constructor.name,l=!1,h;for(h in e)if(e.hasOwnProperty(h)&&0!==h.indexOf("_")&&h===b){this.hasMember[c]=a;this[c]=a;l=!0;break}l||f.error(Error("Did not find an allowed model type for: "+b))}}};k.prototype._name="Null";f.alsoBehavesLike(f,c.getModel(e));f.ontology.extendedBy(new k);f.behavior.extendedBy(new k);h.prototype._name="AsyncResult";
h.prototype.publish=function(a,d){this._channel.publish(a,d);return this};f.type.extendedBy(h);g.prototype.adapt=function(a,d){this.namespace=a;if("undefined"!==typeof d)for(var b=[].concat(d),c=0;c<b.length;c++)f.alsoBehavesLike(this,b[c]);return this};g.prototype._name="NamedValue";f.type.extendedBy(g);n.prototype._name="NamedValueCollection";n.prototype.exists=function(a,d){var b=a;null===f.typeMask(a,{namespace:!0,key:!0})&&(b=a.namespace,d=a.key);return"undefined"!==typeof this._collection[b]&&
"undefined"!==typeof this._collection[b][d]};n.prototype.add=function(a,d,b){var c=a.namespace||a,e=a.key||d;"undefined"!==typeof this._collection[c]&&"undefined"!==this._collection[c][e]&&f.error(Error("Cannot add a new entry to the collection (already exists): ["+c+"]"+e));this.modify(a,d,b);return this};n.prototype.modify=function(a,d,b){var c=a.namespace||a;d=a.key||d;a=a.value||b;"undefined"===typeof d&&f.error(Error("Must supply a valid key"));"undefined"===typeof a&&f.error(Error("Must supply a valid value"));
"undefined"===typeof this._collection[c]&&(this._collection[c]={});this._collection[c][d]=a;return this};n.prototype.remove=function(a,d){if(!("undefined"===typeof this._collection[a]||"undefined"===typeof this._collection[a][d]))return delete this._collection[a][d],this};n.prototype.getValue=function(a,d){var b=a.namespace||a,c=a.key||d;if(!("undefined"===typeof this._collection[b]||"undefined"===this._collection[b][c]))return b=this._collection[b][c],"undefined"!==typeof b&&("function"===typeof a.setValue?
a.setValue(b):"undefined"!==typeof a.value&&(a.value=b)),b};f.type.extendedBy(n)})(smallmachine);(function(f){var e=new f.Ontology("sm.channels");e.addTerm("thing");e.addTerm("user");e.addTerm("system");e.addTerm("action");e.addTerm("click");e.addTerm("doubleClick");e.addTerm("keyPress");e.addTerm("task");e.addTerm("initialize");e.addTerm("insert");e.addTerm("remove");e.addTerm("get");e.addTerm("set");e.addTerm("messenger");e.addTerm("success");e.addTerm("error");e.addTerm("performs");e.addTerm("reactsTo");e.user.isA(e.thing);e.user.relatesTo(e.performs,e.action);e.system.isA(e.thing);e.system.relatesTo(e.performs,
e.task);e.action.isA(e.thing);e.task.isA(e.thing);e.messenger.isA(e.thing);e.click.isA(e.action);e.doubleClick.isA(e.action);e.keyPress.isA(e.action);e.get.isA(e.task);e.set.isA(e.task);e.success.isA(e.messenger);e.error.isA(e.messenger);e.initialize.isA(e.task);e.insert.isA(e.task);e.remove.isA(e.task);e.performs.hasRange(e.action).hasRange(e.task);e.reactsTo.hasRange(e.action).hasDomain(e.system);e.registerActivator(function(e){function g(a,b){if("undefined"!==typeof jQuery)try{jQuery.ajax({dataType:"json",
url:a,type:"GET",success:function(c,m,p){e.messenger.success.publish(m);b.publish(new f.type.NamedValue("sm.channels",a,c))},error:function(a,b,d){f.error(Error(d))}})}catch(c){f.error(Error(c))}else{var p=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP.3.0");p.onprogress=function(){};p.onerror={};p.onreadystatechange=function(){4>p.readyState||(200==p.status?(e.messenger.success.publish(p.statusText),b.publish(new f.type.NamedValue("sm.channels",a,JSON.parse(p.responseText)))):
f.error(Error(p.statusText)))};p.open("GET",a,!0);p.setRequestHeader("X-Requested-With","XMLHttpRequest");p.setRequestHeader("Content-type","application/json");p.send(null)}return b}var k={update:function(a){return"undefined"!==typeof a.key&&"undefined"!==typeof a.namespace?function(a){e.memory.modify(a)}:!1}};f.alsoBehavesLike(e,{memory:new f.type.NamedValueCollection});e.set.subscribe({update:function(a){return k}});var c={update:function(a){return"undefined"!==typeof a.key&&"undefined"!==typeof a.namespace?
function(a){e.memory.getValue(a)}:!1}};e.get.subscribe({update:function(a){return c}});"function"===typeof e.initialize.addHelper&&e.initialize.addHelper("json",g);"function"===typeof e.set.addHelper&&e.set.addHelper("config",function(a){return new f.type.NamedValue("sm.channels","config",a)});if("function"===typeof e.get.addHelper){e.get.addHelper("json",g);var a=function(){this.namespace="sm.channels";this.key="config";return this};a.prototype._name="Config";a.prototype.setValue=function(a){f.alsoBehavesLike(this,
a)};f.type.extendedBy(a);e.get.addHelper("config",function(a){return a})}});try{f.ontology.extendedBy(e)}catch(k){f.error(Error("Could not extend the smallmachine.ontology property with the 'sm.channels' ontology: "+k.message+"\n"+k.stack))}})(smallmachine);(function(f){function e(f,e){this._value=f;this._type=e;return this}e.prototype._name="Channel";e.prototype.forward=function(f,e){null!=this._value&&(e[this._value]=!0);for(var g in this)if(this.hasOwnProperty(g)&&!("function"===typeof this[g]||0===g.indexOf("_"))&&!0!==e[g]&&"function"===typeof this[g].publish)e[g]=!0,this[g].publish(f,e);if("undefined"!==typeof this._relatesTo)for(g=0;g<this._relatesTo.length;g++)"undefined"!==typeof this._relatesTo[g]._subscribers&&this.notify(f,this._relatesTo[g]._subscribers)};
e.prototype.unsubscribe=function(f){"undefined"!==typeof this._subscribers&&delete this._subscribers[f]};e.prototype.subscribe=function(e){"undefined"===typeof this._subscribers&&(this._subscribers={});var h=f.getGuid();"function"===typeof e?this._subscribers[h]={update:e,lifetime:1}:("undefined"===typeof e.lifecycle&&(e.lifetime=1),this._subscribers[h]=e);return h};e.prototype.notify=function(e,h){var g=!1,n={},c=0,a=[],d;for(d in h){var b=h[d].update(e);"undefined"!==typeof h[d]&&(0>=h[d].lifetime&&
this.unsubscribe(d),!0===b?g=!0:"function"===typeof b?(a.push(b),g=!0):b&&"function"===typeof b.update&&(n[f.getGuid()]=b,c++))}if(g){d=0===a.length;for(b=0;b<a.length;b++)!1===!a[b](e)&&(d=!0);!1===d&&(g=!1)}!1==g&&0<c&&this.notify(e,n)};e.prototype.publish=function(e,h){h=h||{};if("function"===typeof e&&(e=e(new f.type.AsyncResult(this)),"undefined"!==typeof e&&"undefined"!==typeof e._channel&&"function"===typeof e.publish))return this;if("undefined"===typeof this._subscribers)return this.forward(e,
h),this;this.notify(e,this._subscribers);this.forward(e,h);return this};e.prototype.addHelper=function(f,h){var g=e.prototype.publish,n=this;this[f]=function(){for(var c=[],a=0;a<arguments.length;a++)c.push(arguments[a]);return g.apply(n,[function(a){c.push(a);return h.apply(n,c)}])};return this};f.behavior.extendedBy(e)})(smallmachine);(function(f,e){function k(f){"undefined"!==typeof e.fn&&e.extend({sm:f});return this}k.prototype._name="Extension";k.prototype.initializer=!0;f.behavior.extendedBy(k)})(smallmachine,jQuery||{});(function(f){function e(){this.length=0;this._min=this._max=-1;return this}function k(){return this}e.prototype.add=function(e,g){"undefined"===typeof this[e]?(0<this._max&&this._max<this.length+1&&f.error(Error("The maximum number of items already exists in this collection (max "+this._max+")")),this[e]=g,this.length++):f.error(Error("Cannot add an item to a collection when it's key has already present: "+e))};e.prototype.exists=function(e){return"undefined"!==typeof this[e]};e.prototype.remove=
function(e){"undefined"!==typeof this[e]?(delete this[e],this.length--):f.error(Error("An item with the specified key has not been added: "+e))};k.prototype._name="Restrictions";k.prototype.max=function(f){"undefined"===typeof this._collection&&(this._collection=new e);this._collection._max=f};k.prototype.add=function(f,g){"undefined"===typeof this._collection&&(this._collection=new e);this._collection.add(f,g)};k.prototype.min=function(f){"undefined"===typeof this._collection&&(this._collection=
new e);this._collection._min=f};f.behavior.extendedBy(k)})(smallmachine);(function(f){function e(a,b){b.y=parseFloat(a.y);b.x=parseFloat(a.x);b.width=parseFloat(a.width);b.height=parseFloat(a.height);return this}function k(a){new e(a,this);return this}function h(a){new e(a,this);return this}function g(a){new e(a,this);return this}function n(a){new e(a,this);return this}function c(a,b,d,c){this.shape=new m[a.shape||"ellipse"](a);this.id=a.id||f.getGuid();this.edges=a.edges||[];this.label=a.label||this.id;this.paper=b;this.shapeAttr=d;this.shapeLabelAttr=c;this.data=a.data||
{};this.title=a.title||a.label;return this}function a(a,b,d,c,e,f){this.id1=a.id;this.id2=b.id;this.r1=a.shape.width/2;this.r2=b.shape.width/2;this.x1=a.shape.x;this.y1=a.shape.y;this.x2=b.shape.x;this.y2=b.shape.y;this.label=a.edges[d].label||"";this.paper=c;this.lineAttr=e;this.edgeLabelAttr=f;this.data={};return this}function d(a){this._model=a;this.handleError=function(b){a.messenger.error.publish(b)};return this}var b=new f.Ontology("sm.nodes");b.addTerm("task");b.addTerm("insert");b.addTerm("connect");
b.addTerm("set");b.addTerm("get");b.addTerm("paint");b.addTerm("paintNodes");b.paint.isA(b.task);b.insert.isA(b.task);b.connect.isA(b.task);b.set.isA(b.task);b.get.isA(b.task);b.paintNodes.isA(b.paint);k.prototype.draw=function(a){return a.ellipse(this.x,this.y,this.width/2,this.height/2)};h.prototype.draw=function(a){return a.rect(this.x-this.width/2,this.y-this.height/2,this.width,this.height)};g.prototype.draw=function(a){var b=this.x-this.width/2,d=this.y;return a.path(["M",b,d,"L",this.x,this.y-
this.height/2,"L",this.x+this.width/2,this.y,"L",this.x,this.y+this.height/2,"L",b,d])};n.prototype.draw=function(a){var b=this.x-this.width/2,d=this.y+this.height/2;return a.path(["M",b,d,"L",this.x,this.y-this.height/2,"L",this.x+this.width/2,this.y+this.height/2,"L",b,d])};var m={ellipse:k,rectangle:h,diamond:g,triangle:n};c.prototype.update=function(a){a=this.shape.draw(this.paper);a.id=this.id;"function"===typeof this.shapeAttr?this.shapeAttr(a,this):a.attr(this.shapeAttr);var b=this.paper.text(this.shape.x,
this.shape.y,this.label);""!=this.title&&(a.attr("title",this.title),b.attr("title",this.title));"function"===typeof this.shapeLabelAttr?this.shapeLabelAttr(b,this):b.attr(this.shapeLabelAttr);return!0};a.prototype.update=function(a){a=this.paper.path(["M",this.x1,this.y1,"L",this.x2,this.y2]);"function"===typeof this.lineAttr?this.lineAttr(a,this):a.attr(this.lineAttr);a=this.paper.text((this.x1+this.x2)/2,(this.y1+this.y2)/2,this.label);"function"===typeof this.edgeLabelAttr?this.edgeLabelAttr(a,
this):a.attr(this.edgeLabelAttr);var b=180*Math.atan2(this.y2-this.y1,this.x2-this.x1)/Math.PI;90<b?a.transform("t-6,-6r"+(b+180)):a.transform("t6,-6r"+b);return!0};d.prototype.update=function(b){var d=new f.type.Config;this._model.system.get.config(d);b=b.value;if("undefined"===typeof b)return!1;null!==f.typeMask(b,{length:!0,sort:"function"})&&f.error(Error("Cannot determine the JSON type; expecting an array (or comparable object) of node objects but received "+b),this);var e=new f.type.NamedValue("sm.raphaeljs",
"paper",null);this._model.get.publish(e);e.value.clear();for(var m=0;m<b.length;m++){for(var p=new c(b[m],e.value,d.shapeAttr||{},d.shapeLabelAttr||{}),g=0;g<p.edges.length;g++){var h;a:{h=b;for(var k=p.edges[g].id,n=0;n<h.length;n++)if(h[n].id===k){h=new c(h[n]);break a}h=null}null!==h&&("undefined"!=typeof h.shape.x&&"undefined"!==typeof h.shape.y)&&(h=new a(p,h,g,e.value,d.lineAttr||{},d.edgeLabelAttr||{}),this._model.connect.publish(h))}this._model.insert.publish(p)}};b.registerActivator(function(a){var b=
new d(a);a.paintNodes.subscribe(function(a){return b});a.connect.subscribe(function(a){return a});a.insert.subscribe(function(a){return a})},["sm.channels","sm.raphaeljs"]);try{f.ontology.extendedBy(b)}catch(p){f.error(Error("Could not extend the smallmachine.ontology property with the 'sm.nodes' ontology: "+p.message+"\n"+p.stack))}})(smallmachine);(function(f,e,k){function h(){this.leftSiblingNode=null;return this}function g(a,d){this.nodeIndex={};this.defaultWidth=60;this.defaultNodeMargin=40;this.defaultTreeMargin=80;this.root=a[0];this.size={height:0,width:0,left:0,right:0};for(var b=0;b<a.length;b++){a[b].id===d&&(this.root=a[b]);a[b].prelim=0;a[b].mod=0;a[b].thread=null;a[b].ancestor=a[b];a[b].shift=0;a[b].change=0;a[b].num=a[b].num||0;a[b].vert=100;a[b].width="undefined"===typeof a[b].width?this.defaultWidth:parseFloat(a[b].width);"undefined"!==
typeof a[b].height&&(a[b].height=parseFloat(a[b].height),100<a[b].height&&(a[b].vert=a[b].height));"undefined"===typeof a[b].children&&(a[b].children=[]);if("undefined"!==typeof a[b].edges)for(var c=0;c<a[b].edges.length;c++){var e=this._getNodeFromIndex(a[b].edges[c].id,a);if("undefined"===typeof e.parentNodeId||null==e.parentNodeId)e.parentNodeId=a[b].id,e.num=c,a[b].children.push(e)}for(c=0;c<a[b].children.length;c++)a[b].children[c].leftMostSiblingNode=a[b].children[0],1>c||(a[b].children[c].leftSiblingNode=
a[b].children[c-1]);"undefined"===typeof a[b].isLeaf&&(a[b].__proto__=h.prototype,f.alsoBehavesLike(a[b],h.prototype))}"undefined"!==typeof this.root.parentNodeId&&f.error(Error("Aborting; An infinite loop may occur because the root node has a value for parentNodeId (which is set to "+this.root.parentNodeId+")"))}e=new f.Ontology("sm.treelayout");e.addTerm("paint");e.addTerm("get");h.prototype.leftMostChild=function(){return this.children[0]||null};h.prototype.rightMostChild=function(){return 1>this.children.length?
this.children[0]||null:this.children[this.children.length-1]};h.prototype.leftSibling=function(){return this.leftSiblingNode||null};h.prototype.leftMostSibling=function(){return this.leftMostSiblingNode||null};h.prototype.isLeaf=function(){return 0===this.children.length};g.prototype.walk=function(a){this.firstWalk(this.root);this.secondWalk(this.root,-this.root.prelim,0,0,a);this.size.width=-1*(this.size.left-this.size.right)};g.prototype._name="TreeLayout";g.prototype._getNodeFromIndex=function(a,
d){if("undefined"!==typeof this.nodeIndex[a])return this.nodeIndex[a];for(var b=d.length-1;0<=b;b--)if("undefined"===typeof this.nodeIndex[d[b].id]&&(this.nodeIndex[d[b].id]=d[b]),d[b].id===a)return d[b]};g.prototype.getSpacing=function(a,d,b){return(b?this.defaultNodeMargin:this.defaultTreeMargin)+0.5*(a.width+d.width)};g.prototype.firstWalk=function(a){if(a.isLeaf()){var d=a.leftSibling();null===d?a.prelim=0:(a.prelim=d.prelim+this.getSpacing(d,a,!0),d.vert>a.vert&&(a.vert=d.vert))}else{for(var d=
a.leftMostChild(),b=0;b<a.children.length;b++)this.firstWalk(a.children[b]),d=this.apportion(a.children[b],d);b=0.5*(a.leftMostChild().prelim+a.rightMostChild().prelim);d=a.leftSibling();null!==d?(a.prelim=d.prelim+this.getSpacing(d,a,!0),a.mod=a.prelim-b,d.vert>a.vert&&(a.vert=d.vert)):a.prelim=b}};g.prototype.apportion=function(a,d){var b=a.leftSibling();if(null!==b){for(var c=a,e=a,f=b,b=a.leftMostSibling(),g=c.mod,h=e.mod,k=f.mod,n=b.mod,f=this.nextRight(f),c=this.nextLeft(c);null!==f&&null!==
c;){b=this.nextLeft(b);e=this.nextRight(e);e.ancestor=a;var r=f.prelim+k-(c.prelim+g)+this.getSpacing(f,c,!1);0<r&&(this.moveSubtree(this.ancestor(f,a,d),a,r),g+=r,h+=r);k+=f.mod;g+=c.mod;n+=b.mod;h+=e.mod;f=this.nextRight(f);c=this.nextLeft(c)}null!==f&&null===this.nextRight(e)&&(e.thread=f,e.mod+=k-h);null!==c&&null===this.nextLeft(b)&&(b.thread=c,b.mod+=g-n,d=a)}return d};var n=0;g.prototype.moveSubtree=function(a,d,b){if(!(6<++n)){var c=d.num-a.num;d.change=(d.change-b)/c;d.shift+=b;a.change=
(a.change+b)/c;d.prelim+=b;d.mod+=b}};g.prototype.executeShifts=function(a){for(var d=0,b=0,c=a.children.length-1;0<=c;c--){var e=a.children[c];e.prelim+=d;e.mod+=d;b+=e.change;d+=e.shift+b}};g.prototype.secondWalk=function(a,d,b,c,e){"undefined"===typeof e&&(e=0);a.x=a.prelim+d+e;var f=a.x-a.width-this.defaultNodeMargin,g=a.x+a.width+this.defaultNodeMargin;f<this.size.left?this.size.left=f:g>this.size.right&&(this.size.right=g);c+=0.5*a.vert;a.y=b++*this.defaultNodeMargin+c;a.y+a.height>this.size.height&&
(this.size.height=a.y+a.height);c+=0.5*a.vert;f=0;for(g=a.children.length;f<g;f++)this.secondWalk(a.children[f],d+a.mod,b,c,e)};g.prototype.shift=function(a,d,b){"undefined"===typeof b&&(b=this.root);b.x+=a;b.y+=d;for(var c=0,e=b.children.length;c<e;c++)this.shift(a,d,b.children[c])};g.prototype.nextRight=function(a){var d=a.rightMostChild();return null!==d?d:a.thread};g.prototype.nextLeft=function(a){var d=a.leftMostChild();return null!==d?d:a.thread};g.prototype.ancestor=function(a,d,b){return a.parentNodeId===
d.parentNodeId?a.ancestor:b};g.prototype.areSiblings=function(a,d){return a.parentNodeId===d.parentNodeId};f.type.extendedBy(g);e.registerActivator(function(a){a.paint.subscribe(function(d){if(null===f.typeMask(d.value,{length:!0,sort:"function"}))return function(b){var c=new f.type.NamedValue("sm.treelayout","root",null);a.get.publish(c);b=new f.type.NamedValue("sm.raphaeljs","paper",null);a.get.publish(b);c=new f.type.TreeLayout(d.value,c.value,{});null!==b.value?(c.walk(b.value.width/2),b.value.setSize(c.size.width,
c.size.height),0>c.size.left&&c.shift(-1*c.size.left,0)):c.walk();return!1}})},["sm.channels","sm.nodes","sm.raphaeljs"]);try{f.ontology.extendedBy(e)}catch(c){f.error(Error("Could not extend the smallmachine.ontology property with the 'sm.nodes' ontology: "+c.message+"\n"+c.stack))}})(smallmachine,jQuery,Raphael);(function(f,e){var k=new f.Ontology("sm.raphaeljs");k.addTerm("set");k.registerActivator(function(g){var h=/^(\d+)%?$/,c=function(a,d,b,c){c=document.getElementById(a+"");if("undefined"===typeof c||!c)throw Error("The specified element ID could not be found: "+a);var g=window,l=document,k=l.documentElement,q=l.getElementsByTagName("body")[0],l=g.innerWidth||k.clientWidth||q.clientWidth,g=g.innerHeight||k.clientHeight||q.clientHeight,k=d;null===d&&(k=c.offsetWidth||l);q=h.exec(k+"");if(!q)throw Error("The specified value for width is invalid (number, percentage or null allowed): "+
d);"function"===typeof k.indexOf&&0<k.indexOf("%")&&(k=100*(c.offsetWidth||l)/parseFloat(q[0]));d=b;null==b&&(d=c.offsetHeight||g);l=h.exec(d+"");if(!l)throw Error("The specified value for height is invalid (number, percentage or null allowed): "+b);"function"===typeof d.indexOf&&0<d.indexOf("%")&&(d=(c.offsetHeight||g)*parseFloat(l[0])/100);a=e(a,k,d);return new f.type.NamedValue("sm.raphaeljs","paper",a)};"function"===typeof g.set.addHelper&&g.set.addHelper("svg",c)},["sm.channels"]);try{f.ontology.extendedBy(k)}catch(h){throw Error("Could not extend the smallmachine.ontology property with the 'sm.raphaeljs' ontology: "+
h.message+"\n"+h.stack);}})(smallmachine,Raphael);(function(f,e){var k=new f.Ontology("sm.sammyjs");k.addTerm("initialize");var h=function(c,a,d){this._id=c;this._callback=a;this._runArg=d||"#/";return this};h.prototype._name="Sammy";f.type.extendedBy(h);var g={update:function(c){return null===f.typeMask(c,{_id:!0,_callback:!0,_runArg:!0})?function(a){e("#"+a._id,a._callback).run(a._runArg)}:!1}};k.registerActivator(function(c){c.initialize.subscribe({update:function(a){return g}})},["sm.channels"]);try{f.ontology.extendedBy(k)}catch(n){throw Error("Could not extend the smallmachine.ontology property with the 'sm.sammyjs' ontology: "+
n.message+"\n"+n.stack);}})(smallmachine,Sammy);(function(f,e){function k(e){function f(){this._terms=[];this._terms[0]=[];this._rules=[];this._conflictStrategy=null}var k={equal:0,greaterThanOrEqual:1,greaterThan:2,lessThanOrEqual:-1,lessThan:-2};f.prototype._name="SearchModel";f.prototype._numberExists=function(c){for(var a=this._terms[0].length,d=0,b=a-1,a=Math.floor(a/2);b>=d;){var e=this._terms[0][a];if(c===e)return!0;c<e?b=a-1:d=a+1;a=Math.floor((d+b)/2)}return!1};f.prototype.addTerm=function(c){if("number"===typeof c)this._numberExists(c)||
(this._terms[0].push(c),this._terms[0].sort());else{var a=c.toString();c=a.length;if("undefined"===typeof this._terms[c])this._terms[c]=a;else if(!(-1<this._terms[c].indexOf(a))){for(var d=this._terms[c].length/c,a=[a],b=0;b<d;b++)a.push(this._terms[c].substring(b*c,b*c+c));a.sort();this._terms[c]=a.join("")}}};f.prototype.addRules=function(c){for(var a=0,d=c.length;a<d;a++)for(var b=0,e=c[a].terms.length;b<e;b++){var f=c[a].terms[b];this.addTerm(f)}a=0;for(d=c.length;a<d;a++){for(var g=[],e=c[a].terms.length,
h=0,b=0;b<e;b++){var f=c[a].terms[b],q=this.getTermId(f),f=q[0],t=q[1];f>h&&(h=f);"undefined"===typeof g[f]&&(g[f]=[]);g[f][t]=q;"undefined"!==typeof c[a].operators&&"undefined"!=typeof c[a].operators[b]?(q=k[c[a].operators[b].toString()],g[f][t][2]="undefined"!==typeof q?q:c[a].operators[b]):g[f][t][2]=0}g[h+1]=e;g[h+2]=c[a].action;this._rules.push(g)}};f.prototype.getNumberId=function(c){for(var a=this._terms[0].length,d=0,b=a-1,a=Math.floor(a/2);b>=d;){var e=this._terms[0][a];if(c===e)return[0,
a];c<e?b=a-1:d=a+1;a=Math.floor((d+b)/2)}return!1};f.prototype.getTermId=function(c){if("number"===typeof c)return this.getNumberId(c);c=c.toString();var a=c.length;if(!this._terms[a])return!1;for(var d=this._terms[a].length/a,b=0,e=d-1,d=Math.floor(d/2);e>=b;){var f=a*d,g=this._terms[a].substr(f,a);if(c===g)return[a,f/a];c<g?e=d-1:b=d+1;d=Math.floor((b+e)/2)}return!1};f.prototype.isEqualTermId=function(c,a){if(!c||!a||c.length!==a.length)return!1;for(var d=0;d<c.length;d++)if(c[d]!==a[d])return!1;
return!0};f.prototype.executeQuery=function(c){for(var a=[],d=[],b=0,e=c.length;b<e;b++)for(var f=this.getTermId(c[b]),g=0,h=this._rules.length;g<h;g++){if("undefined"===typeof a[g])a[g]=0;else if(!1===a[g])continue;var k=f[1],n=this._rules[g][f[0]];"undefined"===typeof n||"undefined"===typeof n[k]||!(n[k]instanceof Array)?a[g]=!1:a[g]++}b=0;for(c=a.length;b<c;b++)e=this._rules[b].length,a[b]===this._rules[b][e-2]&&d.push(this._rules[b][e-1]);"function"===typeof this._conflictStrategy&&this._conflictStrategy(d);
return d};this.searchModel=new f;e={addDataModel:function(c){"undefined"!==typeof c._terms&&0<c._terms.length&&"undefined"!==typeof c._rules&&0<c._rules.length?(this.searchModel._terms=c._terms,this.searchModel._rules=c._rules):this.searchModel.addRules(c.rules);this.searchModel._conflictStrategy=c.conflictStrategy},isEqualTermId:function(c,a){return this.searchModel.isEqualTermId(c,a)},getNumberId:function(c){return this.searchModel.getNumberId(c)},getTermId:function(c){return this.searchModel.getTermId(c)},
executeQuery:function(c){return this.searchModel.executeQuery(c)}};"function"===typeof this.helpers?this.helpers(e):(this.addDataModel=e.addDataModel,this.getTermId=e.getTermId,this.getNumberId=e.getNumberId,this.isEqualTermId=e.isEqualTermId,this.executeQuery=e.executeQuery)}k.prototype._name="StateQueryModel";f.type.extendedBy(k)})(smallmachine,Sammy);
