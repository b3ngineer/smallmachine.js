var smallmachine=function(e){"function"!==typeof Object.getPrototypeOf&&(Object.getPrototypeOf="object"===typeof"test".__proto__?function(f){return f.__proto__}:function(f){return f.constructor.prototype});var a=function(f,a){for(var d=0;d<a.dependencies.length;d++){for(var e=!1,b=0;b<f.length;b++)if(a.dependencies[d]==f[b].title){e=!0;break}if(!e)return a.dependencies[d]}return null};e=function(f,d){"undefined"===typeof f&&e.error(Error("Missing required parameter for smallmachine constructor: one or more instances of type [object Ontology]"));
for(var m=[].concat(f),h="",b=0;b<m.length;b++)"function"!==typeof m[b].ofType||!m[b].ofType("Ontology")?"undefined"!==typeof e.ontology[m[b]]&&(h=h+m[b]+",",m[b]=e.ontology[m[b]]):h+=m[b].title;h=new e.Ontology(h.substring(0,h.length-1));for(b=0;b<m.length;b++){for(var c in m[b])m[b].hasOwnProperty(c)&&"function"===typeof m[b][c].ofType&&m[b][c].ofType("Proxy")&&h.addTerm(m[b][c]._term._value);for(var g=0;g<m[b]._inferencer._rules.length;g++)h._inferencer._rules.push(m[b]._inferencer._rules[g]);
for(g=0;g<m[b]._activators.length;g++){var k=a(m,m[b]._activators[g]);null!==k&&e.error(Error("Cannot wire-in ontology with missing activator dependency on '"+k+"'"));h.registerActivator(m[b]._activators[g]);h._activators.sort(function(f,a){if(f.title==a.title)return 0;for(var d=0;d<f.dependencies.length;d++)if(a.title==f.dependencies[d])return 1;for(d=0;d<a.dependencies.length;d++)if(f.title==a.dependencies[d])return-1;return 0})}}return h.getModel(d)};e.alsoBehavesLike=function(f,a){("undefined"===
typeof f||"undefined"===typeof a)&&e.error(Error("Cannot mixin with an undefined object"));for(var d in a)if(a.hasOwnProperty(d)&&!(0==d.indexOf("_")||"initializer"===d))if("undefined"!==typeof f[d]){if("undefined"!==typeof a[d].prototype){if("undefined"!==typeof a[d].prototype.initializer&&!0==a[d].prototype.initializer)continue;var b="undefined"!==typeof a[d].prototype.virtual?a[d].prototype.virtual:!1}var c="undefined"!==typeof f[d].prototype?f[d].prototype.virtual:!1;if(!c||!b)c&&(f[d]=a[d])}else f[d]=
a[d];"undefined"!==typeof a.prototype&&("undefined"===typeof f.prototype&&(f.prototype={}),e.alsoBehavesLike(f.prototype,a.prototype))};e.error=function(f,a){if("undefined"!==typeof a&&"function"===typeof a.handleError)a.handleError(f);else if("function"===typeof e.handleError)e.handleError(f);else throw f;};e.CONCEPT="concept";e.RELATIONSHIP="relationship";var l=function(a,d){this._term=a;this._rules=d._rules;return this};l.prototype.getType=function(){return"[object Proxy]"};l.prototype.ofType=
function(a){return"Proxy"===a||"function"===typeof a.getType&&a.getType()===this.getType()};var k=function(){return this};k.prototype.relate=function(a){"undefined"===typeof this._relatesTo&&(this._relatesTo=[]);for(var d=!1,e=0;e<this._relatesTo.length;e++)if(this._relatesTo[e]._id==a._id){d=!0;break}d||this._relatesTo.push(a)};k.prototype.getType=function(){return"[object Term]"};k.prototype.ofType=function(a){return"Term"===a||"function"===typeof a.getType&&a.getType()===this.getType()};e.Behavior=
function(a){this.title=a;return this};e.Ontology=function(a){this.title=a;this._inferencer=new d;this._activators=[];this._term=function(a){this._id=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var d=16*Math.random()|0;return("x"==a?d:d&3|8).toString(16)})}();"undefined"!==typeof a._value&&"undefined"!==typeof a._type?(this._value=a._value,this._type=a._type):(this._value=a,this._type=null);return this};return this};e.Ontology.prototype.getType=function(){return"[object Ontology]"};
e.Ontology.prototype.addTerm=function(a){if("undefined"!==typeof this[a])return this;var d=this._term;d.prototype.relate=k.prototype.relate;d.prototype.getType=k.prototype.getType;d.prototype.ofType=k.prototype.ofType;d=new d(a);this[a]=new l(d,this._inferencer);return this};e.Ontology.prototype.registerActivator=function(a,d){"undefined"===typeof d&&(d=[]);"function"!==typeof a&&"function"===typeof a.getType&&"[object Activator]"===a.getType()?this._activators.push(a):this._activators.push({fn:a,
title:this.title,dependencies:d,getType:function(){return"[object Activator]"}})};e.Ontology.prototype.getModel=function(a){var d=new function(a){return this},b=[];if("undefined"!==typeof a){b=b.concat(a);for(a=0;a<b.length;a++)if("undefined"!==typeof b[a].prototype&&!0===b[a].prototype.initializer)b[a](d)}for(var h in this)if(this.hasOwnProperty(h)&&!("undefined"===typeof this[h]||"undefined"===this[h]._term)&&0!==h.indexOf("_"))if("undefined"!==typeof this[h]._term){d[h]=this[h]._term;for(a=0;a<
b.length;a++)e.alsoBehavesLike(Object.getPrototypeOf(d[h]),b[a].prototype)}else d[h]=this[h];this._inferencer._rules.sort(function(a,d){return a._priority-d._priority});for(a=0;a<this._inferencer._rules.length;a++)b=this._inferencer._rules[a],b._fn.apply(d,b._args);for(a=0;a<this._activators.length;a++)this._activators[a].fn(d);return d};var d=function(){this._term={_value:null};this._rules=[];return this},b=function(a,d,b){this._fn=d;this._args=b;this._priority=a;return this};d.prototype.isA=function(a){this._rules.push(new b(1,
g,[this._term._value,a._term._value]));return this};d.prototype.relatesTo=function(a,d){this._rules.push(new b(10,c,[this._term._value,a._term._value,d._term._value]));return this};d.prototype.hasDomain=function(a){this._rules.push(new b(3,p,[this._term._value,a._term._value]));return this};d.prototype.hasRange=function(a){this._rules.push(new b(2,q,[this._term._value,a._term._value]));return this};e.alsoBehavesLike(l,d);var c=function(a,d,b){a=this[a];var h=this[d],c=this[b];h._type===e.CONCEPT?
e.error(Error("Cannot define a relationship with a concept type: "+h._value)):null===h._type&&(h._type=e.RELATIONSHIP);c._type===e.RELATIONSHIP?e.error(Error("Cannot create a relationship with a relationship type: "+c._value)):null===c._type&&(c._type=e.CONCEPT);a._type===e.RELATIONSHIP?e.error(Error("Cannot create a relationship from a relationship type: "+a._value)):null===a._type&&(a._type=e.CONCEPT);"undefined"===typeof a[d]&&(a[d]=new a.constructor(h));"undefined"===typeof a[d][b]&&(a[d][b]=
c);"undefined"===typeof a[b]&&(a[b]=c);c.relate(a[d]);for(var g in c)c.hasOwnProperty(g)&&(c[g].getType&&"[object Term]"===c[g].getType())&&("undefined"===typeof a[d][g]&&(a[d][g]=c[g]),"undefined"===typeof a[g]&&(a[g]=c[g]),c[g].relate(a[d]))},g=function(a,d){var b=this[a],c=this[d];c._type===e.RELATIONSHIP?e.error(Error("Cannot apply isA to a relationship type: "+c._value)):null===c._type&&(c._type=e.CONCEPT);b._type===e.RELATIONSHIP?e.error(Error("Cannot apply isA to a relationship type: "+b._value)):
null===b._type&&(b._type=e.CONCEPT);"undefined"===typeof c[a]&&(c[a]=b)},q=function(a,d){var b=this[a],c=this[d];c._type===e.RELATIONSHIP?e.error(Error("Cannot apply hasRange to a relationship type: "+c._value)):null===c._type&&(c._type=e.CONCEPT);b._type===e.CONCEPT?e.error(Error("Cannot assign hasRange from a concept type: "+b._value)):null===b._type&&(b._type=e.RELATIONSHIP);"undefined"===typeof b[d]&&(b[d]=c);c.relate(b);for(var g in c)if(c.hasOwnProperty(g)&&c[g].getType&&"[object Term]"===c[g].getType()){var k=
c[g]._value;"undefined"===typeof b[k]&&(b[k]=c[g]);c[g].relate(b)}},p=function(a,d){var b=this[a],c=this[d];c._type===e.RELATIONSIP?e.error(Error("Cannot apply hasRange to a relationship type: "+c._value)):null===c._type&&(c._type=e.CONCEPT);b._type===e.CONCEPT?e.error(Error("Cannot assign hasRange from a concept type: "+b._value)):null===b._type&&(b._type=e.RELATIONSHIP);"undefined"===typeof c[a]&&(c[a]=b)};e.typeMask=function(a,d){var b=[],c;for(c in d)d.hasOwnProperty(c)&&("undefined"===typeof a||
"undefined"===typeof a[c]?b.push(c):"undefined"!==typeof a[c]&&typeof a[c]!==d[c]&&!0!==d[c]&&b.push(c));return 0===b.length?null:b};return e}(smallmachine||{});(function(e){var a=new e.Ontology("sm.properties");a.addTerm("property");a.addTerm("type");a.addTerm("ontology");a.addTerm("behavior");a.addTerm("hasMemberType");a.addTerm("hasMember");a.addTerm("Ontology");a.addTerm("Behavior");a.addTerm("Constructor");a.addTerm("Null");a.ontology.isA(a.property);a.behavior.isA(a.property);a.Ontology.isA(a.type);a.Behavior.isA(a.type);a.Constructor.isA(a.type);a.Null.isA(a.type);a.ontology.relatesTo(a.hasMemberType,a.Ontology);a.behavior.relatesTo(a.hasMemberType,
a.Behavior);a.ontology.relatesTo(a.hasMember,a.Null);a.behavior.relatesTo(a.hasMember,a.Null);var l=function(){return this};l.prototype.extendedBy=function(a,b){if("undefined"!==typeof b&&"function"===typeof a)"undefined"!==typeof this[b]?e.alsoBehavesLike(this[b],a):this[b]=a,"function"!==typeof this[b].prototype.getType&&(this[b].prototype.getType=function(){return"[object "+b+"]"}),"function"!==typeof this[b].prototype.ofType&&(this[b].prototype.ofType=function(a){return"function"===typeof a.getType?
this.getType()===a.getType():this.getType()==="[object "+a+"]"});else{var c=b||a.title;"undefined"===typeof c&&e.error(Error("Cannot call extendedBy on the core ontology with an object that is missing the 'title' property without specifying a 'typeName'"));if("undefined"!==typeof this[c])e.alsoBehavesLike(this[c],a);else{var g=this.hasMemberType;("undefined"===typeof g||"undefined"===typeof g.getType)&&e.error(Error("The specified concept does not have a valid 'hasMemberType' relationship with another concept"));
var k=e[this._value][g._value];"undefined"===typeof k&&e.error(Error("The specified type does not exist in the core object model: "+g._value));"function"!==typeof a.getType&&e.error(Error("The specified model is missing the getType function: "+c));var g=a.getType(),l=!1,f;for(f in k)if(k.hasOwnProperty(f)&&"undefined"!==typeof this[f].getType&&"[object "+f+"]"===g){this.hasMember[c]=a;this[c]=a;l=!0;break}l||e.error(Error("Did not find an allowed model type for: "+g))}}};var k=function(){this.title=
"Null";return this};k.prototype.getType=function(){return"[object Null]"};k.prototype.ofType=function(a){return null===a||"null"===a||"Null"===a?!0:!1};e.alsoBehavesLike(e,a.getModel(l));e.ontology.extendedBy(new k);e.behavior.extendedBy(new k);a=function(a){this._channel=a;return this};a.prototype.publish=function(a,b){this._channel.publish(a,b);return this};e.type.extendedBy(a,"AsyncResult");e.type.extendedBy(function(a,b,c){"undefined"===typeof b&&e.error(Error("Parameter 'key' is required when instantiating the sm.NamedValue type"));
this.namespace=a;this.key=b;this.value=c;return this},"NamedValue");a=function(){this.title="NamedValueCollection";this._collection={};return this};a.prototype.exists=function(a,b){var c=a;null===e.typeMask(a,{namespace:!0,key:!0})&&(c=a.namespace,b=a.key);return"undefined"!==typeof this._collection[c]&&"undefined"!==typeof this._collection[c][b]};a.prototype.add=function(a,b,c){var g=a.namespace||a,k=a.key||b;"undefined"!==typeof this._collection[g]&&"undefined"!==this._collection[g][k]&&e.error(Error("Cannot add a new entry to the collection (already exists): ["+
g+"]"+k));this.modify(a,b,c);return this};a.prototype.modify=function(a,b,c){var g=a.namespace||a;b=a.key||b;a=a.value||c;"undefined"===typeof b&&e.error(Error("Must supply a valid key"));"undefined"===typeof a&&e.error(Error("Must supply a valid value"));"undefined"===typeof this._collection[g]&&(this._collection[g]={});this._collection[g][b]=a;return this};a.prototype.remove=function(a,b){if(!("undefined"===typeof this._collection[a]||"undefined"===typeof this._collection[a][b]))return delete this._collection[a][b],
this};a.prototype.getValue=function(a,b){var c=a.namespace||a,e=a.key||b;if(!("undefined"===typeof this._collection[c]||"undefined"===this._collection[c][e]))return c=this._collection[c][e],"undefined"!==typeof c&&("function"===typeof a.setValue?a.setValue(c):"undefined"!==typeof a.value&&(a.value=c)),c};a.prototype.ofType=function(a){return"NamedValueCollection"===a||"function"===typeof a.getType&&a.getType()===this.getType()};e.type.extendedBy(a,"NamedValueCollection")})(smallmachine);(function(e){var a=new e.Ontology("sm.channels");a.addTerm("thing");a.addTerm("user");a.addTerm("system");a.addTerm("action");a.addTerm("click");a.addTerm("doubleClick");a.addTerm("keyPress");a.addTerm("task");a.addTerm("initialize");a.addTerm("insert");a.addTerm("remove");a.addTerm("get");a.addTerm("set");a.addTerm("messenger");a.addTerm("success");a.addTerm("error");a.addTerm("performs");a.addTerm("reactsTo");a.user.isA(a.thing);a.user.relatesTo(a.performs,a.action);a.system.isA(a.thing);a.system.relatesTo(a.performs,
a.task);a.action.isA(a.thing);a.task.isA(a.thing);a.messenger.isA(a.thing);a.click.isA(a.action);a.doubleClick.isA(a.action);a.keyPress.isA(a.action);a.get.isA(a.task);a.set.isA(a.task);a.success.isA(a.messenger);a.error.isA(a.messenger);a.initialize.isA(a.task);a.insert.isA(a.task);a.remove.isA(a.task);a.performs.hasRange(a.action).hasRange(a.task);a.reactsTo.hasRange(a.action).hasDomain(a.system);a.registerActivator(function(a){var d=function(b,d){if("undefined"!==typeof jQuery)try{jQuery.ajax({dataType:"json",
url:b,type:"GET",success:function(c,f,h){a.messenger.success.publish(f);d.publish(new e.type.NamedValue("sm.channels",b,c))},error:function(a,b,d){e.error(Error(d))}})}catch(c){e.error(Error(c))}else{var f=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP.3.0");f.onprogress=function(){};f.onerror={};f.onreadystatechange=function(){4>f.readyState||(200==f.status?(a.messenger.success.publish(f.statusText),d.publish(new e.type.NamedValue("sm.channels",b,JSON.parse(f.responseText)))):
e.error(Error(f.statusText)))};f.open("GET",b,!0);f.setRequestHeader("X-Requested-With","XMLHttpRequest");f.setRequestHeader("Content-type","application/json");f.send(null)}return d},b={update:function(b){return"function"===typeof b.ofType&&b.ofType("NamedValue")?function(b){a.memory.modify(b)}:!1}};e.alsoBehavesLike(a,{memory:new e.type.NamedValueCollection});a.set.subscribe({update:function(a){return b}});var c={update:function(b){return"function"===typeof b.ofType?function(b){a.memory.getValue(b)}:
!1}};a.get.subscribe({update:function(a){return c}});"function"===typeof a.initialize.addHelper&&a.initialize.addHelper("json",d);"function"===typeof a.set.addHelper&&a.set.addHelper("config",function(a){return new e.type.NamedValue("sm.channels","config",a)});"function"===typeof a.get.addHelper&&(a.get.addHelper("json",d),d=function(){this.namespace="sm.channels";this.key="config";return this},d.prototype.setValue=function(a){e.alsoBehavesLike(this,a)},e.type.extendedBy(d,"Config"),a.get.addHelper("config",
function(a){return a}))});try{e.ontology.extendedBy(a)}catch(l){e.error(Error("Could not extend the smallmachine.ontology property with the 'sm.channels' ontology: "+l.message+"\n"+l.stack))}})(smallmachine);(function(e){var a=function(a,b){this._value=a;this._type=b;return this};a.prototype.forward=function(a,b){null!=this._value&&(b[this._value]=!0);for(var c in this)if(this.hasOwnProperty(c)&&!("function"===typeof this[c]||0===c.indexOf("_"))&&!0!==b[c]&&"function"===typeof this[c].publish)b[c]=!0,this[c].publish(a,b);if("undefined"!==typeof this._relatesTo)for(c=0;c<this._relatesTo.length;c++)"undefined"!==typeof this._relatesTo[c]._subscribers&&this.notify(a,this._relatesTo[c]._subscribers)};var l=
function(a){var b=16*Math.random()|0;return("x"==a?b:b&3|8).toString(16)},k=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,l)};a.prototype.unsubscribe=function(a){"undefined"!==typeof this._subscribers&&delete this._subscribers[a]};a.prototype.subscribe=function(a){"undefined"===typeof this._subscribers&&(this._subscribers={});var b=k();"function"===typeof a?this._subscribers[b]={update:a,lifetime:1}:("undefined"===typeof a.lifecycle&&(a.lifetime=1),this._subscribers[b]=a);
return b};a.prototype.notify=function(a,b){var c=!1,e={},l=0,p=[],f;for(f in b){var n=b[f].update(a);"undefined"!==typeof b[f]&&(0>=b[f].lifetime&&this.unsubscribe(f),!0===n?c=!0:"function"===typeof n?(p.push(n),c=!0):n&&"function"===typeof n.update&&(e[k()]=n,l++))}if(c){f=!1;for(n=0;n<p.length;n++)!1===!p[n](a)&&(f=!0);!1===f&&(c=!1)}!1==c&&0<l&&this.notify(a,e)};a.prototype.publish=function(a,b){b=b||{};if("function"===typeof a&&(a=a(new e.type.AsyncResult(this)),"undefined"!==typeof a&&"function"===
typeof a.getType&&"[object AsyncResult]"===a.getType()))return this;if("undefined"===typeof this._subscribers)return this.forward(a,b),this;this.notify(a,this._subscribers);this.forward(a,b);return this};a.prototype.addHelper=function(d,b){var c=a.prototype.publish,e=this;this[d]=function(){for(var a=[],d=0;d<arguments.length;d++)a.push(arguments[d]);return c.apply(e,[function(d){a.push(d);return b.apply(e,a)}])};return this};a.prototype.getType=function(){return"[object Channel]"};a.prototype.ofType=
function(a){return"Channel"===a||"function"===typeof a.getType&&a.getType()===this.getType()};e.behavior.extendedBy(a,"Channel")})(smallmachine);(function(e,a){var l=function(e){"undefined"!==typeof a.fn&&a.extend({sm:e});return this};l.prototype.initializer=!0;e.behavior.extendedBy(l,"Extension")})(smallmachine,jQuery||{});
