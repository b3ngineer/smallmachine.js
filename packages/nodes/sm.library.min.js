var smallmachine=function(b){"function"!==typeof Object.getPrototypeOf&&(Object.getPrototypeOf="object"===typeof"test".__proto__?function(a){return a.__proto__}:function(a){return a.constructor.prototype});var a=function(a,b){for(var d=0;d<b.dependencies.length;d++){for(var c=!1,f=0;f<a.length;f++)if(b.dependencies[d]==a[f].title){c=!0;break}if(!c)return b.dependencies[d]}return null};b=function(m,c){"undefined"===typeof m&&b.error(Error("Missing required parameter for smallmachine constructor: one or more instances of type [object Ontology]"));
for(var d=[].concat(m),h="",f=0;f<d.length;f++)"function"!==typeof d[f].ofType||!d[f].ofType("Ontology")?"undefined"!==typeof b.ontology[d[f]]&&(h=h+d[f]+",",d[f]=b.ontology[d[f]]):h+=d[f].title;h=new b.Ontology(h.substring(0,h.length-1));for(f=0;f<d.length;f++){for(var k in d[f])d[f].hasOwnProperty(k)&&"function"===typeof d[f][k].ofType&&d[f][k].ofType("Proxy")&&h.addTerm(d[f][k]._term._value);for(var e=0;e<d[f]._inferencer._rules.length;e++)h._inferencer._rules.push(d[f]._inferencer._rules[e]);
for(e=0;e<d[f]._activators.length;e++){var g=a(d,d[f]._activators[e]);null!==g&&b.error(Error("Cannot wire-in ontology with missing activator dependency on '"+g+"'"));h.registerActivator(d[f]._activators[e]);h._activators.sort(function(a,m){if(a.title==m.title)return 0;for(var d=0;d<a.dependencies.length;d++)if(m.title==a.dependencies[d])return 1;for(d=0;d<m.dependencies.length;d++)if(a.title==m.dependencies[d])return-1;return 0})}}return h.getModel(c)};b.alsoBehavesLike=function(a,c){("undefined"===
typeof a||"undefined"===typeof c)&&b.error(Error("Cannot mixin with an undefined object"));for(var d in c)if(c.hasOwnProperty(d)&&0!=d.indexOf("_"))if("undefined"!==typeof a[d]){var h="undefined"!==typeof a[d].prototype?a[d].prototype.virtual:!1,f="undefined"!==typeof c[d].prototype?c[d].prototype.virtual:!1;if(!h||!f)h&&(a[d]=c[d])}else a[d]=c[d];"undefined"!==typeof c.prototype&&("undefined"===typeof a.prototype&&(a.prototype={}),b.alsoBehavesLike(a.prototype,c.prototype))};b.error=function(a,c){if("undefined"!==
typeof c&&"function"===typeof c.handleError)c.handleError(a);else if("function"===typeof b.handleError)b.handleError(a);else throw a;};b.CONCEPT="concept";b.RELATIONSHIP="relationship";var g=function(a,c){this._term=a;this._rules=c._rules;return this};g.prototype.getType=function(){return"[object Proxy]"};g.prototype.ofType=function(a){return"Proxy"===a||"function"===typeof a.getType&&a.getType()===this.getType()};var l=function(){return this};l.prototype.relate=function(a){"undefined"===typeof this._relatesTo&&
(this._relatesTo=[]);for(var c=!1,d=0;d<this._relatesTo.length;d++)if(this._relatesTo[d]._id==a._id){c=!0;break}c||this._relatesTo.push(a)};l.prototype.getType=function(){return"[object Term]"};l.prototype.ofType=function(a){return"Term"===a||"function"===typeof a.getType&&a.getType()===this.getType()};b.Behavior=function(a){this.title=a;return this};b.Ontology=function(a){this.title=a;this._inferencer=new c;this._activators=[];this._term=function(a){this._id=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,
function(a){var c=16*Math.random()|0;return("x"==a?c:c&3|8).toString(16)})}();"undefined"!==typeof a._value&&"undefined"!==typeof a._type?(this._value=a._value,this._type=a._type):(this._value=a,this._type=null);return this};return this};b.Ontology.prototype.getType=function(){return"[object Ontology]"};b.Ontology.prototype.addTerm=function(a){if("undefined"!==typeof this[a])return this;var c=this._term;c.prototype.relate=l.prototype.relate;c.prototype.getType=l.prototype.getType;c.prototype.ofType=
l.prototype.ofType;c=new c(a);this[a]=new g(c,this._inferencer);return this};b.Ontology.prototype.registerActivator=function(a,c){"undefined"===typeof c&&(c=[]);"function"!==typeof a&&"function"===typeof a.getType&&"[object Activator]"===a.getType()?this._activators.push(a):this._activators.push({fn:a,title:this.title,dependencies:c,getType:function(){return"[object Activator]"}})};b.Ontology.prototype.getModel=function(a){var c=new function(a){return this},d;for(d in this)if(this.hasOwnProperty(d)&&
!("undefined"===typeof this[d]||"undefined"===this[d]._term)&&0!==d.indexOf("_"))if("undefined"!==typeof this[d]._term){if(c[d]=this[d]._term,"undefined"!==typeof a)for(var h=[].concat(a),f=0;f<h.length;f++)b.alsoBehavesLike(Object.getPrototypeOf(c[d]),h[f].prototype)}else c[d]=this[d];this._inferencer._rules.sort(function(a,c){return a._priority-c._priority});for(f=0;f<this._inferencer._rules.length;f++)a=this._inferencer._rules[f],a._fn.apply(c,a._args);for(f=0;f<this._activators.length;f++)this._activators[f].fn(c);
return c};var c=function(){this._term={_value:null};this._rules=[];return this},k=function(a,c,d){this._fn=c;this._args=d;this._priority=a;return this};c.prototype.isA=function(a){this._rules.push(new k(1,e,[this._term._value,a._term._value]));return this};c.prototype.relatesTo=function(a,c){this._rules.push(new k(10,p,[this._term._value,a._term._value,c._term._value]));return this};c.prototype.hasDomain=function(a){this._rules.push(new k(3,q,[this._term._value,a._term._value]));return this};c.prototype.hasRange=
function(a){this._rules.push(new k(2,n,[this._term._value,a._term._value]));return this};b.alsoBehavesLike(g,c);var p=function(a,c,d){a=this[a];var h=this[c],f=this[d];h._type===b.CONCEPT?b.error(Error("Cannot define a relationship with a concept type: "+h._value)):null===h._type&&(h._type=b.RELATIONSHIP);f._type===b.RELATIONSHIP?b.error(Error("Cannot create a relationship with a relationship type: "+f._value)):null===f._type&&(f._type=b.CONCEPT);a._type===b.RELATIONSHIP?b.error(Error("Cannot create a relationship from a relationship type: "+
a._value)):null===a._type&&(a._type=b.CONCEPT);"undefined"===typeof a[c]&&(a[c]=new a.constructor(h));"undefined"===typeof a[c][d]&&(a[c][d]=f);"undefined"===typeof a[d]&&(a[d]=f);f.relate(a[c]);for(var e in f)f.hasOwnProperty(e)&&(f[e].getType&&"[object Term]"===f[e].getType())&&("undefined"===typeof a[c][e]&&(a[c][e]=f[e]),"undefined"===typeof a[e]&&(a[e]=f[e]),f[e].relate(a[c]))},e=function(a,c){var d=this[a],h=this[c];h._type===b.RELATIONSHIP?b.error(Error("Cannot apply isA to a relationship type: "+
h._value)):null===h._type&&(h._type=b.CONCEPT);d._type===b.RELATIONSHIP?b.error(Error("Cannot apply isA to a relationship type: "+d._value)):null===d._type&&(d._type=b.CONCEPT);"undefined"===typeof h[a]&&(h[a]=d)},n=function(a,c){var d=this[a],h=this[c];h._type===b.RELATIONSHIP?b.error(Error("Cannot apply hasRange to a relationship type: "+h._value)):null===h._type&&(h._type=b.CONCEPT);d._type===b.CONCEPT?b.error(Error("Cannot assign hasRange from a concept type: "+d._value)):null===d._type&&(d._type=
b.RELATIONSHIP);"undefined"===typeof d[c]&&(d[c]=h);h.relate(d);for(var e in h)if(h.hasOwnProperty(e)&&h[e].getType&&"[object Term]"===h[e].getType()){var k=h[e]._value;"undefined"===typeof d[k]&&(d[k]=h[e]);h[e].relate(d)}},q=function(a,c){var d=this[a],e=this[c];e._type===b.RELATIONSIP?b.error(Error("Cannot apply hasRange to a relationship type: "+e._value)):null===e._type&&(e._type=b.CONCEPT);d._type===b.CONCEPT?b.error(Error("Cannot assign hasRange from a concept type: "+d._value)):null===d._type&&
(d._type=b.RELATIONSHIP);"undefined"===typeof e[a]&&(e[a]=d)};b.typeMask=function(a,c){var d=[],b;for(b in c)c.hasOwnProperty(b)&&(!0===c[b]?"undefined"===typeof a[b]&&d.push(b):"undefinedf"!==typeof a[b]&&typeof a[b]!==c[b]&&d.push(b));return 0===d.length?null:d};return b}(smallmachine||{});(function(b){var a=new b.Ontology("sm.properties");a.addTerm("property");a.addTerm("type");a.addTerm("ontology");a.addTerm("behavior");a.addTerm("hasMemberType");a.addTerm("hasMember");a.addTerm("Ontology");a.addTerm("Behavior");a.addTerm("Constructor");a.addTerm("Null");a.ontology.isA(a.property);a.behavior.isA(a.property);a.Ontology.isA(a.type);a.Behavior.isA(a.type);a.Constructor.isA(a.type);a.Null.isA(a.type);a.ontology.relatesTo(a.hasMemberType,a.Ontology);a.behavior.relatesTo(a.hasMemberType,
a.Behavior);a.ontology.relatesTo(a.hasMember,a.Null);a.behavior.relatesTo(a.hasMember,a.Null);var g=function(){return this};g.prototype.extendedBy=function(a,k){if("undefined"!==typeof k&&"function"===typeof a)"undefined"!==typeof this[k]?b.alsoBehavesLike(this[k],a):this[k]=a,"function"!==typeof this[k].prototype.getType&&(this[k].prototype.getType=function(){return"[object "+k+"]"}),"function"!==typeof this[k].prototype.ofType&&(this[k].prototype.ofType=function(a){return"function"===typeof a.getType?
this.getType()===a.getType():this.getType()==="[object "+a+"]"});else{var g=k||a.title;"undefined"===typeof g&&b.error(Error("Cannot call extendedBy on the core ontology with an object that is missing the 'title' property without specifying a 'typeName'"));if("undefined"!==typeof this[g])b.alsoBehavesLike(this[g],a);else{var e=this.hasMemberType;("undefined"===typeof e||"undefined"===typeof e.getType)&&b.error(Error("The specified concept does not have a valid 'hasMemberType' relationship with another concept"));
var l=b[this._value][e._value];"undefined"===typeof l&&b.error(Error("The specified type does not exist in the core object model: "+e._value));"function"!==typeof a.getType&&b.error(Error("The specified model is missing the getType function: "+g));var e=a.getType(),q=!1,m;for(m in l)if(l.hasOwnProperty(m)&&"undefined"!==typeof this[m].getType&&"[object "+m+"]"===e){this.hasMember[g]=a;this[g]=a;q=!0;break}q||b.error(Error("Did not find an allowed model type for: "+e))}}};var l=function(){this.title=
"Null";return this};l.prototype.getType=function(){return"[object Null]"};l.prototype.ofType=function(a){return null===a||"null"===a||"Null"===a?!0:!1};b.alsoBehavesLike(b,a.getModel(g));b.ontology.extendedBy(new l);b.behavior.extendedBy(new l);a=function(a){this._channel=a;return this};a.prototype.publish=function(a,b){this._channel.publish(a,b);return this};b.type.extendedBy(a,"AsyncResult");b.type.extendedBy(function(a,k,g){"undefined"===typeof k&&b.error(Error("Parameter 'key' is required when instantiating the sm.NamedValue type"));
this.namespace=a;this.key=k;this.value=g;return this},"NamedValue");a=function(){this.title="NamedValueCollection";this._collection={};return this};a.prototype.exists=function(a,b){var g=a;"function"===typeof a.ofType&&a.ofType("NamedValue")&&(g=a.namespace,b=a.key);return"undefined"!==typeof this._collection[g]&&"undefined"!==typeof this._collection[g][b]};a.prototype.add=function(a,g,l){var e=a.namespace||a,n=a.key||g;"undefined"!==typeof this._collection[e]&&"undefined"!==this._collection[e][n]&&
b.error(Error("Cannot add a new entry to the collection (already exists): ["+e+"]"+n));this.modify(a,g,l);return this};a.prototype.modify=function(a,g,l){var e=a.namespace||a;g=a.key||g;a=a.value||l;"undefined"===typeof g&&b.error(Error("Must supply a valid key"));"undefined"===typeof a&&b.error(Error("Must supply a valid value"));"undefined"===typeof this._collection[e]&&(this._collection[e]={});this._collection[e][g]=a;return this};a.prototype.remove=function(a,b){if(!("undefined"===typeof this._collection[a]||
"undefined"===typeof this._collection[a][b]))return delete this._collection[a][b],this};a.prototype.getValue=function(a,b){var g=a.namespace||a,e=a.key||b;if(!("undefined"===typeof this._collection[g]||"undefined"===this._collection[g][e]))return g=this._collection[g][e],"function"===typeof a.ofType&&a.ofType("NamedValue")&&"undefined"!==typeof g&&(a.value=g),g};a.prototype.ofType=function(a){return"NamedValueCollection"===a||"function"===typeof a.getType&&a.getType()===this.getType()};b.type.extendedBy(a,
"NamedValueCollection")})(smallmachine);(function(b){var a=new b.Ontology("sm.channels");a.addTerm("thing");a.addTerm("user");a.addTerm("system");a.addTerm("action");a.addTerm("click");a.addTerm("doubleClick");a.addTerm("keyPress");a.addTerm("task");a.addTerm("initialize");a.addTerm("insert");a.addTerm("remove");a.addTerm("get");a.addTerm("set");a.addTerm("messenger");a.addTerm("success");a.addTerm("error");a.addTerm("performs");a.addTerm("reactsTo");a.user.isA(a.thing);a.user.relatesTo(a.performs,a.action);a.system.isA(a.thing);a.system.relatesTo(a.performs,
a.task);a.action.isA(a.thing);a.task.isA(a.thing);a.messenger.isA(a.thing);a.click.isA(a.action);a.doubleClick.isA(a.action);a.keyPress.isA(a.action);a.get.isA(a.task);a.set.isA(a.task);a.success.isA(a.messenger);a.error.isA(a.messenger);a.initialize.isA(a.task);a.insert.isA(a.task);a.remove.isA(a.task);a.performs.hasRange(a.action).hasRange(a.task);a.reactsTo.hasRange(a.action).hasDomain(a.system);a.registerActivator(function(a){var c=function(c,g){if("undefined"!==typeof jQuery)try{jQuery.ajax({dataType:"json",
url:c,type:"GET",success:function(b,c,e){a.messenger.success.publish(c);g.publish(b)},error:function(a,c,g){b.error(Error(g))}})}catch(k){b.error(Error(k))}else{var m=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP.3.0");m.onprogress=function(){};m.onerror={};m.onreadystatechange=function(){4>m.readyState||(200==m.status?(a.messenger.success.publish(m.statusText),g.publish(JSON.parse(m.responseText))):b.error(Error(m.statusText)))};m.open("GET",c,!0);m.setRequestHeader("X-Requested-With",
"XMLHttpRequest");m.setRequestHeader("Content-type","application/json");m.send(null)}return g};"function"===typeof a.initialize.addHelper&&a.initialize.addHelper("json",c);var g={update:function(b){return"function"===typeof b.ofType&&b.ofType("NamedValue")?function(b){a.memory.modify(b)}:!1}};b.alsoBehavesLike(a,{memory:new b.type.NamedValueCollection});a.set.subscribe({update:function(a){return g}});var p={update:function(b){return"function"===typeof b.ofType&&b.ofType("NamedValue")?function(b){a.memory.getValue(b)}:
!1}};a.get.subscribe({update:function(a){return p}})});try{b.ontology.extendedBy(a)}catch(g){b.error(Error("Could not extend the smallmachine.ontology property with the 'sm.channels' ontology: "+g.message+"\n"+g.stack))}})(smallmachine);(function(b){var a=function(a,b){this._value=a;this._type=b;return this};a.prototype.forward=function(a,b){null!=this._value&&(b[this._value]=!0);for(var c in this)if(this.hasOwnProperty(c)&&!("function"===typeof this[c]||0===c.indexOf("_"))&&!0!==b[c]&&"function"===typeof this[c].publish)b[c]=!0,this[c].publish(a,b);if("undefined"!==typeof this._relatesTo)for(c=0;c<this._relatesTo.length;c++)"undefined"!==typeof this._relatesTo[c]._subscribers&&this.notify(a,this._relatesTo[c]._subscribers)};a.prototype.subscribe=
function(a){"undefined"===typeof this._subscribers&&(this._subscribers=[]);if("function"===typeof a)return this._subscribers.push({update:a}),this;this._subscribers.push(a);return this};a.prototype.notify=function(a,b){for(var c=!1,k=[],p=[],e=0;e<b.length;e++){var n=b[e].update(a);!0===n?c=!0:"function"===typeof n?(p.push(n),c=!0):n&&"function"===typeof n.update&&k.push(n)}if(c){n=!1;for(e=0;e<p.length;e++)!1===!p[e](a)&&(n=!0);!1===n&&(c=!1)}!1==c&&0<k.length&&this.notify(a,k)};a.prototype.publish=
function(a,l){if("undefined"===typeof this)throw Error("holy fucking shit");l=l||{};if("function"===typeof a&&(a=a(new b.type.AsyncResult(this)),"undefined"!==typeof a&&"function"===typeof a.getType&&"[object AsyncResult]"===a.getType()))return this;if("undefined"===typeof this._subscribers)return this.forward(a,l),this;this.notify(a,this._subscribers);this.forward(a,l);return this};a.prototype.addHelper=function(b,l){var c=a.prototype.publish,k=this;this[b]=function(){for(var a=[],b=0;b<arguments.length;b++)a.push(arguments[b]);
return c.apply(k,[function(b){a.push(b);return l.apply(k,a)}])};return this};a.prototype.getType=function(){return"[object Channel]"};a.prototype.ofType=function(a){return"Channel"===a||"function"===typeof a.getType&&a.getType()===this.getType()};b.behavior.extendedBy(a,"Channel")})(smallmachine);
