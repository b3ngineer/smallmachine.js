<html>
<head>
	<title>Nodes</title>
	<link type="text/css" rel="stylesheet" href="style/example.css" />
</head>
<body>
	<div id="background"></div>
    <div id="paper"></div>
	<script type="text/javascript" src="../lib/jquery-1.10.2.min.js"></script>
	<script type="text/javascript" src="../lib/raphael-min.js"></script>
	<script type="text/javascript" src="../src/sm.core.js"></script>
	<script type="text/javascript" src="../src/ontologies/sm.properties.js"></script>
	<script type="text/javascript" src="../src/ontologies/sm.channels.js"></script>
	<script type="text/javascript" src="../src/ontologies/sm.nodes.js"></script>
	<script type="text/javascript" src="../src/ontologies/sm.treelayout.js"></script>
	<script type="text/javascript" src="../src/ontologies/sm.raphaeljs.js"></script>
	<script type="text/javascript" src="../src/behaviors/sm.Channel.js"></script>
	<script type="text/javascript">
        (function(sm) {
			var com = { stackoverflow : { getParameterByName : function(name) {
				name = name.replace(/[\[]/, "\\\[").replace(/[\]]/, "\\\]");
				var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
					results = regex.exec(location.search);
				return results == null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
			}}};
			
			try {
				var channels = sm.ontology['sm.channels'];
				var nodes = sm.ontology['sm.nodes'];
				var treelayout = sm.ontology['sm.treelayout'];
				var raphaeljs = sm.ontology['sm.raphaeljs'];
				var wiring = sm([channels, nodes, treelayout, raphaeljs], sm.behavior.Channel);
				var exampleNumber = com.stackoverflow.getParameterByName('n');
				if (exampleNumber === null) {
					//wiring.system.initialize.publish();
				}
				else {
					wiring.system.set.config({
						shapeAttr : {
							'fill': '90-#777793:5-#FFF:95',
							'stroke': '#FFF',
							'stroke-width' : 2
						},
						lineAttr : {
							'stroke':'#aab',
							'stroke-width' : 2,
							'arrow-end' : 'classic-wide-long'
						},
						edgeLabelAttr : {
							'fill' : '#eef',
							'font-weight' : 'normal'
						}
					});
					wiring.system.set.svg('paper', '100%', '100%');
					wiring.system.set.publish(new sm.type.NamedValue('sm.treelayout', 'root', '1'));
					wiring.system.initialize.subscribe(function(message) {
						wiring.system.paint.publish(message);
					});
					wiring.system.initialize.json('example.' + exampleNumber + '.json');
				}
			}
			catch (error) {
				if (typeof console.error === 'function') {
					console.error(error.message + '\n' + error.stack);
				}
				else if (typeof console.log === 'function') {
					console.log(error.message + '\n' + error.stack);
				}
				else {
					alert(error.message);
				}
			}
		}(smallmachine));
	</script>
</body>
</html>

