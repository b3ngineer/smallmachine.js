var smallmachine=function(d){function b(a,c){for(var p=0;p<c.dependencies.length;p++){for(var d=!1,e=0;e<a.length;e++)if(c.dependencies[p]==a[e].namespace){d=!0;break}if(!d)return c.dependencies[p]}return null}function h(a,c){this._term=a;this._rules=c._rules;return this}function f(){return this}function g(){return this}function l(a){this._id=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var c=16*Math.random()|0;return("x"==a?c:c&3|8).toString(16)})}();"undefined"!==
typeof a._value&&"undefined"!==typeof a._type?(this._value=a._value,this._type=a._type):(this._value=a,this._type=null);return this}function c(c){this.namespace=c;this._inferencer=new a;this._activators=[];this._term=l;return this}function a(){this._term={_value:null};this._rules=[];return this}function e(a,c){var p=this[a];"function"===typeof c?d.alsoBehavesLike(p,c.prototype):d.alsoBehavesLike(p,c);for(var e in p)p.hasOwnProperty(e)&&0!==e.indexOf("_")&&"undefined"!==typeof p[e]._type&&p[e]._type===
d.CONCEPT&&("function"===typeof c?d.alsoBehavesLike(p[e],c.prototype):d.alsoBehavesLike(p[e],c))}function k(a,c,e){a=this[a];var k=this[c],b=this[e];k._type===d.CONCEPT?d.error(Error("Cannot define a relationship with a concept type: "+k._value)):null===k._type&&(k._type=d.RELATIONSHIP);b._type===d.RELATIONSHIP?d.error(Error("Cannot create a relationship with a relationship type: "+b._value)):null===b._type&&(b._type=d.CONCEPT);a._type===d.RELATIONSHIP?d.error(Error("Cannot create a relationship from a relationship type: "+
a._value)):null===a._type&&(a._type=d.CONCEPT);"undefined"===typeof a[c]&&(a[c]=new a.constructor(k));"undefined"===typeof a[c][e]&&(a[c][e]=b);"undefined"===typeof a[e]&&(a[e]=b);b.relate(a[c]);for(var f in b)b.hasOwnProperty(f)&&"function"===typeof b[f].relate&&("undefined"===typeof a[c][f]&&(a[c][f]=b[f]),"undefined"===typeof a[f]&&(a[f]=b[f]),b[f].relate(a[c]))}function s(a,c){var e=this[a],b=this[c];b._type===d.RELATIONSHIP?d.error(Error("Cannot apply isA to a relationship type: "+b._value)):
null===b._type&&(b._type=d.CONCEPT);e._type===d.RELATIONSHIP?d.error(Error("Cannot apply isA to a relationship type: "+e._value)):null===e._type&&(e._type=d.CONCEPT);"undefined"===typeof b[a]&&(b[a]=e)}function m(a,c){var e=this[a],b=this[c];b._type===d.RELATIONSHIP?d.error(Error("Cannot apply hasRange to a relationship type: "+b._value)):null===b._type&&(b._type=d.CONCEPT);e._type===d.CONCEPT?d.error(Error("Cannot assign hasRange from a concept type: "+e._value)):null===e._type&&(e._type=d.RELATIONSHIP);
"undefined"===typeof e[c]&&(e[c]=b);b.relate(e);for(var k in b)if(b.hasOwnProperty(k)&&"function"===typeof b[k].relate){var f=b[k]._value||null;null!==f&&("undefined"===typeof e[f]&&(e[f]=b[k]),b[k].relate(e))}}function q(a,c){var e=this[a],b=this[c];b._type===d.RELATIONSIP?d.error(Error("Cannot apply hasRange to a relationship type: "+b._value)):null===b._type&&(b._type=d.CONCEPT);e._type===d.CONCEPT?d.error(Error("Cannot assign hasRange from a concept type: "+e._value)):null===e._type&&(e._type=
d.RELATIONSHIP);"undefined"===typeof b[a]&&(b[a]=e)}"function"!==typeof Object.getPrototypeOf&&(Object.getPrototypeOf="object"===typeof"test".__proto__?function(a){return a.__proto__}:function(a){return a.constructor.prototype});d=function(a,e){"undefined"===typeof a&&d.error(Error("Missing required parameter for smallmachine constructor: one or more instances of type 'Ontology'"));for(var k=[].concat(a),f="",h=0;h<k.length;h++)"undefined"===typeof k[h]&&d.error(Error("Element "+h+" of the ontologies argument passed to the smallmachine constructor is undefined")),
"undefined"===typeof k[h].namespace?"undefined"!==typeof d.ontology[k[h]]&&(f=f+k[h]+",",k[h]=d.ontology[k[h]]):f=f+k[h].namespace+",";f=new c(f.substring(0,f.length-1));for(h=0;h<k.length;h++){for(var s in k[h])k[h].hasOwnProperty(s)&&"undefined"!==typeof k[h][s]._name&&"Proxy"==k[h][s]._name&&f.addTerm(k[h][s]._term._value);for(var g=0;g<k[h]._inferencer._rules.length;g++)f._inferencer._rules.push(k[h]._inferencer._rules[g]);for(g=0;g<k[h]._activators.length;g++){var m=b(k,k[h]._activators[g]);
null!==m&&d.error(Error("Cannot wire-in ontology with missing activator dependency on '"+m+"'"));f.registerActivator(k[h]._activators[g]);f._activators.sort(function(a,c){if(a.namespace==c.namespace)return 0;for(var e=0;e<a.dependencies.length;e++)if(c.namespace==a.dependencies[e])return 1;for(e=0;e<c.dependencies.length;e++)if(a.namespace==c.dependencies[e])return-1;return 0})}}return f.getModel(e)};d.alsoBehavesLike=function(a,c){("undefined"===typeof a||"undefined"===typeof c)&&d.error(Error("Cannot mixin with an undefined object"));
for(var e in c)if(c.hasOwnProperty(e)&&!(0==e.indexOf("_")||"initializer"===e))if("undefined"!==typeof a[e]){if("undefined"!==typeof c[e].prototype){if("undefined"!==typeof c[e].prototype.initializer&&!0==c[e].prototype.initializer)continue;var b="undefined"!==typeof c[e].prototype.virtual?c[e].prototype.virtual:!1}var k="undefined"!==typeof a[e].prototype?a[e].prototype.virtual:!1;if(!k||!b)k&&(a[e]=c[e])}else a[e]=c[e];"undefined"!==typeof c.prototype&&"undefined"!==typeof a.prototype&&d.alsoBehavesLike(a.prototype,
c.prototype)};d.error=function(a,c){if("undefined"!==typeof c&&"function"===typeof c.handleError)c.handleError(a);else if("function"===typeof d.handleError)d.handleError(a);else throw a;};var t=function(a){var c=16*Math.random()|0;return("x"==a?c:c&3|8).toString(16)};d.getGuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,t)};d.CONCEPT="concept";d.RELATIONSHIP="relationship";h.prototype._name="Proxy";f.prototype.relate=function(a){"undefined"===typeof this._relatesTo&&(this._relatesTo=
[]);for(var c=!1,e=0;e<this._relatesTo.length;e++)if(this._relatesTo[e]._id==a._id){c=!0;break}c||this._relatesTo.push(a)};g.prototype._name="Behavior";d.Behavior=g;c.prototype._name="Ontology";c.prototype.addTerm=function(a){if("undefined"!==typeof this[a])return this;this._term.prototype.relate=f.prototype.relate;var c=new this._term(a);this[a]=new h(c,this._inferencer);return this};c.prototype.addTerms=function(a){for(var c=0;c<a.length;c++)this.addTerm(a[c])};c.prototype.registerActivator=function(a,
c){"undefined"===typeof c&&(c=[]);null===d.typeMask(a,{fn:"function",namespace:!0,dependencies:!0})?this._activators.push(a):this._activators.push({fn:a,namespace:this.namespace,dependencies:c})};c.prototype.getModel=function(a){var c=new function(){return this},e=[];if("undefined"!==typeof a){e=e.concat(a);for(a=0;a<e.length;a++)if("undefined"===typeof e[a]&&d.error("One or more [behaviors] arguments were supplied to the smallmachine constructor that are 'undefined'; error creating object model"),
"undefined"!==typeof e[a].prototype&&!0===e[a].prototype.initializer)e[a](c)}for(var b in this)if(this.hasOwnProperty(b)&&!("undefined"===typeof this[b]||"undefined"===this[b]._term)&&0!==b.indexOf("_"))if("undefined"!==typeof this[b]._term){c[b]=this[b]._term;for(a=0;a<e.length;a++)d.alsoBehavesLike(Object.getPrototypeOf(c[b]),e[a].prototype)}else c[b]=this[b];this._inferencer._rules.sort(function(a,c){return a._priority-c._priority});for(a=0;a<this._inferencer._rules.length;a++)e=this._inferencer._rules[a],
e._fn.apply(c,e._args);for(a=0;a<this._activators.length;a++)this._activators[a].fn(c);return c};d.Ontology=c;var n=function(a,c,e){this._fn=c;this._args=e;this._priority=a;return this};a.prototype.isA=function(a){this._rules.push(new n(1,s,[this._term._value,a._term._value]));return this};a.prototype.relatesTo=function(a,c){this._rules.push(new n(10,k,[this._term._value,a._term._value,c._term._value]));return this};a.prototype.hasDomain=function(a){this._rules.push(new n(3,q,[this._term._value,a._term._value]));
return this};a.prototype.hasRange=function(a){this._rules.push(new n(2,m,[this._term._value,a._term._value]));return this};a.prototype.alsoBehavesLike=function(a){this._rules.push(new n(20,e,[this._term._value,a]));return this};d.alsoBehavesLike(h,a);d.typeMask=function(a,c){var e=[],b;for(b in c)c.hasOwnProperty(b)&&("undefined"===typeof a||"undefined"===typeof a[b]?e.push(b):"undefined"!==typeof a[b]&&typeof a[b]!==c[b]&&!0!==c[b]&&e.push(b));return 0===e.length?null:e};return d}(smallmachine||
{});(function(d){function b(){return this}function h(){return this}function f(a){this._channel=a;return this}function g(a,c,b){"undefined"===typeof c&&d.error(Error("Parameter 'key' is required when instantiating the sm.NamedValue type"));this.namespace=a;this.key=c;this.value=b;return this}function l(){this._collection={};return this}var c=new d.Ontology("sm.properties");c.addTerm("property");c.addTerm("type");c.addTerm("ontology");c.addTerm("behavior");c.addTerm("hasMemberType");c.addTerm("hasMember");
c.addTerm("Ontology");c.addTerm("Behavior");c.addTerm("Constructor");c.addTerm("Null");c.ontology.isA(c.property);c.behavior.isA(c.property);c.Ontology.isA(c.type);c.Behavior.isA(c.type);c.Constructor.isA(c.type);c.Null.isA(c.type);c.ontology.relatesTo(c.hasMemberType,c.Ontology);c.behavior.relatesTo(c.hasMemberType,c.Behavior);c.ontology.relatesTo(c.hasMember,c.Null);c.behavior.relatesTo(c.hasMember,c.Null);b.prototype.extendedBy=function(a,c){var b=this.hasMemberType;"undefined"===typeof c&&("undefined"===
b?c=a._name:"undefined"!==typeof a.prototype&&(c=a.prototype._name));if("undefined"!==typeof c&&"function"===typeof a)"undefined"!==typeof this[c]?d.alsoBehavesLike(this[c],a):this[c]=a,"undefined"===typeof this[c]._name&&(this[c]._name=c);else{var f=c||a.namespace||a._name;"undefined"===typeof f&&d.error(Error("Cannot call extendedBy on the core ontology with an object that is missing the 'namepsace' and '_name' properties without specifying a 'typeName'"));if("undefined"!==typeof this[f])d.alsoBehavesLike(this[f],
a);else{var h=d[this._value][b._value];"undefined"===typeof h&&d.error(Error("The specified type does not exist in the core object model: "+b._value));var b=a._name||a.constructor.name,g=!1,l;for(l in h)if(h.hasOwnProperty(l)&&0!==l.indexOf("_")&&l===b){this.hasMember[f]=a;this[f]=a;g=!0;break}g||d.error(Error("Did not find an allowed model type for: "+b))}}};h.prototype._name="Null";d.alsoBehavesLike(d,c.getModel(b));d.ontology.extendedBy(new h);d.behavior.extendedBy(new h);f.prototype._name="AsyncResult";
f.prototype.publish=function(a,c){this._channel.publish(a,c);return this};d.type.extendedBy(f);g.prototype.adapt=function(a,c){this.namespace=a;if("undefined"!==typeof c)for(var b=[].concat(c),f=0;f<b.length;f++)d.alsoBehavesLike(this,b[f]);return this};g.prototype._name="NamedValue";d.type.extendedBy(g);l.prototype._name="NamedValueCollection";l.prototype.exists=function(a,c){var b=a;null===d.typeMask(a,{namespace:!0,key:!0})&&(b=a.namespace,c=a.key);return"undefined"!==typeof this._collection[b]&&
"undefined"!==typeof this._collection[b][c]};l.prototype.add=function(a,c,b){var f=a.namespace||a,h=a.key||c;"undefined"!==typeof this._collection[f]&&"undefined"!==this._collection[f][h]&&d.error(Error("Cannot add a new entry to the collection (already exists): ["+f+"]"+h));this.modify(a,c,b);return this};l.prototype.modify=function(a,c,b){var f=a.namespace||a;c=a.key||c;a=a.value||b;"undefined"===typeof c&&d.error(Error("Must supply a valid key"));"undefined"===typeof a&&d.error(Error("Must supply a valid value"));
"undefined"===typeof this._collection[f]&&(this._collection[f]={});this._collection[f][c]=a;return this};l.prototype.remove=function(a,c){if(!("undefined"===typeof this._collection[a]||"undefined"===typeof this._collection[a][c]))return delete this._collection[a][c],this};l.prototype.getValue=function(a,c){var b=a.namespace||a,d=a.key||c;if(!("undefined"===typeof this._collection[b]||"undefined"===this._collection[b][d]))return b=this._collection[b][d],"undefined"!==typeof b&&("function"===typeof a.setValue?
a.setValue(b):"undefined"!==typeof a.value&&(a.value=b)),b};d.type.extendedBy(l)})(smallmachine);(function(d){var b=new d.Ontology("sm.channels");b.addTerm("thing");b.addTerm("user");b.addTerm("system");b.addTerm("action");b.addTerm("click");b.addTerm("doubleClick");b.addTerm("keyPress");b.addTerm("task");b.addTerm("initialize");b.addTerm("insert");b.addTerm("remove");b.addTerm("get");b.addTerm("set");b.addTerm("messenger");b.addTerm("success");b.addTerm("error");b.addTerm("performs");b.addTerm("reactsTo");b.user.isA(b.thing);b.user.relatesTo(b.performs,b.action);b.system.isA(b.thing);b.system.relatesTo(b.performs,
b.task);b.action.isA(b.thing);b.task.isA(b.thing);b.messenger.isA(b.thing);b.click.isA(b.action);b.doubleClick.isA(b.action);b.keyPress.isA(b.action);b.get.isA(b.task);b.set.isA(b.task);b.success.isA(b.messenger);b.error.isA(b.messenger);b.initialize.isA(b.task);b.insert.isA(b.task);b.remove.isA(b.task);b.performs.hasRange(b.action).hasRange(b.task);b.reactsTo.hasRange(b.action).hasDomain(b.system);b.registerActivator(function(b){function h(a,c){if("undefined"!==typeof jQuery)try{jQuery.ajax({dataType:"json",
url:a,type:"GET",success:function(h,g,m){b.messenger.success.publish(g);c.publish(new d.type.NamedValue("sm.channels",a,h))},error:function(a,c,b){d.error(Error(b))}})}catch(g){d.error(Error(g))}else{var m=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP.3.0");m.onprogress=function(){};m.onerror={};m.onreadystatechange=function(){4>m.readyState||(200==m.status?(b.messenger.success.publish(m.statusText),c.publish(new d.type.NamedValue("sm.channels",a,JSON.parse(m.responseText)))):
d.error(Error(m.statusText)))};m.open("GET",a,!0);m.setRequestHeader("X-Requested-With","XMLHttpRequest");m.setRequestHeader("Content-type","application/json");m.send(null)}return c}var l={update:function(a){return"undefined"!==typeof a.key&&"undefined"!==typeof a.namespace?function(a){b.memory.modify(a)}:!1}};d.alsoBehavesLike(b,{memory:new d.type.NamedValueCollection});b.set.subscribe({update:function(a){return l}});var c={update:function(a){return"undefined"!==typeof a.key&&"undefined"!==typeof a.namespace?
function(a){b.memory.getValue(a)}:!1}};b.get.subscribe({update:function(a){return c}});"function"===typeof b.initialize.addHelper&&b.initialize.addHelper("json",h);"function"===typeof b.set.addHelper&&b.set.addHelper("config",function(a){return new d.type.NamedValue("sm.channels","config",a)});if("function"===typeof b.get.addHelper){b.get.addHelper("json",h);var a=function(){this.namespace="sm.channels";this.key="config";return this};a.prototype._name="Config";a.prototype.setValue=function(a){d.alsoBehavesLike(this,
a)};d.type.extendedBy(a);b.get.addHelper("config",function(a){return a})}});try{d.ontology.extendedBy(b)}catch(h){d.error(Error("Could not extend the smallmachine.ontology property with the 'sm.channels' ontology: "+h.message+"\n"+h.stack))}})(smallmachine);(function(d){function b(b,d){this._value=b;this._type=d;return this}b.prototype._name="Channel";b.prototype.forward=function(b,d){null!=this._value&&(d[this._value]=!0);for(var g in this)if(this.hasOwnProperty(g)&&!("function"===typeof this[g]||0===g.indexOf("_"))&&!0!==d[g]&&"function"===typeof this[g].publish)d[g]=!0,this[g].publish(b,d);if("undefined"!==typeof this._relatesTo)for(g=0;g<this._relatesTo.length;g++)"undefined"!==typeof this._relatesTo[g]._subscribers&&this.notify(b,this._relatesTo[g]._subscribers)};
b.prototype.unsubscribe=function(b){"undefined"!==typeof this._subscribers&&delete this._subscribers[b]};b.prototype.subscribe=function(b){"undefined"===typeof this._subscribers&&(this._subscribers={});var f=d.getGuid();"function"===typeof b?this._subscribers[f]={update:b,lifetime:1}:("undefined"===typeof b.lifecycle&&(b.lifetime=1),this._subscribers[f]=b);return f};b.prototype.notify=function(b,f){var g=!1,l={},c=0,a=[],e;for(e in f){var k=f[e].update(b);"undefined"!==typeof f[e]&&(0>=f[e].lifetime&&
this.unsubscribe(e),!0===k?g=!0:"function"===typeof k?(a.push(k),g=!0):k&&"function"===typeof k.update&&(l[d.getGuid()]=k,c++))}if(g){e=0===a.length;for(k=0;k<a.length;k++)!1===!a[k](b)&&(e=!0);!1===e&&(g=!1)}!1==g&&0<c&&this.notify(b,l)};b.prototype.publish=function(b,f){f=f||{};if("function"===typeof b&&(b=b(new d.type.AsyncResult(this)),"undefined"!==typeof b&&"undefined"!==typeof b._channel&&"function"===typeof b.publish))return this;if("undefined"===typeof this._subscribers)return this.forward(b,
f),this;this.notify(b,this._subscribers);this.forward(b,f);return this};b.prototype.addHelper=function(d,f){var g=b.prototype.publish,l=this;this[d]=function(){for(var c=[],a=0;a<arguments.length;a++)c.push(arguments[a]);return g.apply(l,[function(a){c.push(a);return f.apply(l,c)}])};return this};d.behavior.extendedBy(b)})(smallmachine);(function(d,b){function h(d){"undefined"!==typeof b.fn&&b.extend({sm:d});return this}h.prototype._name="Extension";h.prototype.initializer=!0;d.behavior.extendedBy(h)})(smallmachine,jQuery||{});var Sammy="undefined"===typeof Sammy?{}:Sammy;
(function(d,b){function h(b){function d(){this._terms=[];this._terms[0]=[];this._rules=[];this._conflictStrategy=null}var h={equal:0,greaterThanOrEqual:1,greaterThan:2,lessThanOrEqual:-1,lessThan:-2};d.prototype._name="SearchModel";d.prototype._numberExists=function(c){for(var a=this._terms[0].length,b=0,d=a-1,a=Math.floor(a/2);d>=b;){var f=this._terms[0][a];if(c===f)return!0;c<f?d=a-1:b=a+1;a=Math.floor((b+d)/2)}return!1};d.prototype.addTerm=function(c){if("number"===typeof c)this._numberExists(c)||
(this._terms[0].push(c),this._terms[0].sort());else{var a=c.toString();c=a.length;if("undefined"===typeof this._terms[c])this._terms[c]=a;else if(!(-1<this._terms[c].indexOf(a))){for(var b=this._terms[c].length/c,a=[a],d=0;d<b;d++)a.push(this._terms[c].substring(d*c,d*c+c));a.sort();this._terms[c]=a.join("")}}};d.prototype.addRules=function(c){for(var a=0,b=c.length;a<b;a++)for(var d=0,f=c[a].terms.length;d<f;d++){var g=c[a].terms[d];this.addTerm(g)}a=0;for(b=c.length;a<b;a++){for(var q=[],f=c[a].terms.length,
t=0,d=0;d<f;d++){var g=c[a].terms[d],n=this.getTermId(g),g=n[0],r=n[1];g>t&&(t=g);"undefined"===typeof q[g]&&(q[g]=[]);q[g][r]=n;"undefined"!==typeof c[a].operators&&"undefined"!=typeof c[a].operators[d]?(n=h[c[a].operators[d].toString()],q[g][r][2]="undefined"!==typeof n?n:c[a].operators[d]):q[g][r][2]=0}q[t+1]=f;q[t+2]=c[a].action;this._rules.push(q)}};d.prototype.getNumberId=function(c){for(var a=this._terms[0].length,b=0,d=a-1,a=Math.floor(a/2);d>=b;){var f=this._terms[0][a];if(c===f)return[0,
a];c<f?d=a-1:b=a+1;a=Math.floor((b+d)/2)}return!1};d.prototype.getTermId=function(c){if("number"===typeof c)return this.getNumberId(c);c=c.toString();var a=c.length;if(!this._terms[a])return!1;for(var b=this._terms[a].length/a,d=0,f=b-1,b=Math.floor(b/2);f>=d;){var h=a*b,g=this._terms[a].substr(h,a);if(c===g)return[a,h/a];c<g?f=b-1:d=b+1;b=Math.floor((d+f)/2)}return!1};d.prototype.isEqualTermId=function(c,a){if(!c||!a||c.length!==a.length)return!1;for(var b=0;b<c.length;b++)if(c[b]!==a[b])return!1;
return!0};d.prototype.executeQuery=function(c){for(var a=[],b=[],d=0,f=c.length;d<f;d++)for(var h=this.getTermId(c[d]),g=0,l=this._rules.length;g<l;g++){if("undefined"===typeof a[g])a[g]=0;else if(!1===a[g])continue;var n=h[1],r=this._rules[g][h[0]];"undefined"===typeof r||"undefined"===typeof r[n]||!(r[n]instanceof Array)?a[g]=!1:a[g]++}d=0;for(c=a.length;d<c;d++)f=this._rules[d].length,a[d]===this._rules[d][f-2]&&b.push(this._rules[d][f-1]);"function"===typeof this._conflictStrategy&&this._conflictStrategy(b);
return b};this.searchModel=new d;b={addDataModel:function(b){"undefined"!==typeof b._terms&&0<b._terms.length&&"undefined"!==typeof b._rules&&0<b._rules.length?(this.searchModel._terms=b._terms,this.searchModel._rules=b._rules):this.searchModel.addRules(b.rules);this.searchModel._conflictStrategy=b.conflictStrategy},isEqualTermId:function(b,a){return this.searchModel.isEqualTermId(b,a)},getNumberId:function(b){return this.searchModel.getNumberId(b)},getTermId:function(b){return this.searchModel.getTermId(b)},
executeQuery:function(b){return this.searchModel.executeQuery(b)}};"function"===typeof this.helpers?this.helpers(b):(this.addDataModel=b.addDataModel,this.getTermId=b.getTermId,this.getNumberId=b.getNumberId,this.isEqualTermId=b.isEqualTermId,this.executeQuery=b.executeQuery)}h.prototype._name="StateQueryModel";d.type.extendedBy(h)})(smallmachine,Sammy);
