var smallmachine=function(e){"function"!==typeof Object.getPrototypeOf&&(Object.getPrototypeOf="object"===typeof"test".__proto__?function(a){return a.__proto__}:function(a){return a.constructor.prototype});e=function(a,g){if("undefined"===typeof a)throw Error("Missing required parameter for smallmachine constructor: one or more instances of type [object Ontology]");var c=[].concat(a);if(1===c.length)return c[0].getModel(g);for(var d=new e.Ontology(c[0].title),b=0;b<c.length;b++){for(var f in c[b])c[b].hasOwnProperty(f)&&
"function"===typeof c[b][f].ofType&&c[b][f].ofType("Proxy")&&d.addTerm(c[b][f]._term._value);for(var k=0;k<c[b]._inferencer._rules.length;k++)d._inferencer._rules.push(c[b]._inferencer._rules[k]);for(k=0;k<c[b]._activators.length;k++)d.registerActivator(c[b]._activators[k])}return d.getModel(g)};e.alsoBehavesLike=function(a,g){for(var c in g)if(g.hasOwnProperty(c)&&0!=c.indexOf("_"))if("undefined"!==typeof a[c]){var d="undefined"!==typeof a[c].prototype?a[c].prototype.virtual:!1,b="undefined"!==typeof g[c].prototype?
g[c].prototype.virtual:!1;if(!d||!b)d&&(a[c]=g[c])}else a[c]=g[c];"undefined"!==typeof g.prototype&&("undefined"===typeof a.prototype&&(a.prototype={}),e.alsoBehavesLike(a.prototype,g.prototype))};e.CONCEPT="concept";e.RELATIONSHIP="relationship";var a=function(a,g){this._term=a;this._rules=g._rules;return this};a.prototype.getType=function(){return"[object Proxy]"};a.prototype.ofType=function(a){return"Proxy"===a||"function"===typeof a.getType&&a.getType()===this.getType()};var b=function(){return this};
b.prototype.relate=function(a){"undefined"===typeof this._relatesTo&&(this._relatesTo=[]);for(var g=!1,c=0;c<this._relatesTo.length;c++)if(this._relatesTo[c]._id==a._id){g=!0;break}g||this._relatesTo.push(a)};b.prototype.getType=function(){return"[object Term]"};b.prototype.ofType=function(a){return"Term"===a||"function"===typeof a.getType&&a.getType()===this.getType()};e.Behavior=function(a){this.title=a;return this};e.Ontology=function(a){this.title=a;this._inferencer=new f;this._activators=[];
this._term=function(a){this._id=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var m=16*Math.random()|0;return("x"==a?m:m&3|8).toString(16)})}();"undefined"!==typeof a._value&&"undefined"!==typeof a._type?(this._value=a._value,this._type=a._type):(this._value=a,this._type=null);return this};return this};e.Ontology.prototype.getType=function(){return"[object Ontology]"};e.Ontology.prototype.addTerm=function(m){if("undefined"!==typeof this[m])return this;var g=this._term;
g.prototype.relate=b.prototype.relate;g.prototype.getType=b.prototype.getType;g.prototype.ofType=b.prototype.ofType;g=new g(m);this[m]=new a(g,this._inferencer);return this};e.Ontology.prototype.registerActivator=function(a){this._activators.push(a)};e.Ontology.prototype.getModel=function(a){var g=new function(a){return this},c;for(c in this)if(this.hasOwnProperty(c)&&!("undefined"===typeof this[c]||"undefined"===this[c]._term)&&0!==c.indexOf("_"))"undefined"!==typeof this[c]._term?(g[c]=this[c]._term,
"undefined"!==typeof a&&e.alsoBehavesLike(Object.getPrototypeOf(g[c]),a.prototype)):g[c]=this[c];this._inferencer._rules.sort(function(a,c){return a._priority-c._priority});for(a=0;a<this._inferencer._rules.length;a++)c=this._inferencer._rules[a],c._fn.apply(g,c._args);for(a=0;a<this._activators.length;a++)this._activators[a](g);return g};var f=function(){this._term={_value:null};this._rules=[];return this},d=function(a,g,c){this._fn=g;this._args=c;this._priority=a;return this};f.prototype.isA=function(a){this._rules.push(new d(1,
n,[this._term._value,a._term._value]));return this};f.prototype.relatesTo=function(a,g){this._rules.push(new d(10,k,[this._term._value,a._term._value,g._term._value]));return this};f.prototype.hasDomain=function(a){this._rules.push(new d(3,h,[this._term._value,a._term._value]));return this};f.prototype.hasRange=function(a){this._rules.push(new d(2,l,[this._term._value,a._term._value]));return this};e.alsoBehavesLike(a,f);var k=function(a,g,c){a=this[a];var d=this[g],b=this[c];if(d._type===e.CONCEPT)throw Error("Cannot define a relationship with a concept type: "+
d._value);null===d._type&&(d._type=e.RELATIONSHIP);if(b._type===e.RELATIONSHIP)throw Error("Cannot create a relationship with a relationship type: "+b._value);null===b._type&&(b._type=e.CONCEPT);if(a._type===e.RELATIONSHIP)throw Error("Cannot create a relationship from a relationship type: "+a._value);null===a._type&&(a._type=e.CONCEPT);"undefined"===typeof a[g]&&(a[g]=new a.constructor(d));"undefined"===typeof a[g][c]&&(a[g][c]=b);"undefined"===typeof a[c]&&(a[c]=b);b.relate(a[g]);for(var f in b)b.hasOwnProperty(f)&&
(b[f].getType&&"[object Term]"===b[f].getType())&&("undefined"===typeof a[g][f]&&(a[g][f]=b[f]),"undefined"===typeof a[f]&&(a[f]=b[f]),b[f].relate(a[g]))},n=function(a,b){var c=this[a],d=this[b];if(d._type===e.RELATIONSHIP)throw Error("Cannot apply isA to a relationship type: "+d._value);null===d._type&&(d._type=e.CONCEPT);if(c._type===e.RELATIONSHIP)throw Error("Cannot apply isA to a relationship type: "+c._value);null===c._type&&(c._type=e.CONCEPT);"undefined"===typeof d[a]&&(d[a]=c)},l=function(a,
b){var c=this[a],d=this[b];if(d._type===e.RELATIONSHIP)throw Error("Cannot apply hasRange to a relationship type: "+d._value);null===d._type&&(d._type=e.CONCEPT);if(c._type===e.CONCEPT)throw Error("Cannot assign hasRange from a concept type: "+c._value);null===c._type&&(c._type=e.RELATIONSHIP);"undefined"===typeof c[b]&&(c[b]=d);d.relate(c);for(var f in d)if(d.hasOwnProperty(f)&&d[f].getType&&"[object Term]"===d[f].getType()){var k=d[f]._value;"undefined"===typeof c[k]&&(c[k]=d[f]);d[f].relate(c)}},
h=function(a,d){var c=this[a],b=this[d];if(b._type===e.RELATIONSIP)throw Error("Cannot apply hasRange to a relationship type: "+b._value);null===b._type&&(b._type=e.CONCEPT);if(c._type===e.CONCEPT)throw Error("Cannot assign hasRange from a concept type: "+c._value);null===c._type&&(c._type=e.RELATIONSHIP);"undefined"===typeof b[a]&&(b[a]=c)};return e}(smallmachine||{});(function(e){var a=new e.Ontology("sm.properties");a.addTerm("property");a.addTerm("type");a.addTerm("ontology");a.addTerm("behavior");a.addTerm("hasMemberType");a.addTerm("hasMember");a.addTerm("Ontology");a.addTerm("Behavior");a.addTerm("Constructor");a.addTerm("Null");a.ontology.isA(a.property);a.behavior.isA(a.property);a.Ontology.isA(a.type);a.Behavior.isA(a.type);a.Constructor.isA(a.type);a.Null.isA(a.type);a.ontology.relatesTo(a.hasMemberType,a.Ontology);a.behavior.relatesTo(a.hasMemberType,
a.Behavior);a.ontology.relatesTo(a.hasMember,a.Null);a.behavior.relatesTo(a.hasMember,a.Null);var b=function(){return this};b.prototype.extendedBy=function(a,b){if("undefined"!==typeof b&&"function"===typeof a)"undefined"!==typeof this[b]?e.alsoBehavesLike(this[b],a):this[b]=a,"function"!==typeof this[b].prototype.getType&&(this[b].prototype.getType=function(){return"[object "+b+"]"}),"function"!==typeof this[b].prototype.ofType&&(this[b].prototype.ofType=function(a){return"function"===typeof a.getType?
this.getType()===a.getType():this.getType()==="[object "+a+"]"});else{if("undefined"===typeof a.title)throw Error("Cannot extendedBy the core ontology with model that is missing the 'title' property");if("undefined"!==typeof this[a.title])e.alsoBehavesLike(this[a.title],a);else{var f=this.hasMemberType;if("undefined"===typeof f||"undefined"===typeof f.getType)throw Error("The specified concept does not have a valid 'hasMemberType' relationship with another concept");var l=e[this._value][f._value];
if("undefined"===typeof l)throw Error("The specified type does not exist in the core object model: "+f._value);if("function"!==typeof a.getType)throw Error("The specified model is missing the getType function: "+a.title);var f=a.getType(),h=!1,m;for(m in l)if(l.hasOwnProperty(m)&&"undefined"!==typeof this[m].getType&&"[object "+m+"]"===f){this.hasMember[a.title]=a;this[a.title]=a;h=!0;break}if(!h)throw Error("Did not find an allowed model type for: "+f);}}};var f=function(){this.title="Null";return this};
f.prototype.getType=function(){return"[object Null]"};f.prototype.ofType=function(a){return null===a||"null"===a||"Null"===a?!0:!1};e.alsoBehavesLike(e,a.getModel(b));e.ontology.extendedBy(new f);e.behavior.extendedBy(new f);a=function(a){this._channel=a;return this};a.prototype.publish=function(a,b){this._channel.publish(a,b);return this};e.type.extendedBy(a,"AsyncResult")})(smallmachine);(function(e){var a=new e.Ontology("sm.channels");a.addTerm("thing");a.addTerm("user");a.addTerm("system");a.addTerm("action");a.addTerm("click");a.addTerm("doubleClick");a.addTerm("keyPress");a.addTerm("task");a.addTerm("initialize");a.addTerm("insert");a.addTerm("remove");a.addTerm("get");a.addTerm("set");a.addTerm("messenger");a.addTerm("success");a.addTerm("error");a.addTerm("performs");a.addTerm("reactsTo");a.user.isA(a.thing);a.user.relatesTo(a.performs,a.action);a.system.isA(a.thing);a.system.relatesTo(a.performs,
a.task);a.action.isA(a.thing);a.task.isA(a.thing);a.messenger.isA(a.thing);a.click.isA(a.action);a.doubleClick.isA(a.action);a.keyPress.isA(a.action);a.get.isA(a.task);a.set.isA(a.task);a.success.isA(a.messenger);a.error.isA(a.messenger);a.initialize.isA(a.task);a.insert.isA(a.task);a.remove.isA(a.task);a.performs.hasRange(a.action).hasRange(a.task);a.reactsTo.hasRange(a.action).hasDomain(a.system);a.registerActivator(function(a){var b=function(b,d){if("undefined"!==typeof jQuery)try{jQuery.ajax({dataType:"json",
url:b,type:"GET",success:function(b,e,c){a.messenger.success.publish(e);d.publish(b)},error:function(b,d,c){a.messenger.error.publish(c)}})}catch(e){a.messenger.error.publish(e)}else{var h=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP.3.0");h.onprogress=function(){};h.onerror={};h.onreadystatechange=function(){4>h.readyState||(200==h.status?(a.messenger.success.publish(h.statusText),d.publish(JSON.parse(h.responseText))):a.messenger.error.publish(h.statusText))};h.open("GET",
b,!0);h.setRequestHeader("X-Requested-With","XMLHttpRequest");h.setRequestHeader("Content-type","application/json");h.send(null)}return d};"undefined"!==typeof a.initialize&&"undefined"!==typeof a.initialize.addHelper&&a.initialize.addHelper("json",b);e.type.extendedBy(function(a,b){this.target=a;this.context=b;return this},"Hook");b=function(a,b,d){return new e.type.Hook(a,b)};"undefined"!==typeof a.insert&&"undefined"!==typeof a.insert.addHelper&&a.insert.addHelper("hook",b)});try{e.ontology.extendedBy(a)}catch(b){throw Error("Could not extend the smallmachine.ontology property with the 'sm.channels' ontology: "+
b.message+"\n"+b.stack);}})(smallmachine);(function(e){var a=function(a,f){this._value=a;this._type=f;return this};a.prototype.forward=function(a,f){null!=this._value&&(f[this._value]=!0);for(var d in this)if(this.hasOwnProperty(d)&&!("function"===typeof this[d]||0===d.indexOf("_"))&&!0!==f[d]&&"function"===typeof this[d].publish)f[d]=!0,this[d].publish(a,f);if("undefined"!==typeof this._relatesTo)for(d=0;d<this._relatesTo.length;d++)"undefined"!==typeof this._relatesTo[d]._subscribers&&this.notify(a,this._relatesTo[d]._subscribers)};a.prototype.subscribe=
function(a){"undefined"===typeof this._subscribers&&(this._subscribers=[]);if("function"===typeof a)return this._subscribers.push({update:a}),this;this._subscribers.push(a);return this};a.prototype.notify=function(a,f){for(var d=!1,e=[],n=[],l=0;l<f.length;l++){var h=f[l].update(a);!0===h?d=!0:"function"===typeof h?(n.push(h),d=!0):"object"===typeof h&&"function"===typeof h.update&&e.push(h)}if(d)for(l=0;l<n.length;l++)n[l](a);else 0<e.length&&this.notify(a,e)};a.prototype.publish=function(a,f){f=
f||{};if("function"===typeof a&&(a=a(new e.type.AsyncResult(this)),"undefined"!==typeof a&&"function"===typeof a.getType&&"[object AsyncResult]"===a.getType()))return this;if("undefined"===typeof this._subscribers)return this.forward(a,f),this;this.notify(a,this._subscribers);this.forward(a,f);return this};a.prototype.addHelper=function(b,e){var d=a.prototype.publish,k=this;this[b]=function(){for(var a=[],b=0;b<arguments.length;b++)a.push(arguments[b]);return d.apply(k,[function(b){a.push(b);return e.apply(k,
a)}])};return this};a.prototype.getType=function(){return"[object Channel]"};a.prototype.ofType=function(a){return"Channel"===a||"function"===typeof a.getType&&a.getType()===this.getType()};e.behavior.extendedBy(a,"Channel")})(smallmachine);
