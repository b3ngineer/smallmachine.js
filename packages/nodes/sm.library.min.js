var smallmachine=function(e){"function"!==typeof Object.getPrototypeOf&&(Object.getPrototypeOf="object"===typeof"test".__proto__?function(a){return a.__proto__}:function(a){return a.constructor.prototype});e=function(a,c){if("undefined"===typeof a)throw Error("Missing required parameter for smallmachine constructor: one or more instances of type [object Ontology]");var d=[].concat(a);if(1===d.length)return d[0].getModel(c);for(var f=new e.Ontology(d[0].title),b=0;b<d.length;b++){for(var g in d[b])d[b].hasOwnProperty(g)&&
"function"===typeof d[b][g].ofType&&d[b][g].ofType("Proxy")&&f.addTerm(d[b][g]._term._value);for(var h=0;h<d[b]._inferencer._rules.length;h++)f._inferencer._rules.push(d[b]._inferencer._rules[h]);for(h=0;h<d[b]._activators.length;h++)f.registerActivator(d[b]._activators[h])}return f.getModel(c)};e.alsoBehavesLike=function(a,c){for(var d in c)if(c.hasOwnProperty(d)&&0!=d.indexOf("_"))if("undefined"!==typeof a[d]){var b="undefined"!==typeof a[d].prototype?a[d].prototype.virtual:!1,f="undefined"!==typeof c[d].prototype?
c[d].prototype.virtual:!1;if(!b||!f)b&&(a[d]=c[d])}else a[d]=c[d];"undefined"!==typeof c.prototype&&("undefined"===typeof a.prototype&&(a.prototype={}),e.alsoBehavesLike(a.prototype,c.prototype))};e.CONCEPT="concept";e.RELATIONSHIP="relationship";var a=function(a,c){this._term=a;this._rules=c._rules;return this};a.prototype.getType=function(){return"[object Proxy]"};a.prototype.ofType=function(a){return"Proxy"===a||"function"===typeof a.getType&&a.getType()===this.getType()};var g=function(){return this};
g.prototype.relate=function(a){"undefined"===typeof this._relatesTo&&(this._relatesTo=[]);for(var c=!1,d=0;d<this._relatesTo.length;d++)if(this._relatesTo[d]._id==a._id){c=!0;break}c||this._relatesTo.push(a)};g.prototype.getType=function(){return"[object Term]"};g.prototype.ofType=function(a){return"Term"===a||"function"===typeof a.getType&&a.getType()===this.getType()};e.Behavior=function(a){this.title=a;return this};e.Ontology=function(a){this.title=a;this._inferencer=new b;this._activators=[];
this._term=function(a){this._id=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var c=16*Math.random()|0;return("x"==a?c:c&3|8).toString(16)})}();"undefined"!==typeof a._value&&"undefined"!==typeof a._type?(this._value=a._value,this._type=a._type):(this._value=a,this._type=null);return this};return this};e.Ontology.prototype.getType=function(){return"[object Ontology]"};e.Ontology.prototype.addTerm=function(c){if("undefined"!==typeof this[c])return this;var b=this._term;
b.prototype.relate=g.prototype.relate;b.prototype.getType=g.prototype.getType;b.prototype.ofType=g.prototype.ofType;b=new b(c);this[c]=new a(b,this._inferencer);return this};e.Ontology.prototype.registerActivator=function(a){this._activators.push(a)};e.Ontology.prototype.getModel=function(a){var c=new function(a){return this},d;for(d in this)if(this.hasOwnProperty(d)&&!("undefined"===typeof this[d]||"undefined"===this[d]._term)&&0!==d.indexOf("_"))"undefined"!==typeof this[d]._term?(c[d]=this[d]._term,
"undefined"!==typeof a&&e.alsoBehavesLike(Object.getPrototypeOf(c[d]),a.prototype)):c[d]=this[d];this._inferencer._rules.sort(function(a,c){return a._priority-c._priority});for(a=0;a<this._inferencer._rules.length;a++)d=this._inferencer._rules[a],d._fn.apply(c,d._args);for(a=0;a<this._activators.length;a++)this._activators[a](c);return c};var b=function(){this._term={_value:null};this._rules=[];return this},c=function(a,c,d){this._fn=c;this._args=d;this._priority=a;return this};b.prototype.isA=function(a){this._rules.push(new c(1,
h,[this._term._value,a._term._value]));return this};b.prototype.relatesTo=function(a,b){this._rules.push(new c(10,f,[this._term._value,a._term._value,b._term._value]));return this};b.prototype.hasDomain=function(a){this._rules.push(new c(3,k,[this._term._value,a._term._value]));return this};b.prototype.hasRange=function(a){this._rules.push(new c(2,l,[this._term._value,a._term._value]));return this};e.alsoBehavesLike(a,b);var f=function(a,c,d){a=this[a];var b=this[c],f=this[d];if(b._type===e.CONCEPT)throw Error("Cannot define a relationship with a concept type: "+
b._value);null===b._type&&(b._type=e.RELATIONSHIP);if(f._type===e.RELATIONSHIP)throw Error("Cannot create a relationship with a relationship type: "+f._value);null===f._type&&(f._type=e.CONCEPT);if(a._type===e.RELATIONSHIP)throw Error("Cannot create a relationship from a relationship type: "+a._value);null===a._type&&(a._type=e.CONCEPT);"undefined"===typeof a[c]&&(a[c]=new a.constructor(b));"undefined"===typeof a[c][d]&&(a[c][d]=f);"undefined"===typeof a[d]&&(a[d]=f);f.relate(a[c]);for(var h in f)f.hasOwnProperty(h)&&
(f[h].getType&&"[object Term]"===f[h].getType())&&("undefined"===typeof a[c][h]&&(a[c][h]=f[h]),"undefined"===typeof a[h]&&(a[h]=f[h]),f[h].relate(a[c]))},h=function(a,c){var d=this[a],b=this[c];if(b._type===e.RELATIONSHIP)throw Error("Cannot apply isA to a relationship type: "+b._value);null===b._type&&(b._type=e.CONCEPT);if(d._type===e.RELATIONSHIP)throw Error("Cannot apply isA to a relationship type: "+d._value);null===d._type&&(d._type=e.CONCEPT);"undefined"===typeof b[a]&&(b[a]=d)},l=function(a,
c){var d=this[a],b=this[c];if(b._type===e.RELATIONSHIP)throw Error("Cannot apply hasRange to a relationship type: "+b._value);null===b._type&&(b._type=e.CONCEPT);if(d._type===e.CONCEPT)throw Error("Cannot assign hasRange from a concept type: "+d._value);null===d._type&&(d._type=e.RELATIONSHIP);"undefined"===typeof d[c]&&(d[c]=b);b.relate(d);for(var f in b)if(b.hasOwnProperty(f)&&b[f].getType&&"[object Term]"===b[f].getType()){var h=b[f]._value;"undefined"===typeof d[h]&&(d[h]=b[f]);b[f].relate(d)}},
k=function(a,c){var b=this[a],f=this[c];if(f._type===e.RELATIONSIP)throw Error("Cannot apply hasRange to a relationship type: "+f._value);null===f._type&&(f._type=e.CONCEPT);if(b._type===e.CONCEPT)throw Error("Cannot assign hasRange from a concept type: "+b._value);null===b._type&&(b._type=e.RELATIONSHIP);"undefined"===typeof f[a]&&(f[a]=b)};return e}(smallmachine||{});(function(e){var a=new e.Ontology("sm.properties");a.addTerm("property");a.addTerm("type");a.addTerm("ontology");a.addTerm("behavior");a.addTerm("hasMemberType");a.addTerm("hasMember");a.addTerm("Ontology");a.addTerm("Behavior");a.addTerm("Constructor");a.addTerm("Null");a.ontology.isA(a.property);a.behavior.isA(a.property);a.Ontology.isA(a.type);a.Behavior.isA(a.type);a.Constructor.isA(a.type);a.Null.isA(a.type);a.ontology.relatesTo(a.hasMemberType,a.Ontology);a.behavior.relatesTo(a.hasMemberType,
a.Behavior);a.ontology.relatesTo(a.hasMember,a.Null);a.behavior.relatesTo(a.hasMember,a.Null);var g=function(){return this};g.prototype.extendedBy=function(a,b){if("undefined"!==typeof b&&"function"===typeof a)"undefined"!==typeof this[b]?e.alsoBehavesLike(this[b],a):this[b]=a,"function"!==typeof this[b].prototype.getType&&(this[b].prototype.getType=function(){return"[object "+b+"]"}),"function"!==typeof this[b].prototype.ofType&&(this[b].prototype.ofType=function(a){return"function"===typeof a.getType?
this.getType()===a.getType():this.getType()==="[object "+a+"]"});else{if("undefined"===typeof a.title)throw Error("Cannot extendedBy the core ontology with model that is missing the 'title' property");if("undefined"!==typeof this[a.title])e.alsoBehavesLike(this[a.title],a);else{var h=this.hasMemberType;if("undefined"===typeof h||"undefined"===typeof h.getType)throw Error("The specified concept does not have a valid 'hasMemberType' relationship with another concept");var g=e[this._value][h._value];
if("undefined"===typeof g)throw Error("The specified type does not exist in the core object model: "+h._value);if("function"!==typeof a.getType)throw Error("The specified model is missing the getType function: "+a.title);var h=a.getType(),k=!1,m;for(m in g)if(g.hasOwnProperty(m)&&"undefined"!==typeof this[m].getType&&"[object "+m+"]"===h){this.hasMember[a.title]=a;this[a.title]=a;k=!0;break}if(!k)throw Error("Did not find an allowed model type for: "+h);}}};var b=function(){this.title="Null";return this};
b.prototype.getType=function(){return"[object Null]"};b.prototype.ofType=function(a){return null===a||"null"===a||"Null"===a?!0:!1};e.alsoBehavesLike(e,a.getModel(g));e.ontology.extendedBy(new b);e.behavior.extendedBy(new b);a=function(a){this._channel=a;return this};a.prototype.publish=function(a,b){this._channel.publish(a,b);return this};e.type.extendedBy(a,"AsyncResult")})(smallmachine);(function(e){var a=new e.Ontology("sm.channels");a.addTerm("thing");a.addTerm("user");a.addTerm("system");a.addTerm("action");a.addTerm("click");a.addTerm("doubleClick");a.addTerm("keyPress");a.addTerm("task");a.addTerm("initialize");a.addTerm("insert");a.addTerm("remove");a.addTerm("get");a.addTerm("set");a.addTerm("messenger");a.addTerm("success");a.addTerm("error");a.addTerm("performs");a.addTerm("reactsTo");a.user.isA(a.thing);a.user.relatesTo(a.performs,a.action);a.system.isA(a.thing);a.system.relatesTo(a.performs,
a.task);a.action.isA(a.thing);a.task.isA(a.thing);a.messenger.isA(a.thing);a.click.isA(a.action);a.doubleClick.isA(a.action);a.keyPress.isA(a.action);a.get.isA(a.task);a.set.isA(a.task);a.success.isA(a.messenger);a.error.isA(a.messenger);a.initialize.isA(a.task);a.insert.isA(a.task);a.remove.isA(a.task);a.performs.hasRange(a.action).hasRange(a.task);a.reactsTo.hasRange(a.action).hasDomain(a.system);a.registerActivator(function(a){var c=function(c,h){if("undefined"!==typeof jQuery)try{jQuery.ajax({dataType:"json",
url:c,type:"GET",success:function(c,f,d){a.messenger.success.publish(f);h.publish(c)},error:function(c,f,d){a.messenger.error.publish(d)}})}catch(e){a.messenger.error.publish(e)}else{var g=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP.3.0");g.onprogress=function(){};g.onerror={};g.onreadystatechange=function(){4>g.readyState||(200==g.status?(a.messenger.success.publish(g.statusText),h.publish(JSON.parse(g.responseText))):a.messenger.error.publish(g.statusText))};g.open("GET",
c,!0);g.setRequestHeader("X-Requested-With","XMLHttpRequest");g.setRequestHeader("Content-type","application/json");g.send(null)}return h};"undefined"!==typeof a.initialize&&"undefined"!==typeof a.initialize.addHelper&&a.initialize.addHelper("json",c);e.type.extendedBy(function(a,c){this.target=a;this.context=c;return this},"Hook");c=function(a,c,b){return new e.type.Hook(a,c)};"undefined"!==typeof a.insert&&"undefined"!==typeof a.insert.addHelper&&a.insert.addHelper("hook",c)});try{e.ontology.extendedBy(a)}catch(g){throw Error("Could not extend the smallmachine.ontology property with the 'sm.channels' ontology: "+
g.message+"\n"+g.stack);}})(smallmachine);(function(e){var a=function(a,b){this._value=a;this._type=b;return this};a.prototype.forward=function(a,b){null!=this._value&&(b[this._value]=!0);for(var c in this)if(this.hasOwnProperty(c)&&!("function"===typeof this[c]||0===c.indexOf("_"))&&!0!==b[c]&&"function"===typeof this[c].publish)b[c]=!0,this[c].publish(a,b);if("undefined"!==typeof this._relatesTo)for(c=0;c<this._relatesTo.length;c++)"undefined"!==typeof this._relatesTo[c]._subscribers&&this.notify(a,this._relatesTo[c]._subscribers)};a.prototype.subscribe=
function(a){"undefined"===typeof this._subscribers&&(this._subscribers=[]);if("function"===typeof a)return this._subscribers.push({update:a}),this;this._subscribers.push(a);return this};a.prototype.notify=function(a,b){for(var c=!1,f=[],e=[],l=0;l<b.length;l++){var k=b[l].update(a);!0===k?c=!0:"function"===typeof k?(e.push(k),c=!0):"object"===typeof k&&"function"===typeof k.update&&f.push(k)}if(c)for(l=0;l<e.length;l++)e[l](a);else 0<f.length&&this.notify(a,f)};a.prototype.publish=function(a,b){b=
b||{};if("function"===typeof a&&(a=a(new e.type.AsyncResult(this)),"undefined"!==typeof a&&"function"===typeof a.getType&&"[object AsyncResult]"===a.getType()))return this;if("undefined"===typeof this._subscribers)return this.forward(a,b),this;this.notify(a,this._subscribers);this.forward(a,b);return this};a.prototype.addHelper=function(e,b){var c=a.prototype.publish,f=this;this[e]=function(){for(var a=[],e=0;e<arguments.length;e++)a.push(arguments[e]);return c.apply(f,[function(c){a.push(c);return b.apply(f,
a)}])};return this};a.prototype.getType=function(){return"[object Channel]"};a.prototype.ofType=function(a){return"Channel"===a||"function"===typeof a.getType&&a.getType()===this.getType()};e.behavior.extendedBy(a,"Channel")})(smallmachine);(function(e,a,g){var b=function(a){this.id=a.id||function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var c=16*Math.random()|0;return("x"==a?c:c&3|8).toString(16)})}();this.width=parseFloat(a.width)||50;this.height=parseFloat(a.height)||50;this.y=parseFloat(a.y);this.x=parseFloat(a.x);this.edges=a.edges||[];this.label=a.label||this.id;return this};b.prototype.update=function(a){var b=a.context.circle(this.x,this.y,this.width/2,this.height/2);b.id=this.id;b.attr({fill:"#ffffff"});
a.context.text(this.x,this.y,this.label);return!0};e.type.extendedBy(b,"Node");b=function(a,b,e){this.id1=a.id;this.id2=b.id;this.x1=parseFloat(a.x);this.y1=parseFloat(a.y);this.x2=parseFloat(b.x);this.y2=parseFloat(b.y);this.label=a.edges[e].label||"";return this};b.prototype.update=function(a){a.context.path(["M",this.x1,this.y1,"L",this.x2,this.y2]);var b=parseFloat(this.x1),e=parseFloat(this.y1),g=parseFloat(this.x2),k=parseFloat(this.y2);a=a.context.text((b+g)/2,(e+k)/2-6,this.label);b=180*Math.atan2(k-
e,g-b)/Math.PI;a.transform("r"+b)};e.type.extendedBy(b,"Edge");e.type.extendedBy(function(b){if("sm.channels"!==b.title)throw Error("The sm.Bones functionality requires a model from the sm.channels ontology");b.system.insert.subscribe({update:function(a){if("function"!==typeof a.ofType||!a.ofType("Hook"))return!1;if("function"===typeof a.target.update)return a.target}});b.system.initialize.subscribe({update:function(f){return function(f){for(var l=a(window).width(),k=a(window).height(),l=g("paper",
l,k),k=0;k<f.length;k++){for(var m=new e.type.Node(f[k]),n=0;n<m.edges.length;n++){var d;a:{if("undefined"===typeof f.length)throw Error("Cannot determine the message type; expecting an array of node objects but received "+f);for(d=0;d<f.length;d++)if(f[d].id===m.edges[n].id){d=f[d];break a}d=null}null!==d&&(d=new e.type.Edge(m,d,n),b.system.insert.publish(new e.type.Hook(d,l)))}b.system.insert.publish(new e.type.Hook(m,l))}}}});return this},"Nodes")})(smallmachine,jQuery,Raphael);
