var smallmachine=function(e){function b(a,c){for(var f=0;f<c.dependencies.length;f++){for(var e=!1,d=0;d<a.length;d++)if(c.dependencies[f]==a[d].namespace){e=!0;break}if(!e)return c.dependencies[f]}return null}function k(a,c){this._term=a;this._rules=c._rules;return this}function g(){return this}function h(){return this}function m(a){this._id=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var c=16*Math.random()|0;return("x"==a?c:c&3|8).toString(16)})}();"undefined"!==
typeof a._value&&"undefined"!==typeof a._type?(this._value=a._value,this._type=a._type):(this._value=a,this._type=null);return this}function a(a){this.namespace=a;this._inferencer=new f;this._activators=[];this._term=m;return this}function f(){this._term={_value:null};this._rules=[];return this}function c(a,c){var f=this[a];"function"===typeof c?e.alsoBehavesLike(f,c.prototype):e.alsoBehavesLike(f,c);for(var d in f)f.hasOwnProperty(d)&&0!==d.indexOf("_")&&"undefined"!==typeof f[d]._type&&f[d]._type===
e.CONCEPT&&("function"===typeof c?e.alsoBehavesLike(f[d],c.prototype):e.alsoBehavesLike(f[d],c))}function d(a,c,f){a=this[a];var d=this[c],b=this[f];d._type===e.CONCEPT?e.error(Error("Cannot define a relationship with a concept type: "+d._value)):null===d._type&&(d._type=e.RELATIONSHIP);b._type===e.RELATIONSHIP?e.error(Error("Cannot create a relationship with a relationship type: "+b._value)):null===b._type&&(b._type=e.CONCEPT);a._type===e.RELATIONSHIP?e.error(Error("Cannot create a relationship from a relationship type: "+
a._value)):null===a._type&&(a._type=e.CONCEPT);"undefined"===typeof a[c]&&(a[c]=new a.constructor(d));"undefined"===typeof a[c][f]&&(a[c][f]=b);"undefined"===typeof a[f]&&(a[f]=b);b.relate(a[c]);for(var l in b)b.hasOwnProperty(l)&&"function"===typeof b[l].relate&&("undefined"===typeof a[c][l]&&(a[c][l]=b[l]),"undefined"===typeof a[l]&&(a[l]=b[l]),b[l].relate(a[c]))}function p(a,c){var f=this[a],d=this[c];d._type===e.RELATIONSHIP?e.error(Error("Cannot apply isA to a relationship type: "+d._value)):
null===d._type&&(d._type=e.CONCEPT);f._type===e.RELATIONSHIP?e.error(Error("Cannot apply isA to a relationship type: "+f._value)):null===f._type&&(f._type=e.CONCEPT);"undefined"===typeof d[a]&&(d[a]=f)}function r(a,c){var f=this[a],d=this[c];d._type===e.RELATIONSHIP?e.error(Error("Cannot apply hasRange to a relationship type: "+d._value)):null===d._type&&(d._type=e.CONCEPT);f._type===e.CONCEPT?e.error(Error("Cannot assign hasRange from a concept type: "+f._value)):null===f._type&&(f._type=e.RELATIONSHIP);
"undefined"===typeof f[c]&&(f[c]=d);d.relate(f);for(var b in d)if(d.hasOwnProperty(b)&&"function"===typeof d[b].relate){var l=d[b]._value||null;null!==l&&("undefined"===typeof f[l]&&(f[l]=d[b]),d[b].relate(f))}}function l(a,c){var f=this[a],d=this[c];d._type===e.RELATIONSIP?e.error(Error("Cannot apply hasRange to a relationship type: "+d._value)):null===d._type&&(d._type=e.CONCEPT);f._type===e.CONCEPT?e.error(Error("Cannot assign hasRange from a concept type: "+f._value)):null===f._type&&(f._type=
e.RELATIONSHIP);"undefined"===typeof d[a]&&(d[a]=f)}"function"!==typeof Object.getPrototypeOf&&(Object.getPrototypeOf="object"===typeof"test".__proto__?function(a){return a.__proto__}:function(a){return a.constructor.prototype});e=function(c,f){"undefined"===typeof c&&e.error(Error("Missing required parameter for smallmachine constructor: one or more instances of type 'Ontology'"));for(var d=[].concat(c),l="",g=0;g<d.length;g++)"undefined"===typeof d[g]&&e.error(Error("Element "+g+" of the ontologies argument passed to the smallmachine constructor is undefined")),
"undefined"===typeof d[g].namespace?"undefined"!==typeof e.ontology[d[g]]&&(l=l+d[g]+",",d[g]=e.ontology[d[g]]):l=l+d[g].namespace+",";l=new a(l.substring(0,l.length-1));for(g=0;g<d.length;g++){for(var k in d[g])d[g].hasOwnProperty(k)&&"undefined"!==typeof d[g][k]._name&&"Proxy"==d[g][k]._name&&l.addTerm(d[g][k]._term._value);for(var n=0;n<d[g]._inferencer._rules.length;n++)l._inferencer._rules.push(d[g]._inferencer._rules[n]);for(n=0;n<d[g]._activators.length;n++){var p=b(d,d[g]._activators[n]);
null!==p&&e.error(Error("Cannot wire-in ontology with missing activator dependency on '"+p+"'"));l.registerActivator(d[g]._activators[n]);l._activators.sort(function(a,c){if(a.namespace==c.namespace)return 0;for(var f=0;f<a.dependencies.length;f++)if(c.namespace==a.dependencies[f])return 1;for(f=0;f<c.dependencies.length;f++)if(a.namespace==c.dependencies[f])return-1;return 0})}}return l.getModel(f)};e.alsoBehavesLike=function(a,c){("undefined"===typeof a||"undefined"===typeof c)&&e.error(Error("Cannot mixin with an undefined object"));
for(var f in c)if(c.hasOwnProperty(f)&&!(0==f.indexOf("_")||"initializer"===f))if("undefined"!==typeof a[f]){if("undefined"!==typeof c[f].prototype){if("undefined"!==typeof c[f].prototype.initializer&&!0==c[f].prototype.initializer)continue;var d="undefined"!==typeof c[f].prototype.virtual?c[f].prototype.virtual:!1}var b="undefined"!==typeof a[f].prototype?a[f].prototype.virtual:!1;if(!b||!d)b&&(a[f]=c[f])}else a[f]=c[f];"undefined"!==typeof c.prototype&&"undefined"!==typeof a.prototype&&e.alsoBehavesLike(a.prototype,
c.prototype)};e.error=function(a,f){if("undefined"!==typeof f&&"function"===typeof f.handleError)f.handleError(a);else if("function"===typeof e.handleError)e.handleError(a);else throw a;};var n=function(a){var f=16*Math.random()|0;return("x"==a?f:f&3|8).toString(16)};e.getGuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,n)};e.CONCEPT="concept";e.RELATIONSHIP="relationship";k.prototype._name="Proxy";g.prototype.relate=function(a){"undefined"===typeof this._relatesTo&&(this._relatesTo=
[]);for(var f=!1,c=0;c<this._relatesTo.length;c++)if(this._relatesTo[c]._id==a._id){f=!0;break}f||this._relatesTo.push(a)};h.prototype._name="Behavior";e.Behavior=h;a.prototype._name="Ontology";a.prototype.addTerm=function(a){if("undefined"!==typeof this[a])return this;this._term.prototype.relate=g.prototype.relate;var f=new this._term(a);this[a]=new k(f,this._inferencer);return this};a.prototype.registerActivator=function(a,f){"undefined"===typeof f&&(f=[]);null===e.typeMask(a,{fn:"function",namespace:!0,
dependencies:!0})?this._activators.push(a):this._activators.push({fn:a,namespace:this.namespace,dependencies:f})};a.prototype.getModel=function(a){var f=new function(){return this},c=[];if("undefined"!==typeof a){c=c.concat(a);for(a=0;a<c.length;a++)if("undefined"===typeof c[a]&&e.error("One or more [behaviors] arguments were supplied to the smallmachine constructor that are 'undefined'; error creating object model"),"undefined"!==typeof c[a].prototype&&!0===c[a].prototype.initializer)c[a](f)}for(var d in this)if(this.hasOwnProperty(d)&&
!("undefined"===typeof this[d]||"undefined"===this[d]._term)&&0!==d.indexOf("_"))if("undefined"!==typeof this[d]._term){f[d]=this[d]._term;for(a=0;a<c.length;a++)e.alsoBehavesLike(Object.getPrototypeOf(f[d]),c[a].prototype)}else f[d]=this[d];this._inferencer._rules.sort(function(a,f){return a._priority-f._priority});for(a=0;a<this._inferencer._rules.length;a++)c=this._inferencer._rules[a],c._fn.apply(f,c._args);for(a=0;a<this._activators.length;a++)this._activators[a].fn(f);return f};e.Ontology=a;
var q=function(a,f,c){this._fn=f;this._args=c;this._priority=a;return this};f.prototype.isA=function(a){this._rules.push(new q(1,p,[this._term._value,a._term._value]));return this};f.prototype.relatesTo=function(a,f){this._rules.push(new q(10,d,[this._term._value,a._term._value,f._term._value]));return this};f.prototype.hasDomain=function(a){this._rules.push(new q(3,l,[this._term._value,a._term._value]));return this};f.prototype.hasRange=function(a){this._rules.push(new q(2,r,[this._term._value,a._term._value]));
return this};f.prototype.alsoBehavesLike=function(a){this._rules.push(new q(20,c,[this._term._value,a]));return this};e.alsoBehavesLike(k,f);e.typeMask=function(a,f){var c=[],d;for(d in f)f.hasOwnProperty(d)&&("undefined"===typeof a||"undefined"===typeof a[d]?c.push(d):"undefined"!==typeof a[d]&&typeof a[d]!==f[d]&&!0!==f[d]&&c.push(d));return 0===c.length?null:c};return e}(smallmachine||{});(function(e){function b(){return this}function k(){return this}function g(a){this._channel=a;return this}function h(a,c,d){"undefined"===typeof c&&e.error(Error("Parameter 'key' is required when instantiating the sm.NamedValue type"));this.namespace=a;this.key=c;this.value=d;return this}function m(){this._collection={};return this}var a=new e.Ontology("sm.properties");a.addTerm("property");a.addTerm("type");a.addTerm("ontology");a.addTerm("behavior");a.addTerm("hasMemberType");a.addTerm("hasMember");
a.addTerm("Ontology");a.addTerm("Behavior");a.addTerm("Constructor");a.addTerm("Null");a.ontology.isA(a.property);a.behavior.isA(a.property);a.Ontology.isA(a.type);a.Behavior.isA(a.type);a.Constructor.isA(a.type);a.Null.isA(a.type);a.ontology.relatesTo(a.hasMemberType,a.Ontology);a.behavior.relatesTo(a.hasMemberType,a.Behavior);a.ontology.relatesTo(a.hasMember,a.Null);a.behavior.relatesTo(a.hasMember,a.Null);b.prototype.extendedBy=function(a,c){var d=this.hasMemberType;"undefined"===typeof c&&("undefined"===
d?c=a._name:"undefined"!==typeof a.prototype&&(c=a.prototype._name));if("undefined"!==typeof c&&"function"===typeof a)"undefined"!==typeof this[c]?e.alsoBehavesLike(this[c],a):this[c]=a,"undefined"===typeof this[c]._name&&(this[c]._name=c);else{var b=c||a.namespace||a._name;"undefined"===typeof b&&e.error(Error("Cannot call extendedBy on the core ontology with an object that is missing the 'namepsace' and '_name' properties without specifying a 'typeName'"));if("undefined"!==typeof this[b])e.alsoBehavesLike(this[b],
a);else{var g=e[this._value][d._value];"undefined"===typeof g&&e.error(Error("The specified type does not exist in the core object model: "+d._value));var d=a._name||a.constructor.name,l=!1,n;for(n in g)if(g.hasOwnProperty(n)&&0!==n.indexOf("_")&&n===d){this.hasMember[b]=a;this[b]=a;l=!0;break}l||e.error(Error("Did not find an allowed model type for: "+d))}}};k.prototype._name="Null";e.alsoBehavesLike(e,a.getModel(b));e.ontology.extendedBy(new k);e.behavior.extendedBy(new k);g.prototype._name="AsyncResult";
g.prototype.publish=function(a,c){this._channel.publish(a,c);return this};e.type.extendedBy(g);h.prototype.adapt=function(a,c){this.namespace=a;if("undefined"!==typeof c)for(var d=[].concat(c),b=0;b<d.length;b++)e.alsoBehavesLike(this,d[b]);return this};h.prototype._name="NamedValue";e.type.extendedBy(h);m.prototype._name="NamedValueCollection";m.prototype.exists=function(a,c){var d=a;null===e.typeMask(a,{namespace:!0,key:!0})&&(d=a.namespace,c=a.key);return"undefined"!==typeof this._collection[d]&&
"undefined"!==typeof this._collection[d][c]};m.prototype.add=function(a,c,d){var b=a.namespace||a,g=a.key||c;"undefined"!==typeof this._collection[b]&&"undefined"!==this._collection[b][g]&&e.error(Error("Cannot add a new entry to the collection (already exists): ["+b+"]"+g));this.modify(a,c,d);return this};m.prototype.modify=function(a,c,d){var b=a.namespace||a;c=a.key||c;a=a.value||d;"undefined"===typeof c&&e.error(Error("Must supply a valid key"));"undefined"===typeof a&&e.error(Error("Must supply a valid value"));
"undefined"===typeof this._collection[b]&&(this._collection[b]={});this._collection[b][c]=a;return this};m.prototype.remove=function(a,c){if(!("undefined"===typeof this._collection[a]||"undefined"===typeof this._collection[a][c]))return delete this._collection[a][c],this};m.prototype.getValue=function(a,c){var d=a.namespace||a,b=a.key||c;if(!("undefined"===typeof this._collection[d]||"undefined"===this._collection[d][b]))return d=this._collection[d][b],"undefined"!==typeof d&&("function"===typeof a.setValue?
a.setValue(d):"undefined"!==typeof a.value&&(a.value=d)),d};e.type.extendedBy(m)})(smallmachine);(function(e){var b=new e.Ontology("sm.channels");b.addTerm("thing");b.addTerm("user");b.addTerm("system");b.addTerm("action");b.addTerm("click");b.addTerm("doubleClick");b.addTerm("keyPress");b.addTerm("task");b.addTerm("initialize");b.addTerm("insert");b.addTerm("remove");b.addTerm("get");b.addTerm("set");b.addTerm("messenger");b.addTerm("success");b.addTerm("error");b.addTerm("performs");b.addTerm("reactsTo");b.user.isA(b.thing);b.user.relatesTo(b.performs,b.action);b.system.isA(b.thing);b.system.relatesTo(b.performs,
b.task);b.action.isA(b.thing);b.task.isA(b.thing);b.messenger.isA(b.thing);b.click.isA(b.action);b.doubleClick.isA(b.action);b.keyPress.isA(b.action);b.get.isA(b.task);b.set.isA(b.task);b.success.isA(b.messenger);b.error.isA(b.messenger);b.initialize.isA(b.task);b.insert.isA(b.task);b.remove.isA(b.task);b.performs.hasRange(b.action).hasRange(b.task);b.reactsTo.hasRange(b.action).hasDomain(b.system);b.registerActivator(function(b){function k(a,d){if("undefined"!==typeof jQuery)try{jQuery.ajax({dataType:"json",
url:a,type:"GET",success:function(f,n,k){b.messenger.success.publish(n);d.publish(new e.type.NamedValue("sm.channels",a,f))},error:function(a,c,d){e.error(Error(d))}})}catch(f){e.error(Error(f))}else{var h=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP.3.0");h.onprogress=function(){};h.onerror={};h.onreadystatechange=function(){4>h.readyState||(200==h.status?(b.messenger.success.publish(h.statusText),d.publish(new e.type.NamedValue("sm.channels",a,JSON.parse(h.responseText)))):
e.error(Error(h.statusText)))};h.open("GET",a,!0);h.setRequestHeader("X-Requested-With","XMLHttpRequest");h.setRequestHeader("Content-type","application/json");h.send(null)}return d}var m={update:function(a){return"undefined"!==typeof a.key&&"undefined"!==typeof a.namespace?function(a){b.memory.modify(a)}:!1}};e.alsoBehavesLike(b,{memory:new e.type.NamedValueCollection});b.set.subscribe({update:function(a){return m}});var a={update:function(a){return"undefined"!==typeof a.key&&"undefined"!==typeof a.namespace?
function(a){b.memory.getValue(a)}:!1}};b.get.subscribe({update:function(c){return a}});"function"===typeof b.initialize.addHelper&&b.initialize.addHelper("json",k);"function"===typeof b.set.addHelper&&b.set.addHelper("config",function(a){return new e.type.NamedValue("sm.channels","config",a)});if("function"===typeof b.get.addHelper){b.get.addHelper("json",k);var f=function(){this.namespace="sm.channels";this.key="config";return this};f.prototype._name="Config";f.prototype.setValue=function(a){e.alsoBehavesLike(this,
a)};e.type.extendedBy(f);b.get.addHelper("config",function(a){return a})}});try{e.ontology.extendedBy(b)}catch(k){e.error(Error("Could not extend the smallmachine.ontology property with the 'sm.channels' ontology: "+k.message+"\n"+k.stack))}})(smallmachine);(function(e){function b(b,e){this._value=b;this._type=e;return this}b.prototype._name="Channel";b.prototype.forward=function(b,e){null!=this._value&&(e[this._value]=!0);for(var h in this)if(this.hasOwnProperty(h)&&!("function"===typeof this[h]||0===h.indexOf("_"))&&!0!==e[h]&&"function"===typeof this[h].publish)e[h]=!0,this[h].publish(b,e);if("undefined"!==typeof this._relatesTo)for(h=0;h<this._relatesTo.length;h++)"undefined"!==typeof this._relatesTo[h]._subscribers&&this.notify(b,this._relatesTo[h]._subscribers)};
b.prototype.unsubscribe=function(b){"undefined"!==typeof this._subscribers&&delete this._subscribers[b]};b.prototype.subscribe=function(b){"undefined"===typeof this._subscribers&&(this._subscribers={});var g=e.getGuid();"function"===typeof b?this._subscribers[g]={update:b,lifetime:1}:("undefined"===typeof b.lifecycle&&(b.lifetime=1),this._subscribers[g]=b);return g};b.prototype.notify=function(b,g){var h=!1,m={},a=0,f=[],c;for(c in g){var d=g[c].update(b);"undefined"!==typeof g[c]&&(0>=g[c].lifetime&&
this.unsubscribe(c),!0===d?h=!0:"function"===typeof d?(f.push(d),h=!0):d&&"function"===typeof d.update&&(m[e.getGuid()]=d,a++))}if(h){c=0===f.length;for(d=0;d<f.length;d++)!1===!f[d](b)&&(c=!0);!1===c&&(h=!1)}!1==h&&0<a&&this.notify(b,m)};b.prototype.publish=function(b,g){g=g||{};if("function"===typeof b&&(b=b(new e.type.AsyncResult(this)),"undefined"!==typeof b&&"undefined"!==typeof b._channel&&"function"===typeof b.publish))return this;if("undefined"===typeof this._subscribers)return this.forward(b,
g),this;this.notify(b,this._subscribers);this.forward(b,g);return this};b.prototype.addHelper=function(e,g){var h=b.prototype.publish,m=this;this[e]=function(){for(var a=[],f=0;f<arguments.length;f++)a.push(arguments[f]);return h.apply(m,[function(c){a.push(c);return g.apply(m,a)}])};return this};e.behavior.extendedBy(b)})(smallmachine);(function(e,b){function k(e){"undefined"!==typeof b.fn&&b.extend({sm:e});return this}k.prototype._name="Extension";k.prototype.initializer=!0;e.behavior.extendedBy(k)})(smallmachine,jQuery||{});(function(e){function b(){this.length=0;this._min=this._max=-1;return this}function k(){return this}b.prototype.add=function(b,h){"undefined"===typeof this[b]?(0<this._max&&this._max<this.length+1&&e.error(Error("The maximum number of items already exists in this collection (max "+this._max+")")),this[b]=h,this.length++):e.error(Error("Cannot add an item to a collection when it's key has already present: "+b))};b.prototype.exists=function(b){return"undefined"!==typeof this[b]};b.prototype.remove=
function(b){"undefined"!==typeof this[b]?(delete this[b],this.length--):e.error(Error("An item with the specified key has not been added: "+b))};k.prototype._name="Restrictions";k.prototype.max=function(e){"undefined"===typeof this._collection&&(this._collection=new b);this._collection._max=e};k.prototype.add=function(e,h){"undefined"===typeof this._collection&&(this._collection=new b);this._collection.add(e,h)};k.prototype.min=function(e){"undefined"===typeof this._collection&&(this._collection=
new b);this._collection._min=e};e.behavior.extendedBy(k)})(smallmachine);(function(e){function b(a,c){c.y=parseFloat(a.y);c.x=parseFloat(a.x);c.width=parseFloat(a.width);c.height=parseFloat(a.height);return this}function k(a){new b(a,this);return this}function g(a){new b(a,this);return this}function h(a){new b(a,this);return this}function m(a){new b(a,this);return this}function a(a,c,d,f){this.shape=new p[a.shape||"ellipse"](a);this.id=a.id||e.getGuid();this.edges=a.edges||[];this.label=a.label||this.id;this.paper=c;this.shapeAttr=d;this.shapeLabelAttr=f;this.data=a.data||
{};this.title=a.title||a.label;return this}function f(a,c,d,f,b,e){this.id1=a.id;this.id2=c.id;this.r1=a.shape.width/2;this.r2=c.shape.width/2;this.x1=a.shape.x;this.y1=a.shape.y;this.x2=c.shape.x;this.y2=c.shape.y;this.label=a.edges[d].label||"";this.paper=f;this.lineAttr=b;this.edgeLabelAttr=e;this.data={};return this}function c(a){this._model=a;this.handleError=function(c){a.messenger.error.publish(c)};return this}var d=new e.Ontology("sm.nodes");d.addTerm("task");d.addTerm("insert");d.addTerm("connect");
d.addTerm("set");d.addTerm("get");d.addTerm("paint");d.addTerm("paintNodes");d.paint.isA(d.task);d.insert.isA(d.task);d.connect.isA(d.task);d.set.isA(d.task);d.get.isA(d.task);d.paintNodes.isA(d.paint);k.prototype.draw=function(a){return a.ellipse(this.x,this.y,this.width/2,this.height/2)};g.prototype.draw=function(a){return a.rect(this.x-this.width/2,this.y-this.height/2,this.width,this.height)};h.prototype.draw=function(a){var c=this.x-this.width/2,d=this.y;return a.path(["M",c,d,"L",this.x,this.y-
this.height/2,"L",this.x+this.width/2,this.y,"L",this.x,this.y+this.height/2,"L",c,d])};m.prototype.draw=function(a){var c=this.x-this.width/2,d=this.y+this.height/2;return a.path(["M",c,d,"L",this.x,this.y-this.height/2,"L",this.x+this.width/2,this.y+this.height/2,"L",c,d])};var p={ellipse:k,rectangle:g,diamond:h,triangle:m};a.prototype.update=function(a){a=this.shape.draw(this.paper);a.id=this.id;"function"===typeof this.shapeAttr?this.shapeAttr(a,this):a.attr(this.shapeAttr);var c=this.paper.text(this.shape.x,
this.shape.y,this.label);""!=this.title&&(a.attr("title",this.title),c.attr("title",this.title));"function"===typeof this.shapeLabelAttr?this.shapeLabelAttr(c,this):c.attr(this.shapeLabelAttr);return!0};f.prototype.update=function(a){a=this.paper.path(["M",this.x1,this.y1,"L",this.x2,this.y2]);"function"===typeof this.lineAttr?this.lineAttr(a,this):a.attr(this.lineAttr);a=this.paper.text((this.x1+this.x2)/2,(this.y1+this.y2)/2,this.label);"function"===typeof this.edgeLabelAttr?this.edgeLabelAttr(a,
this):a.attr(this.edgeLabelAttr);var c=180*Math.atan2(this.y2-this.y1,this.x2-this.x1)/Math.PI;90<c?a.transform("t-6,-6r"+(c+180)):a.transform("t6,-6r"+c);return!0};c.prototype.update=function(c){var d=new e.type.Config;this._model.system.get.config(d);c=c.value;if("undefined"===typeof c)return!1;null!==e.typeMask(c,{length:!0,sort:"function"})&&e.error(Error("Cannot determine the JSON type; expecting an array (or comparable object) of node objects but received "+c),this);var b=new e.type.NamedValue("sm.raphaeljs",
"paper",null);this._model.get.publish(b);b.value.clear();for(var g=0;g<c.length;g++){for(var h=new a(c[g],b.value,d.shapeAttr||{},d.shapeLabelAttr||{}),k=0;k<h.edges.length;k++){var p;a:{p=c;for(var m=h.edges[k].id,r=0;r<p.length;r++)if(p[r].id===m){p=new a(p[r]);break a}p=null}null!==p&&("undefined"!=typeof p.shape.x&&"undefined"!==typeof p.shape.y)&&(p=new f(h,p,k,b.value,d.lineAttr||{},d.edgeLabelAttr||{}),this._model.connect.publish(p))}this._model.insert.publish(h)}};d.registerActivator(function(a){var d=
new c(a);a.paintNodes.subscribe(function(a){return d});a.connect.subscribe(function(a){return a});a.insert.subscribe(function(a){return a})},["sm.channels","sm.raphaeljs"]);try{e.ontology.extendedBy(d)}catch(r){e.error(Error("Could not extend the smallmachine.ontology property with the 'sm.nodes' ontology: "+r.message+"\n"+r.stack))}})(smallmachine);(function(e,b,k){function g(){this.leftSiblingNode=null;return this}function h(a,f){this.nodeIndex={};this.defaultWidth=60;this.defaultVerticalDistance=100;this.defaultNodeMargin=40;this.root=a[0];for(var c=0;c<a.length;c++){a[c].id===f&&(this.root=a[c]);a[c].prelim=0;a[c].mod=0;a[c].thread=null;a[c].ancestor=a[c];a[c].shift=0;a[c].change=0;a[c].num=a[c].num||0;if("undefined"!==typeof a[c].height){var d=parseFloat(a[c].height);a[c].y=100<d?d-100:100}"undefined"===typeof a[c].children&&(a[c].children=
[]);if("undefined"!==typeof a[c].edges)for(d=0;d<a[c].edges.length;d++){var b=this._getNodeFromIndex(a[c].edges[d].id,a);b.parentNodeId=a[c].id;b.num=d;a[c].children.push(b)}for(d=0;d<a[c].children.length;d++)a[c].children[d].leftMostSiblingNode=a[c].children[0],1>d||(a[c].children[d].leftSiblingNode=a[c].children[d-1]);"undefined"===typeof a[c].isLeaf&&(a[c].__proto__=g.prototype,e.alsoBehavesLike(a[c],g.prototype))}"undefined"!==typeof this.root.parentNodeId&&e.error(Error("Aborting; An infinite loop may occur because the root node has a value for parentNodeId (which is set to "+
this.root.parentNodeId+")"))}b=new e.Ontology("sm.flowchart");b.addTerm("paint");b.addTerm("get");g.prototype.leftMostChild=function(){return this.children[0]||null};g.prototype.rightMostChild=function(){return 1>this.children.length?this.children[0]||null:this.children[this.children.length-1]};g.prototype.leftSibling=function(){return this.leftSiblingNode||null};g.prototype.leftMostSibling=function(){return this.leftMostSiblingNode||null};g.prototype.isLeaf=function(){return 0===this.children.length};
h.prototype.walk=function(a){this.firstWalk(this.root);this.secondWalk(this.root,-this.root.prelim,0,a)};h.prototype._name="TreeLayout";h.prototype._getNodeFromIndex=function(a,b){if("undefined"!==typeof this.nodeIndex[a])return this.nodeIndex[a];for(var c=b.length-1;0<=c;c--)if("undefined"===typeof this.nodeIndex[b[c].id]&&(this.nodeIndex[b[c].id]=b[c]),b[c].id===a)return b[c]};h.prototype.getSpacing=function(a){return 0.5*("undefined"!==typeof a.width?parseFloat(a.width):this.defaultWidth)};h.prototype.firstWalk=
function(a){if(a.isLeaf()){var b=a.leftSibling();null===b?a.prelim=0:(a.prelim=b.prelim+this.getSpacing(b)+this.defaultNodeMargin+this.getSpacing(a),b.y>a.y&&(a.y=b.y))}else{for(var b=a.leftMostChild(),c=0;c<a.children.length;c++)this.firstWalk(a.children[c]),b=this.apportion(a.children[c],b);this.executeShifts(a);c=0.5*(a.leftMostChild().prelim+a.rightMostChild().prelim);b=a.leftSibling();null!==b?(a.prelim=b.prelim+this.getSpacing(b),a.mod=a.prelim-c,b.y>a.y&&(a.y=b.y)):a.prelim=c}};h.prototype.apportion=
function(a,b){var c=a.leftSibling();if(null!==c){for(var d=a,e=a,g=a.leftMostSibling(),h=d.mod,k=e.mod,m=c.mod,t=g.mod,s=this.nextRight(c),u=this.nextLeft(d);null!==s&&null!==u;)c=s,d=u,g=this.nextLeft(g),e=this.nextRight(e),c.ancestor=a,s=c.prelim+m-(d.prelim+h)+this.defaultWidth,0<s&&(this.moveSubtree(this.ancestor(d,a,b),a,s),h+=s,k+=s),m+=c.mod,h+=d.mod,t+=g.mod,k+=e.mod,s=this.nextRight(c),u=this.nextLeft(d);null!==this.nextRight(c)&&null===this.nextRight(e)&&(e.thread=this.nextLeft(g),e.mod+=
m-k);null!==this.nextLeft(d)&&null===this.nextLeft(g)&&(g.thread=this.nextLeft(d),g.mod+=h-t,b=a)}return b};h.prototype.moveSubtree=function(a,b,c){var d=b.num-a.num;b.change-=c/d;b.shift+=c;a.change+=c/d;b.prelim+=c;b.mod+=c};h.prototype.executeShifts=function(a){for(var b=0,c=0,d=a.children.length-1;0<=d;d--){var e=a.children[d];e.prelim+=b;e.mod+=b;c+=e.change;b+=e.shift+c}};h.prototype.secondWalk=function(a,b,c,d){"undefined"===typeof d&&(d=0);a.x=a.prelim+b+d;a.y+=120*c++;for(var e=0;e<a.children.length;e++)this.secondWalk(a.children[e],
b+a.mod,c,d)};h.prototype.nextRight=function(a){var b=a.rightMostChild();return null!==b?b:a.thread};h.prototype.nextLeft=function(a){var b=a.leftMostChild();return null!==b?b:a.thread};h.prototype.ancestor=function(a,b,c){return a.parentNodeId===b.parentNodeId?a.ancestor:c};h.prototype.areSiblings=function(a,b){return a.parentNodeId===b.parentNodeId};e.type.extendedBy(h);b.registerActivator(function(a){a.paint.subscribe(function(b){if(null===e.typeMask(b.value,{length:!0,sort:"function"}))return function(c){var d=
new e.type.NamedValue("sm.flowchart","root",null);a.get.publish(d);c=new e.type.NamedValue("sm.raphaeljs","paper",null);a.get.publish(c);d=new e.type.TreeLayout(b.value,d.value,{});null!==c.value?d.walk(c.value.width/2):d.walk();return!1}})},["sm.channels","sm.nodes","sm.raphaeljs"]);try{e.ontology.extendedBy(b)}catch(m){e.error(Error("Could not extend the smallmachine.ontology property with the 'sm.nodes' ontology: "+m.message+"\n"+m.stack))}})(smallmachine,jQuery,Raphael);(function(e,b){var k=new e.Ontology("sm.raphaeljs");k.addTerm("set");k.registerActivator(function(g){var k=/^(\d+)%?$/,a=function(a,c,d,g){g=document.getElementById(a+"");if("undefined"===typeof g||!g)throw Error("The specified element ID could not be found: "+a);var h=window,l=document,n=l.documentElement,q=l.getElementsByTagName("body")[0],l=h.innerWidth||n.clientWidth||q.clientWidth,h=h.innerHeight||n.clientHeight||q.clientHeight,n=c;null===c&&(n=g.offsetWidth||l);q=k.exec(n+"");if(!q)throw Error("The specified value for width is invalid (number, percentage or null allowed): "+
c);"function"===typeof n.indexOf&&0<n.indexOf("%")&&(n=100*(g.offsetWidth||l)/parseFloat(q[0]));c=d;null==d&&(c=g.offsetHeight||h);l=k.exec(c+"");if(!l)throw Error("The specified value for height is invalid (number, percentage or null allowed): "+d);"function"===typeof c.indexOf&&0<c.indexOf("%")&&(c=(g.offsetHeight||h)*parseFloat(l[0])/100);a=b(a,n,c);return new e.type.NamedValue("sm.raphaeljs","paper",a)};"function"===typeof g.set.addHelper&&g.set.addHelper("svg",a)},["sm.channels"]);try{e.ontology.extendedBy(k)}catch(g){throw Error("Could not extend the smallmachine.ontology property with the 'sm.raphaeljs' ontology: "+
g.message+"\n"+g.stack);}})(smallmachine,Raphael);(function(e,b){var k=new e.Ontology("sm.sammyjs");k.addTerm("initialize");var g=function(a,b,c){this._id=a;this._callback=b;this._runArg=c||"#/";return this};g.prototype._name="Sammy";e.type.extendedBy(g);var h={update:function(a){return null===e.typeMask(a,{_id:!0,_callback:!0,_runArg:!0})?function(a){b("#"+a._id,a._callback).run(a._runArg)}:!1}};k.registerActivator(function(a){a.initialize.subscribe({update:function(a){return h}})},["sm.channels"]);try{e.ontology.extendedBy(k)}catch(m){throw Error("Could not extend the smallmachine.ontology property with the 'sm.sammyjs' ontology: "+
m.message+"\n"+m.stack);}})(smallmachine,Sammy);
